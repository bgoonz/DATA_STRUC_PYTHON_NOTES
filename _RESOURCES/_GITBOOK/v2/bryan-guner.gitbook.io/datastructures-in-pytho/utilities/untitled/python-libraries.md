<a href="https://bryan-guner.gitbook.io/datastructures-in-pytho/" class="link-a079aa82--primary-53a25e66--logoLink-10d08504"></a>

<img src="https://gblobscdn.gitbook.com/spaces%2F-Mij72ebV4OjqJvBacMy%2Favatar-1631135591697.png?alt=media" class="image-67b14f24--avatar-1c1d03ec" />

<span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1--spaceNameText-677c2969">datastructures-in-python</span>

<a href="https://bryan-guner.gitbook.io/datastructures-in-pytho/" class="link-a079aa82--primary-53a25e66--logoLink-10d08504"></a>

<img src="https://gblobscdn.gitbook.com/spaces%2F-Mij72ebV4OjqJvBacMy%2Favatar-1631135591697.png?alt=media" class="image-67b14f24--avatar-1c1d03ec" />

<span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1--spaceNameText-677c2969">datastructures-in-python</span>

<a href="https://bgoonz-blog.netlify.app/#gsc.tab=0" class="button-36063075--medium-6e2a217a--button-f76f0854--linkButton-67c61496--links-3087c5dc"><span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1--text-8ee2c8b2"><span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1">My Blog</span></span></a>

<a href="https://www.notion.so/webdevhub42/Python-Data-Structures-Unit-1da9a5d55db844f4b62aff6fd2b4d1ce" class="button-36063075--medium-6e2a217a--button-f76f0854--linkButton-67c61496--links-3087c5dc"><span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1--text-8ee2c8b2"><span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1">Notion Notes</span></span></a>

<a href="https://bgoonz-branch-the-algos.vercel.app/" class="button-36063075--medium-6e2a217a--button-f76f0854--linkButton-67c61496--links-3087c5dc"><span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1--text-8ee2c8b2"><span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1">The Algorithms</span></span></a>

<a href="https://thealgorithms.netlify.app/#" class="button-36063075--medium-6e2a217a--button-f76f0854--linkButton-67c61496--links-3087c5dc"><span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1--text-8ee2c8b2"><span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1">Python Module Website</span></span></a>

<a href="https://bryan-guner.gitbook.io/datastructures-in-pytho/" class="link-a079aa82--primary-53a25e66--logoLink-10d08504"></a>

<img src="https://gblobscdn.gitbook.com/spaces%2F-Mij72ebV4OjqJvBacMy%2Favatar-1631135591697.png?alt=media" class="image-67b14f24--avatar-1c1d03ec" />

<span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1--spaceNameText-677c2969">datastructures-in-python</span>

<a href="https://bryan-guner.gitbook.io/datastructures-in-pytho/" class="link-a079aa82--primary-53a25e66--logoLink-10d08504"></a>

<img src="https://gblobscdn.gitbook.com/spaces%2F-Mij72ebV4OjqJvBacMy%2Favatar-1631135591697.png?alt=media" class="image-67b14f24--avatar-1c1d03ec" />

<span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1--spaceNameText-677c2969">datastructures-in-python</span>

<span class="text-4505230f--UIH400-4e41e82a--textUIFamily-5ebd8e40--text-8ee2c8b2"></span>

<a href="https://bryan-guner.gitbook.io/datastructures-in-pytho/" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Home</span></a>

<a href="../../index.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Downloads &amp; Misc-Assets</span></a>

<a href="../../readme-1.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">README</span></a>

<a href="../../navigation.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Navigation</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">Curriculum</span></span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Outline</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">wk17</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">wk18</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">wk19</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">wk20</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">Utilities</span></span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Utilites</span>

<a href="python-libraries.html" class="navButton-94f2579c--pageItemWithChildrenNested-2c5d8183--navButtonClickable-161b88ca--navButtonOpened-6a88552e"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Python Libraries</span></a>

<a href="untitled.html" class="navButton-94f2579c--pageItemWithChildrenNested-2c5d8183--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">YouTube</span></a>

<a href="code-lab-notebook-embeds-from-lecture.html" class="navButton-94f2579c--pageItemWithChildrenNested-2c5d8183--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Code Lab Notebook Embeds From Lecture</span></a>

<a href="../code-lab-notebooks.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Code lab Notebooks</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Repl.IT</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">Abstract Data Structures</span></span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Algorithms</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Data Structures Overview</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Abstract Data Structures:</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">practice</span></span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">GCA Sprint Prep:</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Supplemental Practice:</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">Resources</span></span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Python Cheat Sheet</span>

<a href="../../resources/youtube.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Youtube</span></a>

<a href="../../resources/pdf-downloads.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">PDF Downloads</span></a>

<a href="../../resources/intro-2-python.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Intro 2 Python</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Dictionaries</span>

<a href="../../resources/python-vs-javascript.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Python VS JavaScript</span></a>

<a href="../../resources/untitled-1.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Misc. Resources</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Things To Internalize:</span>

<a href="../../resources/intro-to-python-w-jupyter-notebooks.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Intro To Python w Jupyter Notebooks</span></a>

<a href="../../resources/calculating-big-o.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Calculating Big O</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Useful Links</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">Docs</span></span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Docs</span>

<a href="../../stdlib/queue-and-stacks.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Queue &amp; Stacks</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">quick-reference</span></span>

<a href="../../quick-reference/my-medium-articles.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">My Medium Articles</span></a>

<a href="../../quick-reference/free-python-books.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Free Python Books</span></a>

<a href="../../quick-reference/why-python.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">WHY Python?</span></a>

<a href="../../quick-reference/python-snippets.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Python Snippets</span></a>

<a href="../../quick-reference/python3-regex.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Python3 Regex</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Python Module Index:</span>

<a href="../../quick-reference/creating-python-modules.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Creating Python Modules</span></a>

<a href="../../quick-reference/untitled.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Useful Info</span></a>

<a href="../../quick-reference/python-glossary.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Python Glossary</span></a>

<a href="../../quick-reference/untitled-1.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Python Snippets</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">MISC</span></span>

<a href="../../misc/built-in-methods-and-functions.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Built-in Methods &amp; Functions</span></a>

<a href="../../misc/data-structures-types.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Data Structures Types</span></a>

<a href="../../misc/math.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Math</span></a>

<a href="../../misc/unsorted-examples.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Unsorted Examples</span></a>

<a href="../../misc/outline.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Outline</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">About Python</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">Interview Prep</span></span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Interview Resources</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">Installations Setup & Env</span></span>

<a href="../../installations-setup-and-env/untitled.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">python-setup</span></a>

<a href="../../installations-setup-and-env/installing-python-modules.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Installing Python Modules</span></a>

<a href="../../installations-setup-and-env/set-up-virtual-enviornment.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Set Up Virtual Enviornment</span></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">Aux-Exploration</span></span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Related Studies</span>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f"><span class="text-4505230f--InfoH200-3a8a7a86--textContentFamily-49a318e1">experiments</span></span>

<a href="../../experiments/untitled.html" class="navButton-94f2579c--navButtonClickable-161b88ca"><span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1--navButtonLabel-14a4968f">Untitled</span></a>

<a href="https://www.gitbook.com/?utm_source=content&amp;utm_medium=trademark&amp;utm_campaign=bryan-guner" class="reset-3c756112--trademark-a8da4b94"></a>

<span class="text-4505230f--TextH200-a3425406--textUIFamily-5ebd8e40">Powered by **GitBook**</span>

<span class="text-4505230f--DisplayH900-bfb998fa--textContentFamily-49a318e1">Python Libraries</span>
=====================================================================================================

<span class="text-4505230f--UIH300-2063425d--textUIFamily-5ebd8e40--text-8ee2c8b2"></span>

<span class="text-4505230f--UIH300-2063425d--textUIFamily-5ebd8e40--text-8ee2c8b2"></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="e7c771fef5104bdab210354d3ba56a83"><span data-offset-key="e7c771fef5104bdab210354d3ba56a83:0">The Standard Library</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="098fe36cb7cc4310b4bedb6c3ca80a63"><span data-offset-key="098fe36cb7cc4310b4bedb6c3ca80a63:0">The libraries that tend to get all the attention are the ones heavily used for operating-system interaction, like </span></span><a href="http://bit.ly/py-sys" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="f3b25cdcba474926a2f2638320218771"><span data-offset-key="f3b25cdcba474926a2f2638320218771:0"><code class="code-0458e21e" spellcheck="false" data-slate-leaf="true">sys</code></span></span></a><span data-key="ad5de919f7e54612bd44da1583704352"><span data-offset-key="ad5de919f7e54612bd44da1583704352:0">, </span></span><a href="http://bit.ly/py-os" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="834edf9c740c422d80b1c78a5b01db16"><span data-offset-key="834edf9c740c422d80b1c78a5b01db16:0"><code class="code-0458e21e" spellcheck="false" data-slate-leaf="true">os</code></span></span></a><span data-key="e08081210ba7453289745c6bdeedb2e4"><span data-offset-key="e08081210ba7453289745c6bdeedb2e4:0">, </span></span><a href="http://bit.ly/py-os" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="5fee5a6ffb134a7cb484a134a88101d2"><span data-offset-key="5fee5a6ffb134a7cb484a134a88101d2:0"><code class="code-0458e21e" spellcheck="false" data-slate-leaf="true">shutil</code></span></span></a><span data-key="64deb5f59f08415bbe0e9ad6dbb99049"><span data-offset-key="64deb5f59f08415bbe0e9ad6dbb99049:0">, and to a slightly lesser extent, </span></span><a href="http://bit.ly/py-glob" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="78edc608634549899210a78c471919cc"><span data-offset-key="78edc608634549899210a78c471919cc:0"><code class="code-0458e21e" spellcheck="false" data-slate-leaf="true">glob</code></span></span></a><span data-key="ee322f18f6074823b162990edc545a0b"><span data-offset-key="ee322f18f6074823b162990edc545a0b:0">. This is understandable because most Python applications deal with input processing; however, the Python standard library is very rich and includes a bunch of additional functionality that many Python programmers take too long to discover. In this chapter we will mention a few libraries that every Python programmer should know very well.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="777b61e8600d425ba293fc15c98fe795"><span data-offset-key="777b61e8600d425ba293fc15c98fe795:0">collections</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ed9584b33e5e41b99837a74b43ba0d37"><span data-offset-key="ed9584b33e5e41b99837a74b43ba0d37:0">First up we have the </span><span data-offset-key="ed9584b33e5e41b99837a74b43ba0d37:1">`collections`</span><span data-offset-key="ed9584b33e5e41b99837a74b43ba0d37:2"> module. If you’ve been working with Python for any length of time, it is very likely that you have made use of the this module; however, the batteries contained within are so important that we’ll go over them anyway, </span><span data-offset-key="ed9584b33e5e41b99837a74b43ba0d37:3">*just in case*</span><span data-offset-key="ed9584b33e5e41b99837a74b43ba0d37:4">.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="7495c114d6d54869a59b939c7dfcd3b3"><span data-offset-key="7495c114d6d54869a59b939c7dfcd3b3:0">collections.OrderedDict</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e66645cc380946c4aca338a336bceacf"><span data-offset-key="e66645cc380946c4aca338a336bceacf:0">`collections.OrderedDict`</span><span data-offset-key="e66645cc380946c4aca338a336bceacf:1"> gives you a </span><span data-offset-key="e66645cc380946c4aca338a336bceacf:2">`dict`</span><span data-offset-key="e66645cc380946c4aca338a336bceacf:3"> that will preserve the order in which items are added to it; note that this is </span><span data-offset-key="e66645cc380946c4aca338a336bceacf:4">*not*</span><span data-offset-key="e66645cc380946c4aca338a336bceacf:5"> the same as a sorted order.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737073220608" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="cc0aff9ddae64301b98ad658d5e79385"><span data-offset-key="cc0aff9ddae64301b98ad658d5e79385:0">1</span></span></a><span data-key="e867342ba2994681a6e678c79f484bfd"><span data-offset-key="e867342ba2994681a6e678c79f484bfd:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0270d909962e43eba4d57faf1f10dabb"><span data-offset-key="0270d909962e43eba4d57faf1f10dabb:0">The need for an </span><span data-offset-key="0270d909962e43eba4d57faf1f10dabb:1">*ordered*</span><span data-offset-key="0270d909962e43eba4d57faf1f10dabb:2"> </span><span data-offset-key="0270d909962e43eba4d57faf1f10dabb:3">`dict`</span><span data-offset-key="0270d909962e43eba4d57faf1f10dabb:4"> comes up surprisingly often. A common example is processing lines in a file where the lines (or something within them) maps to other data. A mapping is the right solution, and you often need to produce results in the same order in which the input data appeared. Here is a simple example of how the ordering changes with a normal </span><span data-offset-key="0270d909962e43eba4d57faf1f10dabb:5">`dict`</span><span data-offset-key="0270d909962e43eba4d57faf1f10dabb:6">:</span></span></span>

    >>> dict(zip(ascii_lowercase, range(4))){'a': 0, 'b': 1, 'c': 2, 'd': 3}​>>> dict(zip(ascii_lowercase, range(5))){'a': 0, 'b': 1, 'c': 2, 'd': 3, 'e': 4}​>>> dict(zip(ascii_lowercase, range(6))){'a': 0, 'b': 1, 'c': 2, 'd': 3, 'f': 5, 'e': 4} ​>>> dict(zip(ascii_lowercase, range(7))){'a': 0, 'b': 1, 'c': 2, 'd': 3, 'g': 6, 'f': 5, 'e': 4}

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ef70eb16870e495fb4514ade8002b4ee"><span data-offset-key="ef70eb16870e495fb4514ade8002b4ee:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO1-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d4d39f8321ee47a68564f8be60535975"><span data-offset-key="d4d39f8321ee47a68564f8be60535975:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="444a08a7bae14cf1a64571d3c6fe60ba"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="444a08a7bae14cf1a64571d3c6fe60ba"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="b14d6ca4642f48f8af37962673721795"><span data-offset-key="b14d6ca4642f48f8af37962673721795:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="866032f9781c42a2a4ec06461a74ae02"><span data-offset-key="866032f9781c42a2a4ec06461a74ae02:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e37e050ef40b40de96fce73421a4cdea"><span data-offset-key="e37e050ef40b40de96fce73421a4cdea:0">See how the key "</span><span data-offset-key="e37e050ef40b40de96fce73421a4cdea:1">`f`</span><span data-offset-key="e37e050ef40b40de96fce73421a4cdea:2">" now appears before the "</span><span data-offset-key="e37e050ef40b40de96fce73421a4cdea:3">`e`</span><span data-offset-key="e37e050ef40b40de96fce73421a4cdea:4">" key in the sequence of keys? They no longer appear in the order of insertion, due to how the </span><span data-offset-key="e37e050ef40b40de96fce73421a4cdea:5">`dict`</span><span data-offset-key="e37e050ef40b40de96fce73421a4cdea:6"> internals manage the assignment of hash entries.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b321154bb7e84fe6802c012178c21d15"><span data-offset-key="b321154bb7e84fe6802c012178c21d15:0">The </span><span data-offset-key="b321154bb7e84fe6802c012178c21d15:1">`OrderedDict`</span><span data-offset-key="b321154bb7e84fe6802c012178c21d15:2">, however, retains the order in which items are inserted:</span></span></span>

    >>> from collections import OrderedDict​>>> OrderedDict(zip(ascii_lowercase, range(5)))OrderedDict([('a', 0), ('b', 1), ('c', 2), ('d', 3),('e', 4)])​>>> OrderedDict(zip(ascii_lowercase, range(6)))OrderedDict([('a', 0), ('b', 1), ('c', 2), ('d', 3),('e', 4), ('f', 5)])​>>> OrderedDict(zip(ascii_lowercase, range(7)))OrderedDict([('a', 0), ('b', 1), ('c', 2), ('d', 3),('e', 4), ('f', 5), ('g', 6)])

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="8eb3911e8f1e4347a6d5605509f9ff86"><span data-offset-key="8eb3911e8f1e4347a6d5605509f9ff86:0">ORDEREDDICT: BEWARE CREATION WITH KEYWORD ARGUMENTS</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6b4364f085844eaa8c335765ec8b724c"><span data-offset-key="6b4364f085844eaa8c335765ec8b724c:0">There is an unfortunate catch with </span><span data-offset-key="6b4364f085844eaa8c335765ec8b724c:1">`OrderedDict`</span><span data-offset-key="6b4364f085844eaa8c335765ec8b724c:2"> you need to be aware of: it doesn’t work when you </span><span data-offset-key="6b4364f085844eaa8c335765ec8b724c:3">*create*</span><span data-offset-key="6b4364f085844eaa8c335765ec8b724c:4"> the </span><span data-offset-key="6b4364f085844eaa8c335765ec8b724c:5">`OrderedDict`</span><span data-offset-key="6b4364f085844eaa8c335765ec8b724c:6"> with keyword arguments, a very common Python idiom:</span></span></span>

    >>> collections.OrderedDict(a=1,b=2,c=3)OrderedDict([('b', 2), ('a', 1), ('c', 3)])

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b92d0170e12147b2be0bd75a939bb0fc"><span data-offset-key="b92d0170e12147b2be0bd75a939bb0fc:0">This seems like a bug, but as explained in the documentation, it happens because the keyword arguments are first processed as a </span><span data-offset-key="b92d0170e12147b2be0bd75a939bb0fc:1">*normal*</span><span data-offset-key="b92d0170e12147b2be0bd75a939bb0fc:2"> </span><span data-offset-key="b92d0170e12147b2be0bd75a939bb0fc:3">`dict`</span><span data-offset-key="b92d0170e12147b2be0bd75a939bb0fc:4"> before they are passed on to the </span><span data-offset-key="b92d0170e12147b2be0bd75a939bb0fc:5">`OrderedDict`</span><span data-offset-key="b92d0170e12147b2be0bd75a939bb0fc:6">.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="109ded824f1b450296b067942b5bfbdd"><span data-offset-key="109ded824f1b450296b067942b5bfbdd:0">collections.defaultdict</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="eca7050c18bd4b89abe178970f5eac93"><span data-offset-key="eca7050c18bd4b89abe178970f5eac93:0">`collections.defaultdict`</span><span data-offset-key="eca7050c18bd4b89abe178970f5eac93:1"> is another special-case dictionary: it allows you to specify a default value for all new keys.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3a31d4f9107849eaa5f521734c6a386e"><span data-offset-key="3a31d4f9107849eaa5f521734c6a386e:0">Here’s a common example:</span></span></span>

    >>> d = collections.defaultdict(list)>>> d['a']  []

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5df19bb918454a14aa3370c71b39fced"><span data-offset-key="5df19bb918454a14aa3370c71b39fced:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO2-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="2f9fa7c609a04a738f11a63af400bd82"><span data-offset-key="2f9fa7c609a04a738f11a63af400bd82:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="b1845e8a61854a8b8e37857d570121ca"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="b1845e8a61854a8b8e37857d570121ca"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="96e2fa3206254773853897fd81c8c12c"><span data-offset-key="96e2fa3206254773853897fd81c8c12c:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="91399f5ec3454705aea603b6cef8825b"><span data-offset-key="91399f5ec3454705aea603b6cef8825b:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="685b644ac351485bb7c8bdfee42cdc6a"><span data-offset-key="685b644ac351485bb7c8bdfee42cdc6a:0">You didn’t create this item yet? No problem! Key lookups automatically create </span><span data-offset-key="685b644ac351485bb7c8bdfee42cdc6a:1">*values*</span><span data-offset-key="685b644ac351485bb7c8bdfee42cdc6a:2"> using the function provided when creating the </span><span data-offset-key="685b644ac351485bb7c8bdfee42cdc6a:3">`defaultdict`</span><span data-offset-key="685b644ac351485bb7c8bdfee42cdc6a:4"> instance.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2475e9565e344f11bfe8e36b9ed408fb"><span data-offset-key="2475e9565e344f11bfe8e36b9ed408fb:0">By setting up the default value as the </span><span data-offset-key="2475e9565e344f11bfe8e36b9ed408fb:1">`list`</span><span data-offset-key="2475e9565e344f11bfe8e36b9ed408fb:2"> constructor in the preceding example, you can avoid wordy code that looks like this:</span></span></span>

    d = {}for k in keydata:    if not k in d:            d[k] = []    d[k].append(...)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4db5b27cfe6d4c7f805bdae006ab1136"><span data-offset-key="4db5b27cfe6d4c7f805bdae006ab1136:0">The </span><span data-offset-key="4db5b27cfe6d4c7f805bdae006ab1136:1">`setdefault()`</span><span data-offset-key="4db5b27cfe6d4c7f805bdae006ab1136:2"> method of a </span><span data-offset-key="4db5b27cfe6d4c7f805bdae006ab1136:3">`dict`</span><span data-offset-key="4db5b27cfe6d4c7f805bdae006ab1136:4"> can be used in a somewhat similar way to initialize items with defaults, but </span><span data-offset-key="4db5b27cfe6d4c7f805bdae006ab1136:5">`defaultdict`</span><span data-offset-key="4db5b27cfe6d4c7f805bdae006ab1136:6"> generally results in clearer code.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737068560688" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="b6b070d14cee436697c70623cfdf815c"><span data-offset-key="b6b070d14cee436697c70623cfdf815c:0">2</span></span></a><span data-key="c99989e76596454a8d5d48e2fa548beb"><span data-offset-key="c99989e76596454a8d5d48e2fa548beb:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b8537347c9d14a0aa65c3e4de37c9424"><span data-offset-key="b8537347c9d14a0aa65c3e4de37c9424:0">In the preceding examples, we’re saying that every new element, by default, will be an empty list. If, instead, you wanted every new element to contain a dictionary, you might say </span><span data-offset-key="b8537347c9d14a0aa65c3e4de37c9424:1">`defaultdict(dict)`</span><span data-offset-key="b8537347c9d14a0aa65c3e4de37c9424:2">.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="d1b57c07766746fa9cf51a82181532fe"><span data-offset-key="d1b57c07766746fa9cf51a82181532fe:0">collections.namedtuple</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="224774e005bf4c9387f09b8f126a7d19"><span data-offset-key="224774e005bf4c9387f09b8f126a7d19:0">The next tool, </span><span data-offset-key="224774e005bf4c9387f09b8f126a7d19:1">`collections.namedtuple`</span><span data-offset-key="224774e005bf4c9387f09b8f126a7d19:2">, is magic in a bottle! Instead of working with this:</span></span></span>

    tup = (1, True, "red")

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4017ed02e98744839ef57476c358cabc"><span data-offset-key="4017ed02e98744839ef57476c358cabc:0">You get to work with this:</span></span></span>

    >>> from collections import namedtuple>>> A = namedtuple('A', 'count enabled color')>>> tup = A(count=1, enabled=True, color="red")>>> tup.count1>>> tup.enabledTrue>>> tup.color"red">>> tupA(count=1, enabled=True, color='red')

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="88a9df0e02764282be2be7cd682c3310"><span data-offset-key="88a9df0e02764282be2be7cd682c3310:0">The best thing about </span><span data-offset-key="88a9df0e02764282be2be7cd682c3310:1">`namedtuple`</span><span data-offset-key="88a9df0e02764282be2be7cd682c3310:2"> is that you can add it to existing code and use it to progressively replace tuples: it can appear anywhere a tuple is currently being used, without breaking existing code, and without using any extra resources beyond what plain tuples require. Using </span><span data-offset-key="88a9df0e02764282be2be7cd682c3310:3">`namedtuple`</span><span data-offset-key="88a9df0e02764282be2be7cd682c3310:4"> incurs no extra runtime cost, and can make code much easier to read. The most common situation where a </span><span data-offset-key="88a9df0e02764282be2be7cd682c3310:5">`namedtuple`</span><span data-offset-key="88a9df0e02764282be2be7cd682c3310:6"> is recommended is when a function returns multiple results, which are then unpacked into a tuple. Let’s look at an example of code that uses plain tuples, to see why such code can be problematic:</span></span></span>

    >>> def f():...    return 2, False, "blue"  >>> count, enabled, color = f()  ​>>> tup = f()  >>> enabled = tup[1]

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7271f592d8cf4b868799d2481bb67baa"><span data-offset-key="7271f592d8cf4b868799d2481bb67baa:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO3-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="e310be144e4942fdbca94228c1124373"><span data-offset-key="e310be144e4942fdbca94228c1124373:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="d7452c215ce649f0b779bc21b7a5b5a0"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="d7452c215ce649f0b779bc21b7a5b5a0"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="27fc227656a24ca19da7011f627c4764"><span data-offset-key="27fc227656a24ca19da7011f627c4764:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="d4cb8ab8040644b98ba3e986ce5e2206"><span data-offset-key="d4cb8ab8040644b98ba3e986ce5e2206:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="16d3f15175d9463aaff95e3934ed60da"><span data-offset-key="16d3f15175d9463aaff95e3934ed60da:0">Simple function returning a tuple.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO3-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="4618da4647ec49b4bf62e670f5513e0e"><span data-offset-key="4618da4647ec49b4bf62e670f5513e0e:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="365ebb4cbcc24bc888998a012bb0930d"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="365ebb4cbcc24bc888998a012bb0930d"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="a3d97555963c4e58a38253fc77755c59"><span data-offset-key="a3d97555963c4e58a38253fc77755c59:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="f2e3b8b8411d4a6d904919c5857f05e6"><span data-offset-key="f2e3b8b8411d4a6d904919c5857f05e6:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0fde5815f00a4444889eee57abcc2bb5"><span data-offset-key="0fde5815f00a4444889eee57abcc2bb5:0">When the function is evaluated, the results are unpacked into separate names.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO3-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="9070224f906243dcb4d035caf8d44bc2"><span data-offset-key="9070224f906243dcb4d035caf8d44bc2:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="285490b3e559484fb174e1442d0dd599"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="285490b3e559484fb174e1442d0dd599"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="6aa37b5d63e446b381139efa5d61fd99"><span data-offset-key="6aa37b5d63e446b381139efa5d61fd99:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="681e50605d464df2b319e58737e8925d"><span data-offset-key="681e50605d464df2b319e58737e8925d:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="71137f08d96c4250a6aca627df001f6c"><span data-offset-key="71137f08d96c4250a6aca627df001f6c:0">Worse, the caller might access values inside the returned tuple </span><span data-offset-key="71137f08d96c4250a6aca627df001f6c:1">*by index*</span><span data-offset-key="71137f08d96c4250a6aca627df001f6c:2">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c1b4b549e1c044d5a7f6cf1416d982fc"><span data-offset-key="c1b4b549e1c044d5a7f6cf1416d982fc:0">The problem with this approach is that this code is fragile to future changes. If the function changes (perhaps by changing the order of the returned items, or adding more items), the unpacking of the returned value will be incorrect. Instead, you can modify </span><span data-offset-key="c1b4b549e1c044d5a7f6cf1416d982fc:1">*existing*</span><span data-offset-key="c1b4b549e1c044d5a7f6cf1416d982fc:2"> code to return a </span><span data-offset-key="c1b4b549e1c044d5a7f6cf1416d982fc:3">`namedtuple`</span><span data-offset-key="c1b4b549e1c044d5a7f6cf1416d982fc:4"> instance:</span></span></span>

    >>> def f():...    # Return a namedtuple!...    return A(2, False, "blue")​>>> count, enabled, color = f()

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="185d8717752a410da1bd405e51705301"><span data-offset-key="185d8717752a410da1bd405e51705301:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO4-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="7dc0635ba55343d2895a470da898ab8d"><span data-offset-key="7dc0635ba55343d2895a470da898ab8d:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="7730f00955f8467ca306f7e91606e41e"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="7730f00955f8467ca306f7e91606e41e"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="e113552df38b48358a64c1b03df11076"><span data-offset-key="e113552df38b48358a64c1b03df11076:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="ff1982ac4a0b4a9489feaea17f54a53c"><span data-offset-key="ff1982ac4a0b4a9489feaea17f54a53c:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="cdc5d0f8704b47eb88b56768cd36b529"><span data-offset-key="cdc5d0f8704b47eb88b56768cd36b529:0">Even though our function now returns a </span><span data-offset-key="cdc5d0f8704b47eb88b56768cd36b529:1">`namedtuple`</span><span data-offset-key="cdc5d0f8704b47eb88b56768cd36b529:2">, the same calling code stills works.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d0f0935ebeca45149ea25445da055e89"><span data-offset-key="d0f0935ebeca45149ea25445da055e89:0">You now also have the option of working with the returned </span><span data-offset-key="d0f0935ebeca45149ea25445da055e89:1">`namedtuple`</span><span data-offset-key="d0f0935ebeca45149ea25445da055e89:2"> in the calling code:</span></span></span>

    >>> tup = f()>>> print(tup.count)  2

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5d8e271ad44243db848a001fbb9c652c"><span data-offset-key="5d8e271ad44243db848a001fbb9c652c:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO5-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="3c853be534c24b1cba87aab3be0baba3"><span data-offset-key="3c853be534c24b1cba87aab3be0baba3:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="673caf99e379488dad439a596b3febdb"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="673caf99e379488dad439a596b3febdb"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="a0d668cb1cba487988d81e6cf18de76c"><span data-offset-key="a0d668cb1cba487988d81e6cf18de76c:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="fee532f6004a44a2bf1a328470655677"><span data-offset-key="fee532f6004a44a2bf1a328470655677:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="219a4522ddd94f7087dd0be3a6ea9c37"><span data-offset-key="219a4522ddd94f7087dd0be3a6ea9c37:0">Being able to use </span><span data-offset-key="219a4522ddd94f7087dd0be3a6ea9c37:1">*attributes*</span><span data-offset-key="219a4522ddd94f7087dd0be3a6ea9c37:2"> to access data inside the tuple is much safer rather than relying on indexing alone; if future changes in the code added new fields to the </span><span data-offset-key="219a4522ddd94f7087dd0be3a6ea9c37:3">`namedtuple`</span><span data-offset-key="219a4522ddd94f7087dd0be3a6ea9c37:4">, the </span><span data-offset-key="219a4522ddd94f7087dd0be3a6ea9c37:5">`tup.count`</span><span data-offset-key="219a4522ddd94f7087dd0be3a6ea9c37:6"> would continue to work.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0d242f45a2dc4d3e847378b6f07aa0e1"><span data-offset-key="0d242f45a2dc4d3e847378b6f07aa0e1:0">The </span><span data-offset-key="0d242f45a2dc4d3e847378b6f07aa0e1:1">`collections`</span><span data-offset-key="0d242f45a2dc4d3e847378b6f07aa0e1:2"> module has a few other tricks up its sleeve, and your time is well spent brushing up on the </span></span><a href="http://bit.ly/coll-docs" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="00554f91772c457fa417d19e5afc7445"><span data-offset-key="00554f91772c457fa417d19e5afc7445:0">documentation</span></span></a><span data-key="a0a40098d2094c2f90314a69a64a9e15"><span data-offset-key="a0a40098d2094c2f90314a69a64a9e15:0">. In addition to the classes shown here, there is also a </span><span data-offset-key="a0a40098d2094c2f90314a69a64a9e15:1">`Counter`</span><span data-offset-key="a0a40098d2094c2f90314a69a64a9e15:2"> class for easily counting occurrences, a </span><span data-offset-key="a0a40098d2094c2f90314a69a64a9e15:3">*list-like*</span><span data-offset-key="a0a40098d2094c2f90314a69a64a9e15:4"> container for efficiently appending and removing items from either end (</span><span data-offset-key="a0a40098d2094c2f90314a69a64a9e15:5">`deque`</span><span data-offset-key="a0a40098d2094c2f90314a69a64a9e15:6">), and several helper classes to make subclassing lists, dicts, and strings easier.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="841d3f3e03bc464a881eb06d0f72f6eb"><span data-offset-key="841d3f3e03bc464a881eb06d0f72f6eb:0">contextlib</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="61f2bca743594ddfbd2db35938dc91f9"><span data-offset-key="61f2bca743594ddfbd2db35938dc91f9:0">A context manager is what you use with the </span><span data-offset-key="61f2bca743594ddfbd2db35938dc91f9:1">`with`</span><span data-offset-key="61f2bca743594ddfbd2db35938dc91f9:2"> statement. A very common idiom in Python for working with file data demonstrates the context manager:</span></span></span>

    with open('data.txt', 'r') as f:    data = f.read()

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e47a2af3cf014d6b80c306bcffb19f8d"><span data-offset-key="e47a2af3cf014d6b80c306bcffb19f8d:0">This is good syntax because it simplifies the </span><span data-offset-key="e47a2af3cf014d6b80c306bcffb19f8d:1">*cleanup*</span><span data-offset-key="e47a2af3cf014d6b80c306bcffb19f8d:2"> step where the file handle is closed. Using the context manager means that you don’t have to remember to do </span><span data-offset-key="e47a2af3cf014d6b80c306bcffb19f8d:3">`f.close()`</span><span data-offset-key="e47a2af3cf014d6b80c306bcffb19f8d:4"> yourself: this will happen automatically when the </span><span data-offset-key="e47a2af3cf014d6b80c306bcffb19f8d:5">`with`</span><span data-offset-key="e47a2af3cf014d6b80c306bcffb19f8d:6"> block exits.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="81aef4d80268430bb7e66db242b7a3cf"><span data-offset-key="81aef4d80268430bb7e66db242b7a3cf:0">You can use the </span><span data-offset-key="81aef4d80268430bb7e66db242b7a3cf:1">`contextmanager`</span><span data-offset-key="81aef4d80268430bb7e66db242b7a3cf:2"> decorator from the </span><span data-offset-key="81aef4d80268430bb7e66db242b7a3cf:3">`contextlib`</span><span data-offset-key="81aef4d80268430bb7e66db242b7a3cf:4"> library to benefit from this language feature in your own nefarious schemes. Here’s a creative demonstration where we create a new context manager to print out performance (timing) data.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b4c21adb9e584c2ba00323c4a55db56f"><span data-offset-key="b4c21adb9e584c2ba00323c4a55db56f:0">This might be useful for quickly testing the time cost of code snippets, as shown in the following example. The numbered notes are intentionally not in numerical order in the code. Follow the notes in numerical order as shown following the code snippet.</span></span></span>

    from time import perf_counterfrom array import arrayfrom contextlib import contextmanager​@contextmanager  def timing(label: str):    t0 = perf_counter()      yield lambda: (label, t1 - t0)      t1 = perf_counter() ​with timing('Array tests') as total:      with timing('Array creation innermul') as inner:        x = array('d', [0] * 1000000)  ​    with timing('Array creation outermul') as outer:        x = array('d', [0]) * 1000000  ​​print('Total [%s]: %.6f s' % total())print('    Timing [%s]: %.6f s' % inner())print('    Timing [%s]: %.6f s' % outer())

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2463e133e9624cc09510855b1b3e6af3"><span data-offset-key="2463e133e9624cc09510855b1b3e6af3:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO6-6" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="6ad1a097a3594a63a0dd282f78860cff"><span data-offset-key="6ad1a097a3594a63a0dd282f78860cff:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="8bbbd086466749e69dc8d62b09e8c118"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="8bbbd086466749e69dc8d62b09e8c118"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="eea9f1854dfd41f4883abc45967468d4"><span data-offset-key="eea9f1854dfd41f4883abc45967468d4:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="c609c55e98ea4d13bbca916c962ceb71"><span data-offset-key="c609c55e98ea4d13bbca916c962ceb71:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4784d07cdee746888c03ba1981db4684"><span data-offset-key="4784d07cdee746888c03ba1981db4684:0">The </span><span data-offset-key="4784d07cdee746888c03ba1981db4684:1">`array`</span><span data-offset-key="4784d07cdee746888c03ba1981db4684:2"> module in the standard library has an unusual approach to initialization: you pass it an existing sequence, such as a large list, and it converts the data into the datatype of your array if possible; however, you </span><span data-offset-key="4784d07cdee746888c03ba1981db4684:3">*can*</span><span data-offset-key="4784d07cdee746888c03ba1981db4684:4"> also create an array from a short sequence, after which you expand it to its full size. Have you ever wondered which is faster? In a moment, we’ll create a </span><span data-offset-key="4784d07cdee746888c03ba1981db4684:5">*timing*</span><span data-offset-key="4784d07cdee746888c03ba1981db4684:6"> context manager to measure this and know for sure</span></span><span data-slate-void="true" data-key="8b2f9c485a4e4baba9e8c746007411a0"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="8b2f9c485a4e4baba9e8c746007411a0"><embed src="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO6-1" class="image-67b14f24--image-54d049be" /></span></span><span data-key="2f66a38c09cf4ed191ea4ca560b92f2e"><span data-offset-key="2f66a38c09cf4ed191ea4ca560b92f2e:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="647c105f272c4a66935b75efbeceaa26"><span data-offset-key="647c105f272c4a66935b75efbeceaa26:0">The key step you need to do to make your own context manager is to use the </span><span data-offset-key="647c105f272c4a66935b75efbeceaa26:1">`@contextmanager`</span><span data-offset-key="647c105f272c4a66935b75efbeceaa26:2"> decorator.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO6-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="3ec4c7c113b5469d87d212f3ce452233"><span data-offset-key="3ec4c7c113b5469d87d212f3ce452233:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="663371bd4ff541b98e78186172e273c8"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="663371bd4ff541b98e78186172e273c8"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="19bc6f0c6c1e414eaa29f0610ae712d9"><span data-offset-key="19bc6f0c6c1e414eaa29f0610ae712d9:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="086fcb8e5be6490c8d2a4ff42ad620bf"><span data-offset-key="086fcb8e5be6490c8d2a4ff42ad620bf:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b3a6fd0249c54484a1c0c17b801916ce"><span data-offset-key="b3a6fd0249c54484a1c0c17b801916ce:0">The section before the </span><span data-offset-key="b3a6fd0249c54484a1c0c17b801916ce:1">`yield`</span><span data-offset-key="b3a6fd0249c54484a1c0c17b801916ce:2"> is where you can write code that must execute before the </span><span data-offset-key="b3a6fd0249c54484a1c0c17b801916ce:3">*body*</span><span data-offset-key="b3a6fd0249c54484a1c0c17b801916ce:4"> of your context manager will run. Here we record the timestamp </span><span data-offset-key="b3a6fd0249c54484a1c0c17b801916ce:5">*before*</span><span data-offset-key="b3a6fd0249c54484a1c0c17b801916ce:6"> the body will run.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO6-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="879723aef8f4419abdbe902cbb223a8d"><span data-offset-key="879723aef8f4419abdbe902cbb223a8d:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="a759776a4a224b6987ac3efbe431f756"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="a759776a4a224b6987ac3efbe431f756"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="907642415f5c4b55b0beb7062fa7b673"><span data-offset-key="907642415f5c4b55b0beb7062fa7b673:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="d771b76aae2943d9ae6990463bd99bc5"><span data-offset-key="d771b76aae2943d9ae6990463bd99bc5:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="19dacb8188894dd68da27c8b5df1df21"><span data-offset-key="19dacb8188894dd68da27c8b5df1df21:0">The </span><span data-offset-key="19dacb8188894dd68da27c8b5df1df21:1">`yield`</span><span data-offset-key="19dacb8188894dd68da27c8b5df1df21:2"> is where execution is transferred to the body of your context manager; in our case, this is where our arrays get created. You can also return data: here I return a closure that will calculate the elapsed time when called. It’s a little </span><span data-offset-key="19dacb8188894dd68da27c8b5df1df21:3">*clever*</span><span data-offset-key="19dacb8188894dd68da27c8b5df1df21:4"> but hopefully not excessively so: the </span><span data-offset-key="19dacb8188894dd68da27c8b5df1df21:5">*final time*</span><span data-offset-key="19dacb8188894dd68da27c8b5df1df21:6"> </span><span data-offset-key="19dacb8188894dd68da27c8b5df1df21:7">`t1`</span><span data-offset-key="19dacb8188894dd68da27c8b5df1df21:8"> is captured within the closure even though it will only be determined on the next line.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO6-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="f298a78c1fc54211ac56b15d0a286d49"><span data-offset-key="f298a78c1fc54211ac56b15d0a286d49:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="f71e64c8112142e3b8fcbf4652bd6298"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="f71e64c8112142e3b8fcbf4652bd6298"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/5.png" alt="5" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="416ff15b15fc483b95e70b4361a69552"><span data-offset-key="416ff15b15fc483b95e70b4361a69552:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="ac62b6ea1a724906b39c15f0fd635f35"><span data-offset-key="ac62b6ea1a724906b39c15f0fd635f35:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8f5ccbc65d924127a78b60e861b6a381"><span data-offset-key="8f5ccbc65d924127a78b60e861b6a381:0">After the </span><span data-offset-key="8f5ccbc65d924127a78b60e861b6a381:1">`yield`</span><span data-offset-key="8f5ccbc65d924127a78b60e861b6a381:2">, we write the code that will be executed when the context manager finishes. For scenarios like file handling, this would be where you close them. In this example, this is where we record the final time </span><span data-offset-key="8f5ccbc65d924127a78b60e861b6a381:3">`t1`</span><span data-offset-key="8f5ccbc65d924127a78b60e861b6a381:4">.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO6-7" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="bda2314e993346e989dbd1e87d0491be"><span data-offset-key="bda2314e993346e989dbd1e87d0491be:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="dda53b31c40a48d9b4f2fb43621f2019"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="dda53b31c40a48d9b4f2fb43621f2019"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/6.png" alt="6" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="25eb5715f7a346b9bbdf6b1e27f5f8f1"><span data-offset-key="25eb5715f7a346b9bbdf6b1e27f5f8f1:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="e64a37ccbea74c7f8eb8000e11a82106"><span data-offset-key="e64a37ccbea74c7f8eb8000e11a82106:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="346f00414f364e1e8b80c359c05a6a45"><span data-offset-key="346f00414f364e1e8b80c359c05a6a45:0">Here we try the alternative array-creation strategy: first, create the array and then increase size.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO6-5" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="ed26dc8163b64686a48c2db379328ac0"><span data-offset-key="ed26dc8163b64686a48c2db379328ac0:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="5c5304c945634d749468b4766418cf75"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="5c5304c945634d749468b4766418cf75"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/7.png" alt="7" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="00d6e3b36d2a471da454d7d9c675baec"><span data-offset-key="00d6e3b36d2a471da454d7d9c675baec:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="10c5160bb5bd436e9cb2b95214553249"><span data-offset-key="10c5160bb5bd436e9cb2b95214553249:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5ca2b6d320da4f569d8c12ff9d6cebf1"><span data-offset-key="5ca2b6d320da4f569d8c12ff9d6cebf1:0">For fun, we’ll use our awesome, new context manager to also measure the total time.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7a36945603f548f58921b61ecfa7db79"><span data-offset-key="7a36945603f548f58921b61ecfa7db79:0">On my computer, this code produces this output:</span></span></span>

    Total [Array tests]: 0.064896 s    Timing [Array creation innermul]: 0.064195 s    Timing [Array creation outermul]: 0.000659 s

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9b46aba55b2747bfa1417f040d8ddd1d"><span data-offset-key="9b46aba55b2747bfa1417f040d8ddd1d:0">Quite surprisingly, the </span><span data-offset-key="9b46aba55b2747bfa1417f040d8ddd1d:1">*second*</span><span data-offset-key="9b46aba55b2747bfa1417f040d8ddd1d:2"> method of producing a large array is around 100 times faster than the first. This means that it is </span><span data-offset-key="9b46aba55b2747bfa1417f040d8ddd1d:3">*much*</span><span data-offset-key="9b46aba55b2747bfa1417f040d8ddd1d:4"> more efficient to create a small array, and then expand it, rather than to create an array entirely from a large list.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="115ab479d7014a81bb23d71560cc5776"><span data-offset-key="115ab479d7014a81bb23d71560cc5776:0">The point of this example is not to show the best way to create an array: rather, it is that the </span><span data-offset-key="115ab479d7014a81bb23d71560cc5776:1">`contextmanager`</span><span data-offset-key="115ab479d7014a81bb23d71560cc5776:2"> decorator makes it exceptionally easy to create your own context manager, and context managers are a great way of providing a clean and safe means of managing before-and-after coding tasks.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="02490a7b51cf437883548b989ac92746"><span data-offset-key="02490a7b51cf437883548b989ac92746:0">concurrent.futures</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d4d9e5fb3ddc431a9cc8257ec3dfdb8a"><span data-offset-key="d4d9e5fb3ddc431a9cc8257ec3dfdb8a:0">The </span></span><a href="http://bit.ly/conc-fut" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="9070fa72710c45ebbeea41191eb7f9dd"><span data-offset-key="9070fa72710c45ebbeea41191eb7f9dd:0"><code class="code-0458e21e" spellcheck="false" data-slate-leaf="true">concurrent.futures</code></span></span></a><span data-key="d187bbaf06c14197928ec53284993e56"><span data-offset-key="d187bbaf06c14197928ec53284993e56:0"> module that was introduced in Python 3 provides a convenient way to manage pools of workers. If you have previously used the threading module in the Python standard library, you will have seen code like this before:</span></span></span>

    import threading​def work():    return sum(x for x in range(1000000))​thread = threading.Thread(target=work)thread.start()thread.join()

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6291a312d8ea4f47b2c7b4fe8c4d3b27"><span data-offset-key="6291a312d8ea4f47b2c7b4fe8c4d3b27:0">This code is very clean with only one thread, but with many threads it can become quite tricky to deal with sharing work between them. Also, in this example the result of the </span><span data-offset-key="6291a312d8ea4f47b2c7b4fe8c4d3b27:1">`sum`</span><span data-offset-key="6291a312d8ea4f47b2c7b4fe8c4d3b27:2"> is not obtained from the work function, simply to avoid all the extra code that would be required to do so. There are various techniques for obtaining the result of a work function, such as passing a queue to the function, or subclassing </span><span data-offset-key="6291a312d8ea4f47b2c7b4fe8c4d3b27:3">`threading.Thread`</span><span data-offset-key="6291a312d8ea4f47b2c7b4fe8c4d3b27:4">, but we’re not going discuss them any further, because the </span></span><a href="http://bit.ly/multipr-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="88bb61534941454fb6b292b9381da1fd"><span data-offset-key="88bb61534941454fb6b292b9381da1fd:0">multiprocessing</span></span></a><span data-key="e957874434f3458aa6ea6f64dc68be31"><span data-offset-key="e957874434f3458aa6ea6f64dc68be31:0"> package provides a better method for using pools, and the </span><span data-offset-key="e957874434f3458aa6ea6f64dc68be31:1">`concurrent.futures`</span><span data-offset-key="e957874434f3458aa6ea6f64dc68be31:2"> module goes even further to simplify the interface. And, similar to multiprocessing, both thread-based pools and process-based pools have the same interface making it easy to switch between either thread-based or process-based approaches.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5573acb75459425381b9b859edaa4899"><span data-offset-key="5573acb75459425381b9b859edaa4899:0">Here we have a trivial example using the </span><span data-offset-key="5573acb75459425381b9b859edaa4899:1">`ThreadPoolExecutor`</span><span data-offset-key="5573acb75459425381b9b859edaa4899:2">. We download the landing page of a plethora of popular social media sites, and, to keep the example simple, we print out the size of each. Note that in the results, we show only the first four to keep the output short.</span></span></span>

    from concurrent.futures import ThreadPoolExecutor as Executor​urls = """google twitter facebook youtube pinterest tumblrinstagram reddit flickr meetup classmates microsoft applelinkedin xing renren disqus snapchat twoo whatsapp""".split()​def fetch(url):      from urllib import request, error      try:        data = request.urlopen(url).read()        return '{}: length {}'.format(url, len(data))    except error.HTTPError as e:        return '{}: {}'.format(url, e)​with Executor(max_workers=4) as exe:      template = 'http://www.{}.com'    jobs = [exe.submit(        fetch, template.format(u)) for u in urls]      results = [job.result() for job in jobs]  ​print('\n'.join(results))

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="093a0c17de5846ce9eecc10dd50db804"><span data-offset-key="093a0c17de5846ce9eecc10dd50db804:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO7-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="8041ce1bca11475fa02855621ecfb686"><span data-offset-key="8041ce1bca11475fa02855621ecfb686:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="8e2cf925b2b34aefa54d300f7738bbb7"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="8e2cf925b2b34aefa54d300f7738bbb7"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="62806feb90ca417f8c8a5047615b7ad0"><span data-offset-key="62806feb90ca417f8c8a5047615b7ad0:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="6c421eae0aac40d78655011339f1770c"><span data-offset-key="6c421eae0aac40d78655011339f1770c:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6513a82b8d164428bbafa2c6260ceabf"><span data-offset-key="6513a82b8d164428bbafa2c6260ceabf:0">Our work function, </span><span data-offset-key="6513a82b8d164428bbafa2c6260ceabf:1">`fetch()`</span><span data-offset-key="6513a82b8d164428bbafa2c6260ceabf:2">, simply downloads the given URL.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO7-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="60eb00c21b7c4d3cbf56520f70cf2617"><span data-offset-key="60eb00c21b7c4d3cbf56520f70cf2617:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="90aeb2c87c9942888fd4a4961d806297"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="90aeb2c87c9942888fd4a4961d806297"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="ef13a75cd9ee4a1bba6629b39799da0e"><span data-offset-key="ef13a75cd9ee4a1bba6629b39799da0e:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="25ae59f658f642bcba872f121af7715c"><span data-offset-key="25ae59f658f642bcba872f121af7715c:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="775d9c39a0a949f9893f4b6b10cb0290"><span data-offset-key="775d9c39a0a949f9893f4b6b10cb0290:0">Yes, it </span><span data-offset-key="775d9c39a0a949f9893f4b6b10cb0290:1">*is*</span><span data-offset-key="775d9c39a0a949f9893f4b6b10cb0290:2"> rather odd nowadays to see </span><span data-offset-key="775d9c39a0a949f9893f4b6b10cb0290:3">`urllib`</span><span data-offset-key="775d9c39a0a949f9893f4b6b10cb0290:4"> because the fantastic third-party library </span></span><a href="http://bit.ly/py-reqs" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="48ef23be5a9e46e5989965356849f951"><span data-offset-key="48ef23be5a9e46e5989965356849f951:0">requests</span></span></a><span data-key="1b49a246fa534a4f83608d65ec0c442c"><span data-offset-key="1b49a246fa534a4f83608d65ec0c442c:0"> is a great choice for all your web-access needs. However, </span><span data-offset-key="1b49a246fa534a4f83608d65ec0c442c:1">`urllib`</span><span data-offset-key="1b49a246fa534a4f83608d65ec0c442c:2"> still exists and depending on your needs, may allow you to avoid an external dependency.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO7-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="cb2df5eb214b4368a965c23df7a27676"><span data-offset-key="cb2df5eb214b4368a965c23df7a27676:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="6f836763924e44e6925a2a870d653e78"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="6f836763924e44e6925a2a870d653e78"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="d43920e4bd4b4b8180f2c432acbc014b"><span data-offset-key="d43920e4bd4b4b8180f2c432acbc014b:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="5c1d46c7dd0f4b7fa1eeb3790d2d2e82"><span data-offset-key="5c1d46c7dd0f4b7fa1eeb3790d2d2e82:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3791e02dba644252a74c4b2d69e5b026"><span data-offset-key="3791e02dba644252a74c4b2d69e5b026:0">We create a </span><span data-offset-key="3791e02dba644252a74c4b2d69e5b026:1">`ThreadPoolExecutor`</span><span data-offset-key="3791e02dba644252a74c4b2d69e5b026:2"> instance, and here you can specify how many workers are required.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO7-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="0b4c2eeaaec24e7fa141be5169068ab2"><span data-offset-key="0b4c2eeaaec24e7fa141be5169068ab2:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="4a92a0ebc0db4832b5c0a08480d0de3a"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="4a92a0ebc0db4832b5c0a08480d0de3a"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="b4b09c9c7bb64f9ea6ad056450a2e209"><span data-offset-key="b4b09c9c7bb64f9ea6ad056450a2e209:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="919d1d3dea4d47b58f5418bc1950c03a"><span data-offset-key="919d1d3dea4d47b58f5418bc1950c03a:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c4aaf87d30514be7b01c5dc8da7d62b9"><span data-offset-key="c4aaf87d30514be7b01c5dc8da7d62b9:0">*Jobs*</span><span data-offset-key="c4aaf87d30514be7b01c5dc8da7d62b9:1"> are created, one for every URL in our considerable list. The </span><span data-offset-key="c4aaf87d30514be7b01c5dc8da7d62b9:2">*executor*</span><span data-offset-key="c4aaf87d30514be7b01c5dc8da7d62b9:3"> manages the delivery of jobs to the four threads.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO7-5" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="a1542ffa012a44aca8b6d4929e992e55"><span data-offset-key="a1542ffa012a44aca8b6d4929e992e55:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="aa8b4a4d9f444ddaa2e478d9b7cc637d"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="aa8b4a4d9f444ddaa2e478d9b7cc637d"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/5.png" alt="5" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="fdff9fb882064a298c9a7580ef102f57"><span data-offset-key="fdff9fb882064a298c9a7580ef102f57:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="563d7a3f9a7d495e92fba20c72c01d8b"><span data-offset-key="563d7a3f9a7d495e92fba20c72c01d8b:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="71202f6f03f4434bbcdce52630591759"><span data-offset-key="71202f6f03f4434bbcdce52630591759:0">This is a simple way of waiting for all the threads to return.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b7cd538fcf9b469190f4c57ca164c804"><span data-offset-key="b7cd538fcf9b469190f4c57ca164c804:0">This produces the following output (I’ve shortened the number of results for brevity):</span></span></span>

    http://www.google.com: length 10560http://www.twitter.com: length 268924http://www.facebook.com: length 56667http://www.youtube.com: length 437754[snip]

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1d7097d64e124a6fb5f1ba65e82d1fe6"><span data-offset-key="1d7097d64e124a6fb5f1ba65e82d1fe6:0">Even though one job is created for every URL, we limit the number of active threads to only four using </span><span data-offset-key="1d7097d64e124a6fb5f1ba65e82d1fe6:1">`max_workers`</span><span data-offset-key="1d7097d64e124a6fb5f1ba65e82d1fe6:2"> and the results are all captured in the results list as they become available. If you wanted to use processes instead of threads, all that needs to change is the first line, from this:</span></span></span>

    from concurrent.futures import ThreadPoolExecutor as Executor

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5a0cbcba92324aadbfd0ec721258ab83"><span data-offset-key="5a0cbcba92324aadbfd0ec721258ab83:0">To this:</span></span></span>

    from concurrent.futures import ProcessPoolExecutor as Executor

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d3e5280a8f5e433cb6d5d98dd118663f"><span data-offset-key="d3e5280a8f5e433cb6d5d98dd118663f:0">Of course, for this kind of application, which is limited by network latency, a thread-based pool is fine. It is with CPU-bound tasks that Python threads are problematic because of how thread safety has been in implemented inside the CPython</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737067445472" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="02df0f61b7ef4976857c179b62e27d14"><span data-offset-key="02df0f61b7ef4976857c179b62e27d14:0">3</span></span></a><span data-key="2a62e0986e44478195a74444ece467e8"><span data-offset-key="2a62e0986e44478195a74444ece467e8:0"> runtime interpreter, and in these situations it is best to use a process-based pool instead.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d37be7c1ee694cf2ad7d6641134b494b"><span data-offset-key="d37be7c1ee694cf2ad7d6641134b494b:0">The primary problem with using processes for parallelism is that each process is confined to its own memory space, which makes it difficult for multiple workers to chew on the same large chunk of data. There are ways to get around this, but in such situations threads provide a much simpler programming model. However, as we shall see in </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#cython" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="e6efe2436e1c4e5f911be4791ffc64a5"><span data-offset-key="e6efe2436e1c4e5f911be4791ffc64a5:0">“Cython”</span></span></a><span data-key="f4af2f6cba8b44389afe37fe1f99e25e"><span data-offset-key="f4af2f6cba8b44389afe37fe1f99e25e:0">, there is a third-party package called Cython that makes it very easy to circumvent this problem with threads.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="db5153219e9545a4be9d5330888d3b57"><span data-offset-key="db5153219e9545a4be9d5330888d3b57:0">logging</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="bac1f3d516c445aaa067e07838df4dad"><span data-offset-key="bac1f3d516c445aaa067e07838df4dad:0">The </span><span data-offset-key="bac1f3d516c445aaa067e07838df4dad:1">`logging`</span><span data-offset-key="bac1f3d516c445aaa067e07838df4dad:2"> module is very well known in the web development community, but is far less used in other domains, such as the scientific one; this is unfortunate, because even for general use, the logging module is far superior to the </span><span data-offset-key="bac1f3d516c445aaa067e07838df4dad:3">`print()`</span><span data-offset-key="bac1f3d516c445aaa067e07838df4dad:4"> function. It doesn’t seem that way at first, because the </span><span data-offset-key="bac1f3d516c445aaa067e07838df4dad:5">`print()`</span><span data-offset-key="bac1f3d516c445aaa067e07838df4dad:6"> function is so simple; however, once you initialize </span><span data-offset-key="bac1f3d516c445aaa067e07838df4dad:7">`logging`</span><span data-offset-key="bac1f3d516c445aaa067e07838df4dad:8">, it can look very similar. For instance, compare these two:</span></span></span>

    print('This is output to the console')​logger.debug('This is output to the console')

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3c0981610c734175b9177c2e4bc81956"><span data-offset-key="3c0981610c734175b9177c2e4bc81956:0">The huge advantage of the latter is that, with a single change to a setting on the logger instance, you can either show or hide all your debugging messages. This means you no longer have to go through the process of commenting and uncommenting your </span><span data-offset-key="3c0981610c734175b9177c2e4bc81956:1">`print()`</span><span data-offset-key="3c0981610c734175b9177c2e4bc81956:2"> statements in order to show or hide them. </span><span data-offset-key="3c0981610c734175b9177c2e4bc81956:3">`logging`</span><span data-offset-key="3c0981610c734175b9177c2e4bc81956:4"> also gives you a few different </span><span data-offset-key="3c0981610c734175b9177c2e4bc81956:5">*levels*</span><span data-offset-key="3c0981610c734175b9177c2e4bc81956:6"> so that you can adjust the verbosity of output in your programs. Here’s an example of different levels:</span></span></span>

    logger.debug('This is for debugging. Very talkative!')logger.info('This is for normal chatter')logger.warning('Warnings should almost always be seen.')logger.error('You definitely want to see all errors!')logger.critical('Last message before a program crash!')

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="06cd5eb778724d668b6e108871e7d08a"><span data-offset-key="06cd5eb778724d668b6e108871e7d08a:0">Another really neat trick is that when you use logging, writing messages during exception handling is a whole lot easier. You don’t have to deal with </span><span data-offset-key="06cd5eb778724d668b6e108871e7d08a:1">`sys.exc_info()`</span><span data-offset-key="06cd5eb778724d668b6e108871e7d08a:2"> and the </span><span data-offset-key="06cd5eb778724d668b6e108871e7d08a:3">`traceback`</span><span data-offset-key="06cd5eb778724d668b6e108871e7d08a:4"> module merely for printing out the exception message with a traceback. You can do this instead:</span></span></span>

    try:    1/0except:    logger.exception("Something failed:")

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4f744720a139471087e4726664a54569"><span data-offset-key="4f744720a139471087e4726664a54569:0">Just those four lines produces a full traceback in the output:</span></span></span>

    ERROR:root:Something failed:Traceback (most recent call last):  File "logtb.py", line 5, in <module>    1/0ZeroDivisionError: division by zero

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="41dbeab363014a32b1458b8793781e5c"><span data-offset-key="41dbeab363014a32b1458b8793781e5c:0">Earlier I said that logging requires some setup. The documentation for the </span><span data-offset-key="41dbeab363014a32b1458b8793781e5c:1">`logging`</span><span data-offset-key="41dbeab363014a32b1458b8793781e5c:2"> module is extensive and might seem overwhelming; here is a quick recipe to get you started:</span></span></span>

    # Top of the fileimport logginglogger = logging.getLogger()  ​# All your normal code goes heredef blah():    return 'blah'​# Bottom of the fileif __name__ == '__main__':    logging.basicConfig(level=logging.DEBUG)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e36bb2112e6e466ea58090352cc53bfa"><span data-offset-key="e36bb2112e6e466ea58090352cc53bfa:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO8-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="1902909a188849949c52ef3e8655bc45"><span data-offset-key="1902909a188849949c52ef3e8655bc45:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="4e0585b196c244e28ababbb3a164500c"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="4e0585b196c244e28ababbb3a164500c"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="fae482f37a2b4b788392493c27092dd6"><span data-offset-key="fae482f37a2b4b788392493c27092dd6:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="214cb7a8ad0a44ba9a8ba87706d94955"><span data-offset-key="214cb7a8ad0a44ba9a8ba87706d94955:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4ef9e0ac306d4fd6962d88c5cf6f1d8e"><span data-offset-key="4ef9e0ac306d4fd6962d88c5cf6f1d8e:0">Without arguments, the </span><span data-offset-key="4ef9e0ac306d4fd6962d88c5cf6f1d8e:1">`getLogger()`</span><span data-offset-key="4ef9e0ac306d4fd6962d88c5cf6f1d8e:2"> function returns the </span><span data-offset-key="4ef9e0ac306d4fd6962d88c5cf6f1d8e:3">*root*</span><span data-offset-key="4ef9e0ac306d4fd6962d88c5cf6f1d8e:4"> logger, but it’s more common to create a </span><span data-offset-key="4ef9e0ac306d4fd6962d88c5cf6f1d8e:5">*named*</span><span data-offset-key="4ef9e0ac306d4fd6962d88c5cf6f1d8e:6"> logger. If you’re just starting out, exploring with the root logger is fine.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO8-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="830d2b89d1ca4b1cb5f019eae6956327"><span data-offset-key="830d2b89d1ca4b1cb5f019eae6956327:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="b19c3e13454f4a2688af8d5bba14a308"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="b19c3e13454f4a2688af8d5bba14a308"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="b35feb97eb5440809c9e8f968fdbc27e"><span data-offset-key="b35feb97eb5440809c9e8f968fdbc27e:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="3ad9980962e140ed8a83682bc969d8aa"><span data-offset-key="3ad9980962e140ed8a83682bc969d8aa:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0a7037bb1a4b4fbf9ab45d653418aba0"><span data-offset-key="0a7037bb1a4b4fbf9ab45d653418aba0:0">You need to call a </span><span data-offset-key="0a7037bb1a4b4fbf9ab45d653418aba0:1">`config`</span><span data-offset-key="0a7037bb1a4b4fbf9ab45d653418aba0:2"> method; otherwise, calls to the logger will not log anything. The config step is necessary.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="536977bcb267415bbe051680168d9c6f"><span data-offset-key="536977bcb267415bbe051680168d9c6f:0">In the preceding </span><span data-offset-key="536977bcb267415bbe051680168d9c6f:1">`basicConfig()`</span><span data-offset-key="536977bcb267415bbe051680168d9c6f:2"> line, by changing only </span><span data-offset-key="536977bcb267415bbe051680168d9c6f:3">`logging.DEBUG`</span><span data-offset-key="536977bcb267415bbe051680168d9c6f:4"> to, say, </span><span data-offset-key="536977bcb267415bbe051680168d9c6f:5">`logging.WARNING`</span><span data-offset-key="536977bcb267415bbe051680168d9c6f:6">, you can affect which messages get processed and which don’t.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="896a7d0c4d3c40cabcd83f9689808a8c"><span data-offset-key="896a7d0c4d3c40cabcd83f9689808a8c:0">Finally, there’s a neat trick you can use for easily changing the logging level on the command line. Python scripts that are directly executable usually have the startup code in a conditional block beginning with </span><span data-offset-key="896a7d0c4d3c40cabcd83f9689808a8c:1">`if __name__ == '__main__'`</span><span data-offset-key="896a7d0c4d3c40cabcd83f9689808a8c:2">. This is where </span><span data-offset-key="896a7d0c4d3c40cabcd83f9689808a8c:3">*command-line parameters*</span><span data-offset-key="896a7d0c4d3c40cabcd83f9689808a8c:4"> are handled, e.g., using the </span><span data-offset-key="896a7d0c4d3c40cabcd83f9689808a8c:5">`argparse`</span><span data-offset-key="896a7d0c4d3c40cabcd83f9689808a8c:6"> library in the Python standard library. We can create command-line arguments specifically for the logging level:</span></span></span>

    # Bottom of the fileif __name__ == '__main__':    from argparse import ArgumentParser    parser = ArgumentParser(description='My app which is mine')    parser.add_argument('-ll', '--loglevel',        type=str,        choices=['DEBUG','INFO','WARNING','ERROR','CRITICAL'],        help='Set the logging level')    args = parser.parseargs()    logging.basicConfig(level=args.loglevel)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="844f94382056432eabc5f71855967492"><span data-offset-key="844f94382056432eabc5f71855967492:0">With this setup, if you call your program with</span></span></span>

    $ python main.py -ll DEBUG

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7b0b0531ab994f219c0a3650bbc12682"><span data-offset-key="7b0b0531ab994f219c0a3650bbc12682:0">it will run with the logging level set to </span><span data-offset-key="7b0b0531ab994f219c0a3650bbc12682:1">`DEBUG`</span><span data-offset-key="7b0b0531ab994f219c0a3650bbc12682:2"> (so all logger messages will be shown), whereas if you run it with</span></span></span>

    $ python main.py -ll WARNING

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="88619dec93874e6fa4aabed7b8bb2fe5"><span data-offset-key="88619dec93874e6fa4aabed7b8bb2fe5:0">it will run at the </span><span data-offset-key="88619dec93874e6fa4aabed7b8bb2fe5:1">`WARNING`</span><span data-offset-key="88619dec93874e6fa4aabed7b8bb2fe5:2"> level for logging, so all </span><span data-offset-key="88619dec93874e6fa4aabed7b8bb2fe5:3">`INFO`</span><span data-offset-key="88619dec93874e6fa4aabed7b8bb2fe5:4"> and </span><span data-offset-key="88619dec93874e6fa4aabed7b8bb2fe5:5">`DEBUG`</span><span data-offset-key="88619dec93874e6fa4aabed7b8bb2fe5:6"> logger messages will be hidden.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="274e81e79fe44d27acf5d810ab9ad7ab"><span data-offset-key="274e81e79fe44d27acf5d810ab9ad7ab:0">There are many more features packed into the </span><span data-offset-key="274e81e79fe44d27acf5d810ab9ad7ab:1">`logging`</span><span data-offset-key="274e81e79fe44d27acf5d810ab9ad7ab:2"> module, but I hope I’ve convinced you to consider using it instead of using </span><span data-offset-key="274e81e79fe44d27acf5d810ab9ad7ab:3">`print()`</span><span data-offset-key="274e81e79fe44d27acf5d810ab9ad7ab:4"> for your next program. There is much more information about the </span><span data-offset-key="274e81e79fe44d27acf5d810ab9ad7ab:5">`logging`</span><span data-offset-key="274e81e79fe44d27acf5d810ab9ad7ab:6"> module online, both in the official Python documentation and elsewhere in blogs and tutorials. The goal here is only to convince you that the </span><span data-offset-key="274e81e79fe44d27acf5d810ab9ad7ab:7">`logging`</span><span data-offset-key="274e81e79fe44d27acf5d810ab9ad7ab:8"> module is worth investigating, and getting started with it is easy to do.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="0deaaf21f77e4b76b278f4e963ffd08b"><span data-offset-key="0deaaf21f77e4b76b278f4e963ffd08b:0">sched</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9e351d18c690428cb2f958aae242eeab"><span data-offset-key="9e351d18c690428cb2f958aae242eeab:0">There is increasing interest in the creation of bots</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737067174608" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="6642403f24414fa08fc5883c4fcce387"><span data-offset-key="6642403f24414fa08fc5883c4fcce387:0">4</span></span></a><span data-key="2d69c273c9e74d5e85a7f1d786830b58"><span data-offset-key="2d69c273c9e74d5e85a7f1d786830b58:0"> and other monitoring and automation applications. For these applications, a common requirement is to perform actions at specified times or specified intervals. This functionality is provided by the </span><span data-offset-key="2d69c273c9e74d5e85a7f1d786830b58:1">`sched`</span><span data-offset-key="2d69c273c9e74d5e85a7f1d786830b58:2"> module in the standard library. There are already similar tools provided by operating systems, such as </span><span data-offset-key="2d69c273c9e74d5e85a7f1d786830b58:3">`cron`</span><span data-offset-key="2d69c273c9e74d5e85a7f1d786830b58:4"> on Linux and </span><span data-offset-key="2d69c273c9e74d5e85a7f1d786830b58:5">*Windows Task Scheduler*</span><span data-offset-key="2d69c273c9e74d5e85a7f1d786830b58:6">, but with Python’s own </span><span data-offset-key="2d69c273c9e74d5e85a7f1d786830b58:7">`sched`</span><span data-offset-key="2d69c273c9e74d5e85a7f1d786830b58:8"> module you can ignore these platform differences, as well as incorporate scheduled tasks into a program that might have many other functions.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6f86f300a02a40b7b9c925a5302dd82c"><span data-offset-key="6f86f300a02a40b7b9c925a5302dd82c:0">The </span></span><a href="http://bit.ly/sched-docs" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="3e8273a8d7fe4752a06fd6660d8c115e"><span data-offset-key="3e8273a8d7fe4752a06fd6660d8c115e:0">documentation</span></span></a><span data-key="cb1a24eab5d040c48516d0c608076852"><span data-offset-key="cb1a24eab5d040c48516d0c608076852:0"> for sched is rather terse, but hopefully these examples will get you started. The easy way to begin is to schedule a function to be executed after a specified delay (this is a complete example to make sure you can run it successfully):</span></span></span>

    import schedimport timefrom datetime import datetime, timedelta​scheduler = sched.scheduler(timefunc=time.time)  ​def saytime():      print(time.ctime())    scheduler.enter(10, priority=0, action=saytime)  ​saytime()try:    scheduler.run(blocking=True)  except KeyboardInterrupt:    print('Stopped.')

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="bff0ed5bc4bc47f9854a0a8f8398fd4a"><span data-offset-key="bff0ed5bc4bc47f9854a0a8f8398fd4a:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO9-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="0a921d15467242db8d6c8cfc9cbf83d9"><span data-offset-key="0a921d15467242db8d6c8cfc9cbf83d9:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="82885fea2bba46078109dc14fe8e4599"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="82885fea2bba46078109dc14fe8e4599"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="36526a5464474be1a0cd37cba7f41f56"><span data-offset-key="36526a5464474be1a0cd37cba7f41f56:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="ef4b18e4a02d4f6c89b455648f8928aa"><span data-offset-key="ef4b18e4a02d4f6c89b455648f8928aa:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3c19a6b794b048fcaf6853c927276097"><span data-offset-key="3c19a6b794b048fcaf6853c927276097:0">A scheduler instance is created.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO9-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="5f73842137714c469e9080313da187e0"><span data-offset-key="5f73842137714c469e9080313da187e0:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="3386b365913c4321a4cb9766b0f0d4bd"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="3386b365913c4321a4cb9766b0f0d4bd"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="3f3280d4e0a04e8da074a9e9d3aaf079"><span data-offset-key="3f3280d4e0a04e8da074a9e9d3aaf079:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="0e24fdb3748d492e9a0a9cad4a5fdd56"><span data-offset-key="0e24fdb3748d492e9a0a9cad4a5fdd56:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3ca02359584b406ca5016eb24bb8b77f"><span data-offset-key="3ca02359584b406ca5016eb24bb8b77f:0">A work function is declared, in our case </span><span data-offset-key="3ca02359584b406ca5016eb24bb8b77f:1">`saytime()`</span><span data-offset-key="3ca02359584b406ca5016eb24bb8b77f:2">, which simply prints out the current time.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO9-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="595b0f32e1e94deaaaf320f602385cab"><span data-offset-key="595b0f32e1e94deaaaf320f602385cab:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="bdc9bda8589843ae81be2d1c56b3302e"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="bdc9bda8589843ae81be2d1c56b3302e"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="4127f30e12c94ecda2ddd9a6a3d5a86b"><span data-offset-key="4127f30e12c94ecda2ddd9a6a3d5a86b:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="d9cbf0d35ad946f686224c5a5f834f3f"><span data-offset-key="d9cbf0d35ad946f686224c5a5f834f3f:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="69ea8bee1b23470885ee621a0c9a105e"><span data-offset-key="69ea8bee1b23470885ee621a0c9a105e:0">Note that we reschedule the function inside itself, with a ten-second delay.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO9-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="601751e15d504a2fb4ff9fd76ef1a774"><span data-offset-key="601751e15d504a2fb4ff9fd76ef1a774:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="07b2b3c8f49a4b4c8cdd2d9b5e08f456"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="07b2b3c8f49a4b4c8cdd2d9b5e08f456"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="aa77300e10f744969f67926afee5b75b"><span data-offset-key="aa77300e10f744969f67926afee5b75b:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="fc0d6f58b9974c379725604123ee96d4"><span data-offset-key="fc0d6f58b9974c379725604123ee96d4:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1767ca4ef9e641f1b0f2b3533671cf09"><span data-offset-key="1767ca4ef9e641f1b0f2b3533671cf09:0">The scheduler is started with </span><span data-offset-key="1767ca4ef9e641f1b0f2b3533671cf09:1">`run(blocking=True)`</span><span data-offset-key="1767ca4ef9e641f1b0f2b3533671cf09:2">, and the execution point remains here until the program is terminated or Ctrl-C is pressed.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2b6e1f3a26524e79a93a6bf5d0511a91"><span data-offset-key="2b6e1f3a26524e79a93a6bf5d0511a91:0">There are a few annoying details about using </span><span data-offset-key="2b6e1f3a26524e79a93a6bf5d0511a91:1">`sched`</span><span data-offset-key="2b6e1f3a26524e79a93a6bf5d0511a91:2">: you have to pass </span><span data-offset-key="2b6e1f3a26524e79a93a6bf5d0511a91:3">`timefunc=time.time`</span><span data-offset-key="2b6e1f3a26524e79a93a6bf5d0511a91:4"> as this isn’t set by default, and you have to supply a priority even when not required. However, overall, the </span><span data-offset-key="2b6e1f3a26524e79a93a6bf5d0511a91:5">`sched`</span><span data-offset-key="2b6e1f3a26524e79a93a6bf5d0511a91:6"> module still provides a clean way to get </span><span data-offset-key="2b6e1f3a26524e79a93a6bf5d0511a91:7">`cron`</span><span data-offset-key="2b6e1f3a26524e79a93a6bf5d0511a91:8">-like behavior.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8dba58084ca94bd2a74fc085e28b2dae"><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:0">Working with delays can be frustrating if what you </span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:1">*really*</span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:2"> want is for a task to execute at specific times. In addition to </span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:3">`enter()`</span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:4">, a </span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:5">`sched`</span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:6"> instance also provides the </span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:7">`enterabs()`</span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:8"> method with which you can trigger an event at a specific time. We can use that method to trigger a function, say, every </span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:9">*whole*</span><span data-offset-key="8dba58084ca94bd2a74fc085e28b2dae:10"> minute:</span></span></span>

    import schedimport timefrom datetime import datetime, timedelta​scheduler = sched.scheduler(timefunc=time.time)  ​def reschedule():    new_target = datetime.now().replace(        second=0, microsecond=0)      new_target += timedelta(minutes=1)      scheduler.enterabs(        new_target.timestamp(), priority=0, action=saytime)  ​def saytime():    print(time.ctime(), flush=True)    reschedule()​reschedule()try:    scheduler.run(blocking=True)except KeyboardInterrupt:    print('Stopped.')

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6ad4531f05a54c2e953322fcbe7e460d"><span data-offset-key="6ad4531f05a54c2e953322fcbe7e460d:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO10-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="95997fbdc75a4a9cb757bc20b2b03bc5"><span data-offset-key="95997fbdc75a4a9cb757bc20b2b03bc5:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="ccee27223a4c49cdaeb45405b3976ecb"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="ccee27223a4c49cdaeb45405b3976ecb"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="544134ce896a4fb49545aef150ea2caf"><span data-offset-key="544134ce896a4fb49545aef150ea2caf:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="2506d47f16984e6ab1e4414f6bb808c8"><span data-offset-key="2506d47f16984e6ab1e4414f6bb808c8:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5d681527ca934763a0f8baba2d358d03"><span data-offset-key="5d681527ca934763a0f8baba2d358d03:0">Create a </span><span data-offset-key="5d681527ca934763a0f8baba2d358d03:1">`scheduler`</span><span data-offset-key="5d681527ca934763a0f8baba2d358d03:2"> instance, as before.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO10-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="b78ccb07310848ff901420323be72977"><span data-offset-key="b78ccb07310848ff901420323be72977:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="bad253c5a9b1409ca48b739c5da2417f"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="bad253c5a9b1409ca48b739c5da2417f"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="2f996955e1ab40f0a1ede6bffbb7980b"><span data-offset-key="2f996955e1ab40f0a1ede6bffbb7980b:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="51b370b39b9840c3b4ad5a9e939f1e07"><span data-offset-key="51b370b39b9840c3b4ad5a9e939f1e07:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3a5ad12617b64c3a9026074f596a613f"><span data-offset-key="3a5ad12617b64c3a9026074f596a613f:0">Get </span><span data-offset-key="3a5ad12617b64c3a9026074f596a613f:1">*current time*</span><span data-offset-key="3a5ad12617b64c3a9026074f596a613f:2">, but strip off seconds and microseconds to obtain a whole minute.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO10-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="ead6d56b992341738fab52b9f94436b3"><span data-offset-key="ead6d56b992341738fab52b9f94436b3:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="8cc0092c78de4c43a413be80e3b46094"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="8cc0092c78de4c43a413be80e3b46094"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="6a6d435a6c8449eea387a86263f5908d"><span data-offset-key="6a6d435a6c8449eea387a86263f5908d:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="cce5be67fc494be7951795f72bcb9c11"><span data-offset-key="cce5be67fc494be7951795f72bcb9c11:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6a27c8aba5114489970c3dc7b2b9e4b3"><span data-offset-key="6a27c8aba5114489970c3dc7b2b9e4b3:0">The target time is exactly one minute ahead of the current whole minute.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO10-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="df1fe3af0e004e4bb54dac5c18f82f5b"><span data-offset-key="df1fe3af0e004e4bb54dac5c18f82f5b:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="383c8bea567548889109c95588cc398b"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="383c8bea567548889109c95588cc398b"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="af93c100fd2b4562969f604f25da7058"><span data-offset-key="af93c100fd2b4562969f604f25da7058:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="ff59928eb1e4470d82640a027aa6b672"><span data-offset-key="ff59928eb1e4470d82640a027aa6b672:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="53820a15ce1b4c60b7dcaba4c74b6d67"><span data-offset-key="53820a15ce1b4c60b7dcaba4c74b6d67:0">The </span><span data-offset-key="53820a15ce1b4c60b7dcaba4c74b6d67:1">`enterabs()`</span><span data-offset-key="53820a15ce1b4c60b7dcaba4c74b6d67:2"> method schedules the task.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5f512ac77f274537a2aefdd08406e298"><span data-offset-key="5f512ac77f274537a2aefdd08406e298:0">This code produces the following output:</span></span></span>

    Sat Jun 18 18:14:00 2016Sat Jun 18 18:15:00 2016Sat Jun 18 18:16:00 2016Sat Jun 18 18:17:00 2016Stopped.

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c3a449f83898419eb9898dbb7627e6ef"><span data-offset-key="c3a449f83898419eb9898dbb7627e6ef:0">With the growing interest in “Internet of Things” applications, the built-in </span><span data-offset-key="c3a449f83898419eb9898dbb7627e6ef:1">`sched`</span><span data-offset-key="c3a449f83898419eb9898dbb7627e6ef:2"> library provides a convenient way to manage repetitive tasks. The </span></span><a href="http://bit.ly/sched-docs" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="0ce4f6da1ff14fd69937f414c501c817"><span data-offset-key="0ce4f6da1ff14fd69937f414c501c817:0">documentation</span></span></a><span data-key="4556220fcc3c469295c5c34b4bcb91f7"><span data-offset-key="4556220fcc3c469295c5c34b4bcb91f7:0"> provides further information about how to cancel future tasks.</span></span></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="f1642b9a799c4b8b99728f729bc9bd3a"><span data-offset-key="f1642b9a799c4b8b99728f729bc9bd3a:0">In the Wild</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="397c98406d864bd9bf9ff3afb0aa07d1"><span data-offset-key="397c98406d864bd9bf9ff3afb0aa07d1:0">From here on we’ll look at some third-party Python libraries that you might not yet have discovered. There are thousands of excellent packages described at </span></span><a href="http://bit.ly/py-guide" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="82ec83887cb34eca865945c64626f3db"><span data-offset-key="82ec83887cb34eca865945c64626f3db:0">the Python guide</span></span></a><span data-key="21c3add758ff41d9bfa6bceb29dcf391"><span data-offset-key="21c3add758ff41d9bfa6bceb29dcf391:0">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="619f56b2d60e44ef898f5edb30cf84a9"><span data-offset-key="619f56b2d60e44ef898f5edb30cf84a9:0">There are quite a few guides similar to this report that you can find online. There could be as many “favorite Python libraries” lists as there are Python developers, and so the selection presented here is necessarily subjective. I spent a lot of time finding and testing various third-party libraries in order to find these hidden gems.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="234516f6263146e2b8d83e926e797784"><span data-offset-key="234516f6263146e2b8d83e926e797784:0">My selection criteria were that a library should be:</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2b2e9d85f9f243eebb9826e1b53bb5d2"><span data-offset-key="2b2e9d85f9f243eebb9826e1b53bb5d2:0">easy to use</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c0529eb36e2d46cd9a6fd642e44338fa"><span data-offset-key="c0529eb36e2d46cd9a6fd642e44338fa:0">easy to install</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="cae694fa3eca42b39ba9a113c6f7c00e"><span data-offset-key="cae694fa3eca42b39ba9a113c6f7c00e:0">cross-platform</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d579070d292d4610a8d21672aa094027"><span data-offset-key="d579070d292d4610a8d21672aa094027:0">applicable to more than one domain</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2b52d909fe7541bcbc152bc5f0f540be"><span data-offset-key="2b52d909fe7541bcbc152bc5f0f540be:0">not yet super-popular, but likely to become so</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5aa25d20e7e94d09b092b0cd40d38d9d"><span data-offset-key="5aa25d20e7e94d09b092b0cd40d38d9d:0">the </span><span data-offset-key="5aa25d20e7e94d09b092b0cd40d38d9d:1">*X*</span><span data-offset-key="5aa25d20e7e94d09b092b0cd40d38d9d:2"> factor</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4794eedd64c4402a91a63d1c7d029397"><span data-offset-key="4794eedd64c4402a91a63d1c7d029397:0">The last two items in that list bear further explanation.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0c993e3c03bb48c8af822855ec729fa0"><span data-offset-key="0c993e3c03bb48c8af822855ec729fa0:0">Popularity is difficult to define exactly, since different libraries tend to get used to varying degrees within different Python communities. For instance, </span></span><a href="http://www.numpy.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="dbf7037460fe4eb9af2a21d8784679d9"><span data-offset-key="dbf7037460fe4eb9af2a21d8784679d9:0">Numpy</span></span></a><span data-key="d2ac79ef6ccb4296a88866035e492c68"><span data-offset-key="d2ac79ef6ccb4296a88866035e492c68:0"> and </span></span><a href="http://www.scipy.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="4ec216117f094eb99bc133c96fbfdc2d"><span data-offset-key="4ec216117f094eb99bc133c96fbfdc2d:0">Scipy</span></span></a><span data-key="5212fd8f71734b9b8a705e6dea82e6f9"><span data-offset-key="5212fd8f71734b9b8a705e6dea82e6f9:0"> are much more heavily used within the </span><span data-offset-key="5212fd8f71734b9b8a705e6dea82e6f9:1">*scientific*</span><span data-offset-key="5212fd8f71734b9b8a705e6dea82e6f9:2"> Python community, while </span></span><a href="https://www.djangoproject.com/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="930a7ff517e6496d83af683c506d9111"><span data-offset-key="930a7ff517e6496d83af683c506d9111:0">Django</span></span></a><span data-key="c82c76ade58240058b1e7e775300f3e7"><span data-offset-key="c82c76ade58240058b1e7e775300f3e7:0"> and </span></span><a href="http://flask.pocoo.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="5455614bf2a3412e89d821c45b65e7e4"><span data-offset-key="5455614bf2a3412e89d821c45b65e7e4:0">Flask</span></span></a><span data-key="913be151f7ba4852b63083afcdf32b06"><span data-offset-key="913be151f7ba4852b63083afcdf32b06:0"> enjoy more attention in the web development community. Furthermore, the popularity of these libraries is such that everybody already knows about them. A candidate for this list </span><span data-offset-key="913be151f7ba4852b63083afcdf32b06:1">*might*</span><span data-offset-key="913be151f7ba4852b63083afcdf32b06:2"> have been something like </span></span><a href="http://dask.pydata.org/en/latest" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="eb53202afe3e4ef2983ffb326e8f6ff0"><span data-offset-key="eb53202afe3e4ef2983ffb326e8f6ff0:0">Dask</span></span></a><span data-key="79054d5e22b64978821ec7d62fab4c8f"><span data-offset-key="79054d5e22b64978821ec7d62fab4c8f:0">, which seems poised to become an eventual successor to Numpy, but in the medium term it is likely to be mostly applicable to the scientific community, thus failing my applicability test.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a366f8d8b18a47aa8f8486dae40fe3bf"><span data-offset-key="a366f8d8b18a47aa8f8486dae40fe3bf:0">The </span><span data-offset-key="a366f8d8b18a47aa8f8486dae40fe3bf:1">*X*</span><span data-offset-key="a366f8d8b18a47aa8f8486dae40fe3bf:2"> factor means that really cool things are likely to be built with that Python library. Such a criterion is of course strongly subjective, but I hope, in making these selections, to inspire you to experiment and create something new!</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e171ed158f774fa3baf0618393c168ef"><span data-offset-key="e171ed158f774fa3baf0618393c168ef:0">Each of the following chapters describes a library that met all the criteria on my list, and which I think you’ll find useful in your everyday Python activities, no matter your specialization.</span></span></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="72b43b9f1ae047aeb41ecdb0542ac19c"><span data-offset-key="72b43b9f1ae047aeb41ecdb0542ac19c:0">Easier Python Packaging with flit</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="32e7856b419b4737a79819d088fa12a9"><span data-offset-key="32e7856b419b4737a79819d088fa12a9:0"><span data-slate-zero-width="z">​</span></span></span><a href="http://bit.ly/flit-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="924385fd84cc43d28d78b21cf496cafc"><span data-offset-key="924385fd84cc43d28d78b21cf496cafc:0">flit</span></span></a><span data-key="b7a9fecf04404401b1773addcfcfe455"><span data-offset-key="b7a9fecf04404401b1773addcfcfe455:0"> is a tool that dramatically simplifies the process of submitting a Python package to the Python Package Index (PyPI). The </span></span><a href="http://bit.ly/pkg-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="cb7a1abc16214988a65c766ab647f106"><span data-offset-key="cb7a1abc16214988a65c766ab647f106:0">traditional process</span></span></a><span data-key="e323a39906844c9395fdb457c5481f36"><span data-offset-key="e323a39906844c9395fdb457c5481f36:0"> begins by creating a </span><span data-offset-key="e323a39906844c9395fdb457c5481f36:1">`setup.py`</span><span data-offset-key="e323a39906844c9395fdb457c5481f36:2"> file; simply figuring out how to do that requires a considerable amount of work even to understand what to do. In contrast, flit will create its config file interactively, and for typical simple packages you’ll be ready to upload to PyPI almost immediately. Let’s have a look: consider this simple package structure:</span></span></span>

     $ tree.└── mypkg    ├── __init__.py      └── main.py

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="522f66b37f34432eab7fdecc0d6826fd"><span data-offset-key="522f66b37f34432eab7fdecc0d6826fd:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO11-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="4edaa86093ee40c4bcadec96ff9e7a06"><span data-offset-key="4edaa86093ee40c4bcadec96ff9e7a06:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="98c6fd5b9b6948aebb37db7cbb6deee4"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="98c6fd5b9b6948aebb37db7cbb6deee4"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="1cb3e997fd44465097dd42b7bc7e1071"><span data-offset-key="1cb3e997fd44465097dd42b7bc7e1071:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="31e7602fbc684124aedfb9e9db1f9753"><span data-offset-key="31e7602fbc684124aedfb9e9db1f9753:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="547ffbb2aec648e2b512c96baeef98c5"><span data-offset-key="547ffbb2aec648e2b512c96baeef98c5:0">The package’s </span><span data-offset-key="547ffbb2aec648e2b512c96baeef98c5:1">*init*</span><span data-offset-key="547ffbb2aec648e2b512c96baeef98c5:2"> file is a great place to add package information like documentation, version numbers, and author information.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a6c620db426748b19651d4086f98c3e0"><span data-offset-key="a6c620db426748b19651d4086f98c3e0:0">After installing flit into your environment with </span><span data-offset-key="a6c620db426748b19651d4086f98c3e0:1">`pip install flit`</span><span data-offset-key="a6c620db426748b19651d4086f98c3e0:2">, you can run the interactive initializer, which will create your package configuration. It asks only five questions, most of which will have applicable defaults once you have made your first package with </span><span data-offset-key="a6c620db426748b19651d4086f98c3e0:3">`flit`</span><span data-offset-key="a6c620db426748b19651d4086f98c3e0:4">:</span></span></span>

     $ flit initModule name [mypkg]:Author [Caleb Hattingh]:Author email [[email protected]]:Home page [https://github.com/cjrh/mypkg]:Choose a license 1. MIT 2. Apache 3. GPL 4. Skip - choose a license laterEnter 1-4 [2]: 2Written flit.ini; edit that file to add optional extra info.

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4a08a2fc86bf4f759027f2afb88d32c8"><span data-offset-key="4a08a2fc86bf4f759027f2afb88d32c8:0">The final line tells you that a </span><span data-offset-key="4a08a2fc86bf4f759027f2afb88d32c8:1">*flit.ini*</span><span data-offset-key="4a08a2fc86bf4f759027f2afb88d32c8:2"> file was created. Let’s have a look at that:</span></span></span>

     $ cat flit.ini// [metadata]module = mypkgauthor = Caleb Hattinghauthor-email = [email protected]home-page = https://github.com/cjrh/mypkgclassifiers = License :: OSI Approved :: Apache Software License

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="07944f4891804c13ac542e8d90b641dc"><span data-offset-key="07944f4891804c13ac542e8d90b641dc:0">It’s pretty much what we specified in the interactive </span><span data-offset-key="07944f4891804c13ac542e8d90b641dc:1">`flit init`</span><span data-offset-key="07944f4891804c13ac542e8d90b641dc:2"> sequence. Before you can submit our package to the online PyPI, there are two more steps that you must complete. The first is to give your package a docstring. You add this to the </span><span data-offset-key="07944f4891804c13ac542e8d90b641dc:3">*mypkg/\\*</span><span data-offset-key="07944f4891804c13ac542e8d90b641dc:4">\_init\_\_.py</span><span data-offset-key="07944f4891804c13ac542e8d90b641dc:5"> *file at the top using triple quotes (*</span><span data-offset-key="07944f4891804c13ac542e8d90b641dc:6">*`"""`*</span><span data-offset-key="07944f4891804c13ac542e8d90b641dc:7">*). The second is that you must add a line for the version to the same file. Your finished* </span><span data-offset-key="07944f4891804c13ac542e8d90b641dc:8">\_\_init\_\_.py\_ file might look like this:</span></span></span>

    # file: __init__.py""" This is the documentation for the package. """ ​__version__ = '1.0.0'

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="aa6e10a5c73b401a9f05ee5594ce4453"><span data-offset-key="aa6e10a5c73b401a9f05ee5594ce4453:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO12-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="300ea78af5614075bd5321641c7a8361"><span data-offset-key="300ea78af5614075bd5321641c7a8361:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="d02c3fe8cd4d43e2adb72584525f3404"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="d02c3fe8cd4d43e2adb72584525f3404"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="f480766ae3bd45d1ac348dd451148e20"><span data-offset-key="f480766ae3bd45d1ac348dd451148e20:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="89f3d02d0e594ad8a2ded47226b9b877"><span data-offset-key="89f3d02d0e594ad8a2ded47226b9b877:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="794f1d1126b1415e9b33c12152adad28"><span data-offset-key="794f1d1126b1415e9b33c12152adad28:0">This documentation will be used as your package description on PyPI.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO12-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="3ab6f4695d5444919975325d73ca3dad"><span data-offset-key="3ab6f4695d5444919975325d73ca3dad:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="45832d00a69b44d194d7d55b19e68ed3"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="45832d00a69b44d194d7d55b19e68ed3"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="6e032a4988854f68acf2151506220448"><span data-offset-key="6e032a4988854f68acf2151506220448:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="d60bfe8774a348b0b6d2dae717a6e9c7"><span data-offset-key="d60bfe8774a348b0b6d2dae717a6e9c7:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6168f3ed35584cb0a20a6ac568d59c5a"><span data-offset-key="6168f3ed35584cb0a20a6ac568d59c5a:0">Likewise, the version tag within your package will also be reused for PyPI when the package is uploaded. These automatic integrations help to simplify the packaging process. It might not seem like much is gained, but experience with Python packaging will show that too many steps (even when they’re simple), when combined, can lead to a complex packaging experience.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737066652496" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="25038f2551bc407ba8f3c9ce077c5b40"><span data-offset-key="25038f2551bc407ba8f3c9ce077c5b40:0">5</span></span></a><span data-key="0960fd13a6a746b8bdeacf2344783ee6"><span data-offset-key="0960fd13a6a746b8bdeacf2344783ee6:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8432b5a5b3dc4bcc84e7c8f16e36a78e"><span data-offset-key="8432b5a5b3dc4bcc84e7c8f16e36a78e:0">After filling in the basic description and the version, you are ready to build a wheel and upload it to PyPI:</span></span></span>

    $ flit wheel --uploadCopying package file(s) from mypkgWriting metadata filesWriting the record of filesWheel built: dist/mypkg-1.0.0-py2.py3-none-any.whlUsing repository at https://pypi.python.org/pypiUploading dist/mypkg-1.0.0-py2.py3-none-any.whl...Starting new HTTPS connection (1): pypi.python.orgUploading forbidden; trying to register and upload again Starting new HTTPS connection (1): pypi.python.orgRegistered mypkg with PyPIUploading dist/mypkg-1.0.0-py2.py3-none-any.whl...Starting new HTTPS connection (1): pypi.python.orgPackage is at https://pypi.python.org/pypi/mypkg

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3af56a4a1d634c5e965b327217f3b453"><span data-offset-key="3af56a4a1d634c5e965b327217f3b453:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO13-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="72da001906fe429b8bd13eac91f5eb68"><span data-offset-key="72da001906fe429b8bd13eac91f5eb68:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="bc5211c2a0174128b82e33f3846c8515"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="bc5211c2a0174128b82e33f3846c8515"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="f3466c7dd31d4d6d82acfa01d06d2bd9"><span data-offset-key="f3466c7dd31d4d6d82acfa01d06d2bd9:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="e74a84d9fc2c4512bf919aed67db307a"><span data-offset-key="e74a84d9fc2c4512bf919aed67db307a:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="85e1afa7f7b742e6a26014d5fcd08eee"><span data-offset-key="85e1afa7f7b742e6a26014d5fcd08eee:0">Note that flit automatically registers your package if the initial upload fails.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="694fd566e4ac4722b41ac8ca2e3390e5"><span data-offset-key="694fd566e4ac4722b41ac8ca2e3390e5:0">And that’s it! </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#flit_mypkg" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="44992b8da8584e3f97e1db2e29d87fa6"><span data-offset-key="44992b8da8584e3f97e1db2e29d87fa6:0">Figure 1-1</span></span></a><span data-key="7748154b99d949ff9b17c92ef1220b2b"><span data-offset-key="7748154b99d949ff9b17c92ef1220b2b:0"> shows our package on PyPI.</span></span><span data-slate-void="true" data-key="aa2bf7b1b4c7486589fae4245bcda781"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="aa2bf7b1b4c7486589fae4245bcda781"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0401.png" alt="tply 0401" class="image-67b14f24--image-54d049be" /></span></span><span data-key="8a5a44171be1470a8d4c4e23852657a1"><span data-offset-key="8a5a44171be1470a8d4c4e23852657a1:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8dffcb3e86bc447cb6ce817d252000d6"><span data-offset-key="8dffcb3e86bc447cb6ce817d252000d6:0">**Figure 1-1. It’s alive! Our demo package on the PyPI.**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6ddce24d65c1463bbd692633d97ec73e"><span data-offset-key="6ddce24d65c1463bbd692633d97ec73e:0">`flit`</span><span data-offset-key="6ddce24d65c1463bbd692633d97ec73e:1"> allows you to specify more options, but for simple packages what you see here can get you pretty far.</span></span></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="29e56b5b4f0745958abcc2b0e8007acd"><span data-offset-key="29e56b5b4f0745958abcc2b0e8007acd:0">Command-Line Applications</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="444b44206886449b8eb10036e4b8d6f7"><span data-offset-key="444b44206886449b8eb10036e4b8d6f7:0">If you’ve spent any time whatsoever developing Python code, you will surely have used several command-line applications. Some command-line programs seem much friendlier than others, and in this chapter we show two fantastic libraries that will make it easy for you to offer the best experience for users of your own command-line applications. </span><span data-offset-key="444b44206886449b8eb10036e4b8d6f7:1">`colorama`</span><span data-offset-key="444b44206886449b8eb10036e4b8d6f7:2"> allows you to use colors in your output, while </span><span data-offset-key="444b44206886449b8eb10036e4b8d6f7:3">`begins`</span><span data-offset-key="444b44206886449b8eb10036e4b8d6f7:4"> makes it easy to provide a rich interface for specifying and processing command-line options.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="e29304f7f2ad47228055011186fbfa63"><span data-offset-key="e29304f7f2ad47228055011186fbfa63:0">colorama</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="981b6a979f7148c7ac7f51a1c1fa6768"><span data-offset-key="981b6a979f7148c7ac7f51a1c1fa6768:0">Many of your desktop Python programs will only ever be used on the command line, so it makes sense to do whatever you can to improve the experience of your users as much as possible. The use of </span><span data-offset-key="981b6a979f7148c7ac7f51a1c1fa6768:1">*color*</span><span data-offset-key="981b6a979f7148c7ac7f51a1c1fa6768:2"> can dramatically improve your user interface, and </span><span data-offset-key="981b6a979f7148c7ac7f51a1c1fa6768:3">`colorama`</span><span data-offset-key="981b6a979f7148c7ac7f51a1c1fa6768:4"> makes it very easy to add splashes of color into your command-line applications.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3e278941a9c04a4d85db5117bbba941b"><span data-offset-key="3e278941a9c04a4d85db5117bbba941b:0">Let’s begin with a simple example.</span></span></span>

    from colorama import init, Fore, Back, Styleinit(autoreset=True)​messages = [    'blah blah blah',    (Fore.LIGHTYELLOW_EX + Style.BRIGHT        + BACK.MAGENTA + 'Alert!!!'),    'blah blah blah']​for m in messages:    print(m)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="768ab885ce364ceb8ce3f55bf6b452a0"><span data-offset-key="768ab885ce364ceb8ce3f55bf6b452a0:0">Notice in </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#colorama_first" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="a50131a8512c4f129b8a7915ac6432b5"><span data-offset-key="a50131a8512c4f129b8a7915ac6432b5:0">Figure 1-2</span></span></a><span data-key="aec3d8c79f48452e8a56532f7e1a9774"><span data-offset-key="aec3d8c79f48452e8a56532f7e1a9774:0"> how the important message jumps right out at you? There are other packages like </span><span data-offset-key="aec3d8c79f48452e8a56532f7e1a9774:1">`curses`</span><span data-offset-key="aec3d8c79f48452e8a56532f7e1a9774:2">, </span><span data-offset-key="aec3d8c79f48452e8a56532f7e1a9774:3">`blessings`</span><span data-offset-key="aec3d8c79f48452e8a56532f7e1a9774:4">, and </span><span data-offset-key="aec3d8c79f48452e8a56532f7e1a9774:5">`prompt-toolkit`</span><span data-offset-key="aec3d8c79f48452e8a56532f7e1a9774:6"> that let you do a whole lot more with the terminal screen itself, but they also have a slightly steeper learning curve; with </span><span data-offset-key="aec3d8c79f48452e8a56532f7e1a9774:7">`colorama`</span><span data-offset-key="aec3d8c79f48452e8a56532f7e1a9774:8"> the API is simple enough to be easy to remember.</span></span><span data-slate-void="true" data-key="1e7d7c30ad9d414fa4f643e40c439e10"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="1e7d7c30ad9d414fa4f643e40c439e10"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0501.png" alt="tply 0501" class="image-67b14f24--image-54d049be" /></span></span><span data-key="727919fadc6940ab80862373265edb08"><span data-offset-key="727919fadc6940ab80862373265edb08:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="533f9f398e7a4f688e88a9a57ff2dd17"><span data-offset-key="533f9f398e7a4f688e88a9a57ff2dd17:0">**Figure 1-2. Add color to your output messages with simple string concatenation.**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="12f7ac9ba9674d109d6c169c0f5b88ff"><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:0">The great thing about </span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:1">`colorama`</span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:2"> is that it also works on Windows, in addition to Linux and Mac OS X. In the preceding example, we used the </span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:3">`init()`</span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:4"> function to enable automatic reset to default colors after each </span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:5">`print()`</span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:6">, but even when not required, </span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:7">`init()`</span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:8"> should always be called (when your code runs on Windows, the </span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:9">`init()`</span><span data-offset-key="12f7ac9ba9674d109d6c169c0f5b88ff:10"> call enables the mapping from ANSI color codes to the Windows color system).</span></span></span>

    from colorama import initinit()

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0ede2effabcf4f3cb272d200bbc6679a"><span data-offset-key="0ede2effabcf4f3cb272d200bbc6679a:0">The preceding example is clear enough to follow, but I would be a sorry author if I—after having emphasized the benefits of the </span><span data-offset-key="0ede2effabcf4f3cb272d200bbc6679a:1">*logging*</span><span data-offset-key="0ede2effabcf4f3cb272d200bbc6679a:2"> module—told you that the only way to get colors into your console was to use </span><span data-offset-key="0ede2effabcf4f3cb272d200bbc6679a:3">`print()`</span><span data-offset-key="0ede2effabcf4f3cb272d200bbc6679a:4">. As usual with Python, it turns out that the hard work has already been done for us. After installing the </span><span data-offset-key="0ede2effabcf4f3cb272d200bbc6679a:5">`colorlog`</span><span data-offset-key="0ede2effabcf4f3cb272d200bbc6679a:6"> package,</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737066327760" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="dac088eebfdc45668cbd93ba823c2ed2"><span data-offset-key="dac088eebfdc45668cbd93ba823c2ed2:0">6</span></span></a><span data-key="8f11b2462f594c1c9de6ffc459636cb7"><span data-offset-key="8f11b2462f594c1c9de6ffc459636cb7:0"> you can use colors in your log messages immediately:</span></span></span>

    import colorlog​logger = colorlog.getLogger()  logger.setLevel(colorlog.colorlog.logging.DEBUG)  ​handler = colorlog.StreamHandler()handler.setFormatter(colorlog.ColoredFormatter())  logger.addHandler(handler)​logger.debug("Debug message")logger.info("Information message")logger.warning("Warning message")logger.error("Error message")logger.critical("Critical message")

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d2a865ec2ba047f8a16fa21054e22dd4"><span data-offset-key="d2a865ec2ba047f8a16fa21054e22dd4:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO14-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="0ea42eb9dd864cd8afb0f23a45d2269f"><span data-offset-key="0ea42eb9dd864cd8afb0f23a45d2269f:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="312f95b6e4bf4d5f962f97869f802ac2"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="312f95b6e4bf4d5f962f97869f802ac2"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="d2090efb527943cf8deafbd48c072aa5"><span data-offset-key="d2090efb527943cf8deafbd48c072aa5:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="9392b7897ea84f25864e1d4d88c2422d"><span data-offset-key="9392b7897ea84f25864e1d4d88c2422d:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9de5172399d7489b9219671505d1ffaa"><span data-offset-key="9de5172399d7489b9219671505d1ffaa:0">Obtain a </span><span data-offset-key="9de5172399d7489b9219671505d1ffaa:1">`logger`</span><span data-offset-key="9de5172399d7489b9219671505d1ffaa:2"> instance, exactly as you would normally do.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO14-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="3212e29faf824ebe8868ca97dcd0f2e5"><span data-offset-key="3212e29faf824ebe8868ca97dcd0f2e5:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="b35a2331a35647e2b00acdb39aaf6c1f"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="b35a2331a35647e2b00acdb39aaf6c1f"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="a398bbe4b2b743c1a55287a7ca93e6f3"><span data-offset-key="a398bbe4b2b743c1a55287a7ca93e6f3:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="5c56f365e1f64f0997db45f55af3ee9f"><span data-offset-key="5c56f365e1f64f0997db45f55af3ee9f:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="abdb8ce38d5746b0a0ffb3664f03384b"><span data-offset-key="abdb8ce38d5746b0a0ffb3664f03384b:0">Set the logging level. You can also use the constants like </span><span data-offset-key="abdb8ce38d5746b0a0ffb3664f03384b:1">`DEBUG`</span><span data-offset-key="abdb8ce38d5746b0a0ffb3664f03384b:2"> and </span><span data-offset-key="abdb8ce38d5746b0a0ffb3664f03384b:3">`INFO`</span><span data-offset-key="abdb8ce38d5746b0a0ffb3664f03384b:4"> from the logging module directly.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO14-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="63c5fc1091b54d3e9c4267fa537a847f"><span data-offset-key="63c5fc1091b54d3e9c4267fa537a847f:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="07aada7829e24854aa139b20533eb461"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="07aada7829e24854aa139b20533eb461"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="062ce0043d324909b672a8cbfa8eaa2d"><span data-offset-key="062ce0043d324909b672a8cbfa8eaa2d:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="0cfc5fd3b77f475ea2c66b94fc918985"><span data-offset-key="0cfc5fd3b77f475ea2c66b94fc918985:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9a9656b1e5f44c68b4c12a49a4b6bbd8"><span data-offset-key="9a9656b1e5f44c68b4c12a49a4b6bbd8:0">Set the message formatter to be the </span><span data-offset-key="9a9656b1e5f44c68b4c12a49a4b6bbd8:1">`ColoredFormatter`</span><span data-offset-key="9a9656b1e5f44c68b4c12a49a4b6bbd8:2"> provided by the </span><span data-offset-key="9a9656b1e5f44c68b4c12a49a4b6bbd8:3">`colorlog`</span><span data-offset-key="9a9656b1e5f44c68b4c12a49a4b6bbd8:4"> library.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="46710f72e9644ee8977095196c4b16cc"><span data-offset-key="46710f72e9644ee8977095196c4b16cc:0">This produces the output shown in </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#colorlogdemo" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d3c68602c326446e9728c85aab7bca15"><span data-offset-key="d3c68602c326446e9728c85aab7bca15:0">Figure 1-3</span></span></a><span data-key="112ba4adcd2a441399c161b9c23b4374"><span data-offset-key="112ba4adcd2a441399c161b9c23b4374:0">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3b5974bffdcf49f2b19ee712b6a0bb81"><span data-offset-key="3b5974bffdcf49f2b19ee712b6a0bb81:0">There are several other similar Python packages worth watching, such as the </span></span><a href="https://jart.github.io/fabulous" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="1e6ce30c49144249b183c44ee5d45ccd"><span data-offset-key="1e6ce30c49144249b183c44ee5d45ccd:0"><code class="code-0458e21e" spellcheck="false" data-slate-leaf="true">fabulous</code></span></span></a><span data-key="94fde19befd741b4bf947829ac119a63"><span data-offset-key="94fde19befd741b4bf947829ac119a63:0"> command-line beautifier, which would have made this list if it had been updated for Python 3 just a few weeks sooner!</span></span><span data-slate-void="true" data-key="e85d681fb11744ac9e76bf0f291f6133"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="e85d681fb11744ac9e76bf0f291f6133"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0502.png" alt="tply 0502" class="image-67b14f24--image-54d049be" /></span></span><span data-key="a5dbddda6e8d438f95a51e8c8dfb5747"><span data-offset-key="a5dbddda6e8d438f95a51e8c8dfb5747:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6d5d8cbdf9634d1db48cff52aa15ecdf"><span data-offset-key="6d5d8cbdf9634d1db48cff52aa15ecdf:0">**Figure 1-3. Beautiful and automatic colors for your logging messages.**</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="f17d67bb2f404ea1bc04cf0717ab4aae"><span data-offset-key="f17d67bb2f404ea1bc04cf0717ab4aae:0">begins</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1a618207c9824085b2a4adadc3159d3e"><span data-offset-key="1a618207c9824085b2a4adadc3159d3e:0">As far as user-interfaces go, most Python programs start out as command-line applications, and many remain so. It makes sense to offer your users the very best experience you can. For such programs, options are specified with command-line arguments, and the Python standard library offers the </span></span><a href="http://bit.ly/argparse-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="f794b2c6fdfa4de6b8f764bf1bea972b"><span data-offset-key="f794b2c6fdfa4de6b8f764bf1bea972b:0">argparse</span></span></a><span data-key="36d57130500e407d9aab1c540a14945b"><span data-offset-key="36d57130500e407d9aab1c540a14945b:0"> library to help with that.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="87191d3b762b4f8c9f5bc38a259b960f"><span data-offset-key="87191d3b762b4f8c9f5bc38a259b960f:0">`argparse`</span><span data-offset-key="87191d3b762b4f8c9f5bc38a259b960f:1"> is a robust, solid implementation for command-line processing, but it is somewhat verbose to use. For example, here we have an extremely simple script that will add two numbers passed on the command line:</span></span></span>

    import argparse​def main(a, b):    """ Short script to add two numbers """    return a + b​if __name__ == '__main__':    parser = argparse.ArgumentParser(        description="Add two numbers")    parser.add_argument('-a',                        help='First value',                        type=float,                        default=0)    parser.add_argument('-b',                        help='Second value',                        type=float,                        default=0)    args = parser.parse_args()    print(main(args.a, args.b))

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3eb96495530f47adaab01c53eeebabdf"><span data-offset-key="3eb96495530f47adaab01c53eeebabdf:0">As one would expect, help can be obtained by passing </span><span data-offset-key="3eb96495530f47adaab01c53eeebabdf:1">`-h`</span><span data-offset-key="3eb96495530f47adaab01c53eeebabdf:2"> to this program:</span></span></span>

    $ python argparsedemo.py -husage: argparsedemo.py [-h] [-a A] [-b B]​Add two numbers​optional arguments:  -h, --help  show this help message and exit  -a A        First value  -b B        Second value

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2e47bf876bfd4fd78d76dd64b052e2a1"><span data-offset-key="2e47bf876bfd4fd78d76dd64b052e2a1:0">In contrast, the </span><span data-offset-key="2e47bf876bfd4fd78d76dd64b052e2a1:1">`begins`</span><span data-offset-key="2e47bf876bfd4fd78d76dd64b052e2a1:2"> library takes a machete to the API of </span><span data-offset-key="2e47bf876bfd4fd78d76dd64b052e2a1:3">`argparse`</span><span data-offset-key="2e47bf876bfd4fd78d76dd64b052e2a1:4"> and maximally exploits features of the Python language to simplify setting up the same command-line interface:</span></span></span>

    import begin​@begin.start(auto_convert=True)def main(a: 'First value' = 0.0, b: 'Second value' = 0.0):    """ Add two numbers """    print(a + b)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f71b1e3effe74b3aa912e1869ce93768"><span data-offset-key="f71b1e3effe74b3aa912e1869ce93768:0">There is so much happening in so few lines, yet everything is still explicit:</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="05cd0dc7b7d44037bc860fb32c99cba2"><span data-offset-key="05cd0dc7b7d44037bc860fb32c99cba2:0">Each parameter in the main function becomes a command-line argument.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="74d950178b634ef4af9f4d6ec89eac89"><span data-offset-key="74d950178b634ef4af9f4d6ec89eac89:0">The </span><span data-offset-key="74d950178b634ef4af9f4d6ec89eac89:1">*function annotations*</span><span data-offset-key="74d950178b634ef4af9f4d6ec89eac89:2"> are exploited to provide an inline help description of each parameter.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7970b8ea2b7c4212a883c1dfbfdd49bc"><span data-offset-key="7970b8ea2b7c4212a883c1dfbfdd49bc:0">The default value of each parameter (here, </span><span data-offset-key="7970b8ea2b7c4212a883c1dfbfdd49bc:1">`0.0`</span><span data-offset-key="7970b8ea2b7c4212a883c1dfbfdd49bc:2">) is used both as a default value, as well as to indicate the required datatype (in this case, a </span><span data-offset-key="7970b8ea2b7c4212a883c1dfbfdd49bc:3">`float`</span><span data-offset-key="7970b8ea2b7c4212a883c1dfbfdd49bc:4"> number value).</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="209fc6eca040439e9d2461005132191b"><span data-offset-key="209fc6eca040439e9d2461005132191b:0">The </span><span data-offset-key="209fc6eca040439e9d2461005132191b:1">`auto_convert=True`</span><span data-offset-key="209fc6eca040439e9d2461005132191b:2"> is used to enforce type coercion from a string to the target parameter type.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1ab5b9944dfb4a109c39fad8b55be4ca"><span data-offset-key="1ab5b9944dfb4a109c39fad8b55be4ca:0">The docstring for the </span><span data-offset-key="1ab5b9944dfb4a109c39fad8b55be4ca:1">*function*</span><span data-offset-key="1ab5b9944dfb4a109c39fad8b55be4ca:2"> now becomes the help documentation of the program itself.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4b1652c795ba431989c0da0c56ad9268"><span data-offset-key="4b1652c795ba431989c0da0c56ad9268:0">Also, you may have noticed that this example lacks the usual </span><span data-offset-key="4b1652c795ba431989c0da0c56ad9268:1">`if __name__ == '__main__'`</span><span data-offset-key="4b1652c795ba431989c0da0c56ad9268:2"> boilerplate: that’s because </span><span data-offset-key="4b1652c795ba431989c0da0c56ad9268:3">`begins`</span><span data-offset-key="4b1652c795ba431989c0da0c56ad9268:4"> is smart enough to work with Python’s stack frames so that your target function becomes the starting point.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="fafbf9dc9688404baf75c45ad197bf5f"><span data-offset-key="fafbf9dc9688404baf75c45ad197bf5f:0">For completeness, here is the help for the </span><span data-offset-key="fafbf9dc9688404baf75c45ad197bf5f:1">`begins`</span><span data-offset-key="fafbf9dc9688404baf75c45ad197bf5f:2">-version, produced with </span><span data-offset-key="fafbf9dc9688404baf75c45ad197bf5f:3">`-h`</span><span data-offset-key="fafbf9dc9688404baf75c45ad197bf5f:4">:</span></span></span>

    $ python beginsdemo.py -husage: beginsdemo.py [-h] [--a A] [--b B]​Add two numbers​optional arguments:  -h, --help   show this help message and exit  --a A, -a A  First value (default: 0.0)  --b B, -b B  Second value (default: 0.0)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="671602be27784d699fc877861b209f4c"><span data-offset-key="671602be27784d699fc877861b209f4c:0">There are a bunch more tricks that </span><span data-offset-key="671602be27784d699fc877861b209f4c:1">`begins`</span><span data-offset-key="671602be27784d699fc877861b209f4c:2"> makes available, and you are encouraged to read the </span></span><a href="http://bit.ly/begins-docs" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d9b4cfe501274bfa86af23e5decb3f14"><span data-offset-key="d9b4cfe501274bfa86af23e5decb3f14:0">documentation</span></span></a><span data-key="26bb086d1c2f43f9b6e28364ff69732a"><span data-offset-key="26bb086d1c2f43f9b6e28364ff69732a:0">; for instance, if the parameters are words:</span></span></span>

    @begin.startdef main(directory: 'Target dir'):    ...

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1b4bee3315f043d28ad94e499a2ce11c"><span data-offset-key="1b4bee3315f043d28ad94e499a2ce11c:0">then both </span><span data-offset-key="1b4bee3315f043d28ad94e499a2ce11c:1">`-d VALUE`</span><span data-offset-key="1b4bee3315f043d28ad94e499a2ce11c:2"> and </span><span data-offset-key="1b4bee3315f043d28ad94e499a2ce11c:3">`--directory VALUE`</span><span data-offset-key="1b4bee3315f043d28ad94e499a2ce11c:4"> will work for specifying the value of the </span><span data-offset-key="1b4bee3315f043d28ad94e499a2ce11c:5">`directory`</span><span data-offset-key="1b4bee3315f043d28ad94e499a2ce11c:6"> parameter on the command line. A sequence of positional arguments of unknown length is easily defined with unpacking:</span></span></span>

    #demo.py@begin.startdef main(directory: 'Target dir', *filters):    ...

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2026756c4df947a0bf86b35258b49694"><span data-offset-key="2026756c4df947a0bf86b35258b49694:0">When called with:</span></span></span>

    $ python demo.py -d /home/user tmp temp TEMP

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="15669523db7c4674acf567a1a7080312"><span data-offset-key="15669523db7c4674acf567a1a7080312:0">the </span><span data-offset-key="15669523db7c4674acf567a1a7080312:1">`filters`</span><span data-offset-key="15669523db7c4674acf567a1a7080312:2"> argument would be the list </span><span data-offset-key="15669523db7c4674acf567a1a7080312:3">`['tmp', 'temp', 'TEMP']`</span><span data-offset-key="15669523db7c4674acf567a1a7080312:4">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="bd5a0660905944ab88146bc5e0c3c6bc"><span data-offset-key="bd5a0660905944ab88146bc5e0c3c6bc:0">If that were all that </span><span data-offset-key="bd5a0660905944ab88146bc5e0c3c6bc:1">`begins`</span><span data-offset-key="bd5a0660905944ab88146bc5e0c3c6bc:2"> supported, it would already be sufficient for the vast majority of simple programs; however, </span><span data-offset-key="bd5a0660905944ab88146bc5e0c3c6bc:3">`begins`</span><span data-offset-key="bd5a0660905944ab88146bc5e0c3c6bc:4"> also provides support for </span><span data-offset-key="bd5a0660905944ab88146bc5e0c3c6bc:5">*subcommands*</span><span data-offset-key="bd5a0660905944ab88146bc5e0c3c6bc:6">:</span></span></span>

    import begin​@begin.subcommanddef status(compact: 'Short or long format' = True):    """ Report the current status. """    if compact:        print('ok.')    else:        print('Very well, thank-you.')​@begin.subcommanddef fetch(url: 'Data source' = 'http://google.com'):    """ Fetch data from the URL. """    print('Work goes here')​@begin.start(auto_convert=True)def main(a: 'First value' = 0.0, b: 'Second value' = 0.0):    """ Add two numbers """    print(a + b)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d08da790319743d597bc4f0217c837b8"><span data-offset-key="d08da790319743d597bc4f0217c837b8:0">The </span><span data-offset-key="d08da790319743d597bc4f0217c837b8:1">`main`</span><span data-offset-key="d08da790319743d597bc4f0217c837b8:2"> function is the same as before, but we’ve added two subcommands:</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6bdb554de23640a4acbd699325a66a8c"><span data-offset-key="6bdb554de23640a4acbd699325a66a8c:0">The first, </span><span data-offset-key="6bdb554de23640a4acbd699325a66a8c:1">`status`</span><span data-offset-key="6bdb554de23640a4acbd699325a66a8c:2">, represents a subcommand that could be used to provide some kind of </span><span data-offset-key="6bdb554de23640a4acbd699325a66a8c:3">*system status*</span><span data-offset-key="6bdb554de23640a4acbd699325a66a8c:4"> message (think “git status”).</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ab52fb8f4df048c9b1713fee1ce6b426"><span data-offset-key="ab52fb8f4df048c9b1713fee1ce6b426:0">The second, </span><span data-offset-key="ab52fb8f4df048c9b1713fee1ce6b426:1">`fetch`</span><span data-offset-key="ab52fb8f4df048c9b1713fee1ce6b426:2">, represents a subcommand for some kind of work function (think “git fetch”).</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8cace8e6acf646fda7f6a958ca6fe2af"><span data-offset-key="8cace8e6acf646fda7f6a958ca6fe2af:0">Each subcommand has its own set of parameters, and the rules work in the same way as before with the </span><span data-offset-key="8cace8e6acf646fda7f6a958ca6fe2af:1">`main`</span><span data-offset-key="8cace8e6acf646fda7f6a958ca6fe2af:2"> function. For instance, observe the updated help (obtained with the </span><span data-offset-key="8cace8e6acf646fda7f6a958ca6fe2af:3">`-h`</span><span data-offset-key="8cace8e6acf646fda7f6a958ca6fe2af:4"> parameter) for the program:</span></span></span>

    $ python beginssubdemo.py -husage: beginssubdemo.py [-h] [--a A] [--b B] {fetch,status} ...​Add two numbers​optional arguments:  -h, --help      show this help message and exit  --a A, -a A     First value (default: 0.0)  --b B, -b B     Second value (default: 0.0)​Available subcommands:  {fetch,status}    fetch         Fetch data from the URL.    status        Report the current status.

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f7663055285a46049494e913fef7414f"><span data-offset-key="f7663055285a46049494e913fef7414f:0">We still have the same documentation for the main program, but now additional help for the subcommands have been added. Note that the function docstrings for </span><span data-offset-key="f7663055285a46049494e913fef7414f:1">`status`</span><span data-offset-key="f7663055285a46049494e913fef7414f:2"> and </span><span data-offset-key="f7663055285a46049494e913fef7414f:3">`fetch`</span><span data-offset-key="f7663055285a46049494e913fef7414f:4"> have also been recycled into CLI help descriptions. Here is an example of how our program might be called:</span></span></span>

    $ python beginssubdemo.py -a 7 -b 7 status --compact14.0ok.​$ python beginssubdemo.py -a 7 -b 7 status --no-compact14.0Very well, thank-you.

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="74f3854403904f11bd0e6562e2068969"><span data-offset-key="74f3854403904f11bd0e6562e2068969:0">You can also see how </span><span data-offset-key="74f3854403904f11bd0e6562e2068969:1">*boolean*</span><span data-offset-key="74f3854403904f11bd0e6562e2068969:2"> parameters get some special treatment: they evaluate </span><span data-offset-key="74f3854403904f11bd0e6562e2068969:3">`True`</span><span data-offset-key="74f3854403904f11bd0e6562e2068969:4"> if present and </span><span data-offset-key="74f3854403904f11bd0e6562e2068969:5">`False`</span><span data-offset-key="74f3854403904f11bd0e6562e2068969:6"> when </span><span data-offset-key="74f3854403904f11bd0e6562e2068969:7">`no-`</span><span data-offset-key="74f3854403904f11bd0e6562e2068969:8"> is prefixed to the parameter name, as shown for the parameter </span><span data-offset-key="74f3854403904f11bd0e6562e2068969:9">`compact`</span><span data-offset-key="74f3854403904f11bd0e6562e2068969:10">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f923a7ecccf84c17a9df25ba134f3cc9"><span data-offset-key="f923a7ecccf84c17a9df25ba134f3cc9:0">`begins`</span><span data-offset-key="f923a7ecccf84c17a9df25ba134f3cc9:1"> has even more tricks up its sleeve, such as automatic handling for </span></span><a href="http://bit.ly/env-var" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="13126b8bbca44100917c990d93ffb562"><span data-offset-key="13126b8bbca44100917c990d93ffb562:0">environment variables</span></span></a><span data-key="2a46c0cccb0c4ee5a645f8e40cabce11"><span data-offset-key="2a46c0cccb0c4ee5a645f8e40cabce11:0">, </span></span><a href="http://bit.ly/beg-config" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="bc16192b040041f6b38f686971405d3d"><span data-offset-key="bc16192b040041f6b38f686971405d3d:0">config files</span></span></a><span data-key="3d891d19d2b4477a8e473c85e7c63269"><span data-offset-key="3d891d19d2b4477a8e473c85e7c63269:0">, </span></span><a href="http://bit.ly/beg-err" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d44838d42b064f8896c2a8775de74f9a"><span data-offset-key="d44838d42b064f8896c2a8775de74f9a:0">error handling</span></span></a><span data-key="29a238ebd1c045efb1a610c132ed432e"><span data-offset-key="29a238ebd1c045efb1a610c132ed432e:0">, and </span></span><a href="http://bit.ly/beg-log" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="625687c74e884ce89d763b95e5baeedc"><span data-offset-key="625687c74e884ce89d763b95e5baeedc:0">logging</span></span></a><span data-key="67e265762eab4ec5b28305e2205c26f8"><span data-offset-key="67e265762eab4ec5b28305e2205c26f8:0">, and I once again urge you to check out the project documentation.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="46ac504e3ccb430b84a7fed405c757b9"><span data-offset-key="46ac504e3ccb430b84a7fed405c757b9:0">If </span><span data-offset-key="46ac504e3ccb430b84a7fed405c757b9:1">`begins`</span><span data-offset-key="46ac504e3ccb430b84a7fed405c757b9:2"> seems too extreme for you, there are a bunch of other tools for easing the creation of command-line interfaces. One particular option that has been growing in popularity is </span></span><a href="http://click.pocoo.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="2acc9871bfbd4d81ae35a68fa4f4e655"><span data-offset-key="2acc9871bfbd4d81ae35a68fa4f4e655:0">click</span></span></a><span data-key="656a75b4358f4448a68e951a92aff680"><span data-offset-key="656a75b4358f4448a68e951a92aff680:0">.</span></span></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="cda64601c8fe40e5ad0164f9959e55b4"><span data-offset-key="cda64601c8fe40e5ad0164f9959e55b4:0">Graphical User Interfaces</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b6a85c78d0d44ba8897e27944edc9a2c"><span data-offset-key="b6a85c78d0d44ba8897e27944edc9a2c:0">Python offers a wealth of options for creating graphical user interfaces (GUIs) including </span></span><a href="http://bit.ly/py-qt" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="3553343c58654dc3b140d8f9554167ca"><span data-offset-key="3553343c58654dc3b140d8f9554167ca:0">PyQt</span></span></a><span data-key="94aa8211f27b406da1afe0dfb4dc89d1"><span data-offset-key="94aa8211f27b406da1afe0dfb4dc89d1:0">, </span></span><a href="https://www.wxpython.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="34b575d865d2483e9ab5d04ab0bce1f8"><span data-offset-key="34b575d865d2483e9ab5d04ab0bce1f8:0">wxPython</span></span></a><span data-key="6a649eb9de3a483487436b8be600afd7"><span data-offset-key="6a649eb9de3a483487436b8be600afd7:0">, and </span></span><a href="http://bit.ly/tkinter-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="7cef4918c1554eba976544915b5e9bc7"><span data-offset-key="7cef4918c1554eba976544915b5e9bc7:0">tkinter</span></span></a><span data-key="52882f415f814f559015a045aa1be4d1"><span data-offset-key="52882f415f814f559015a045aa1be4d1:0">, which is also available directly in the standard library. In this chapter we will describe two significant, but largely undiscovered, additions to the lineup. The first, </span><span data-offset-key="52882f415f814f559015a045aa1be4d1:1">`pyqtgraph`</span><span data-offset-key="52882f415f814f559015a045aa1be4d1:2">, is much more than simply a chart-plotting library, while </span><span data-offset-key="52882f415f814f559015a045aa1be4d1:3">`pywebview`</span><span data-offset-key="52882f415f814f559015a045aa1be4d1:4"> gives you a full-featured web-technology interface for your desktop Python applications.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="ed9cb9900e8c446680ca1fd7701c399a"><span data-offset-key="ed9cb9900e8c446680ca1fd7701c399a:0">pyqtgraph</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7d3248e1f4814cb39f2713657611c7f3"><span data-offset-key="7d3248e1f4814cb39f2713657611c7f3:0">The most popular chart-plotting library in Python is </span></span><a href="http://matplotlib.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="7bec41ec84f74ff8811f09fb78f1c5e8"><span data-offset-key="7bec41ec84f74ff8811f09fb78f1c5e8:0">matplotlib</span></span></a><span data-key="7a9d5722fb92427791acf1e913de0889"><span data-offset-key="7a9d5722fb92427791acf1e913de0889:0">, but you may not yet have heard of the wonderful alternative, </span></span><a href="http://www.pyqtgraph.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="c9bd1b513da140eda68060ee848cec17"><span data-offset-key="c9bd1b513da140eda68060ee848cec17:0">pyqtgraph</span></span></a><span data-key="8cafe1cae92342b89aa331f6005d003e"><span data-offset-key="8cafe1cae92342b89aa331f6005d003e:0">. Pyqtgraph is not a one-to-one replacement for matplotlib; rather, it offers a different selection of features and in particular is excellent for real-time and interactive visualization.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b50e1ca29a1540e9b37c0ac7317d7c26"><span data-offset-key="b50e1ca29a1540e9b37c0ac7317d7c26:0">It is very easy to get an idea of what pyqtgraph offers: simply run the built-in examples application:</span></span></span>

    $ pip install pyqtgraph$ python -m pyqtgraph.examples

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a897e01bfd1648e9a1a36acbe932573d"><span data-offset-key="a897e01bfd1648e9a1a36acbe932573d:0">This will install and run the examples browser. You can see a screenshot of one of the examples in </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#pyqtgraph_ex" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="ff6bbf4e88f349fc900460cedbfd9308"><span data-offset-key="ff6bbf4e88f349fc900460cedbfd9308:0">Figure 1-4</span></span></a><span data-key="ea70357352174ebda1fa8bbd9b278ab3"><span data-offset-key="ea70357352174ebda1fa8bbd9b278ab3:0">.</span></span><span data-slate-void="true" data-key="15fae9c32dcf41069d9d4f7d741c5d42"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="15fae9c32dcf41069d9d4f7d741c5d42"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0601.png" alt="tply 0601" class="image-67b14f24--image-54d049be" /></span></span><span data-key="30ef5345f0b44d68b3d3fc7cd1513574"><span data-offset-key="30ef5345f0b44d68b3d3fc7cd1513574:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="63231cae992a49608027787ed4569c2d"><span data-offset-key="63231cae992a49608027787ed4569c2d:0">**Figure 1-4. Interactive pyqtgraph window.**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b9339ec9a463492f9ea56d5c11b9e02c"><span data-offset-key="b9339ec9a463492f9ea56d5c11b9e02c:0">This example shows an array of interactive plots. You can’t tell from the screenshot, but when you run this example, the yellow chart on the right is a high-speed animation. Each plot, including the animated one (in yellow), can be panned and scaled in real-time with your cursor. If you’ve used Python GUI frameworks in the past, and in particular ones with free-form graphics, you would probably expect sluggish performance. This is not the case with </span><span data-offset-key="b9339ec9a463492f9ea56d5c11b9e02c:1">`pyqtgraph`</span><span data-offset-key="b9339ec9a463492f9ea56d5c11b9e02c:2">: because </span><span data-offset-key="b9339ec9a463492f9ea56d5c11b9e02c:3">`pyqtgraph`</span><span data-offset-key="b9339ec9a463492f9ea56d5c11b9e02c:4"> uses, unsurprisingly, </span><span data-offset-key="b9339ec9a463492f9ea56d5c11b9e02c:5">`PyQt`</span><span data-offset-key="b9339ec9a463492f9ea56d5c11b9e02c:6"> for the UI. This allows </span><span data-offset-key="b9339ec9a463492f9ea56d5c11b9e02c:7">`pyqtgraph`</span><span data-offset-key="b9339ec9a463492f9ea56d5c11b9e02c:8"> itself to be a pure-python package, making installation and distribution easy.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737065700880" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="fcb16a95a1f545439d93da5737812fd5"><span data-offset-key="fcb16a95a1f545439d93da5737812fd5:0">7</span></span></a><span data-key="1cc92043e121418481ffc2ec2ecda83f"><span data-offset-key="1cc92043e121418481ffc2ec2ecda83f:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="100eec51cbdb433680c3149f7ee684f3"><span data-offset-key="100eec51cbdb433680c3149f7ee684f3:0">By default, the style configuration for graphs in </span><span data-offset-key="100eec51cbdb433680c3149f7ee684f3:1">`pyqtgraph`</span><span data-offset-key="100eec51cbdb433680c3149f7ee684f3:2"> uses a black background with a white foreground. In </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#pyqtgraph_ex" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="7adbc0b7cfee41b0b4d0791c4605afe0"><span data-offset-key="7adbc0b7cfee41b0b4d0791c4605afe0:0">Figure 1-4</span></span></a><span data-key="6bd3204a2fdd4ed6a8f6d078bd2f8f12"><span data-offset-key="6bd3204a2fdd4ed6a8f6d078bd2f8f12:0">, I sneakily used a style configuration change to reverse the colors, since dark backgrounds look terrible in print. This information is also available in the documentation:</span></span></span>

    import pyqtgraph as pg# Switch to using white background and black foregroundpg.setConfigOption('background', 'w')pg.setConfigOption('foreground', 'k')

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c82a54d40b1b47858258bb3e3cfff284"><span data-offset-key="c82a54d40b1b47858258bb3e3cfff284:0">There is more on offer than simply plotting graphs: </span><span data-offset-key="c82a54d40b1b47858258bb3e3cfff284:1">`pyqtgraph`</span><span data-offset-key="c82a54d40b1b47858258bb3e3cfff284:2"> also has features for 3D visualization, widget docking, and automatic data widgets with two-way binding. In </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#pyqtgraph_light" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="e3c1320ce5ac4c42aaa60d048ca27143"><span data-offset-key="e3c1320ce5ac4c42aaa60d048ca27143:0">Figure 1-5</span></span></a><span data-key="c0c197058cd746d68a38d039ea5ffcd1"><span data-offset-key="c0c197058cd746d68a38d039ea5ffcd1:0">, the data-entry and manipulation widgets were generated automatically from a Numpy table array, and UI interaction with these widgets changes the graph automatically.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="462b330ba6444576bab4b6051e097faa"><span data-offset-key="462b330ba6444576bab4b6051e097faa:0">`pyqtgraph`</span><span data-offset-key="462b330ba6444576bab4b6051e097faa:1"> is typically used as a direct visualizer, much like how </span><span data-offset-key="462b330ba6444576bab4b6051e097faa:2">`matplotlib`</span><span data-offset-key="462b330ba6444576bab4b6051e097faa:3"> is used, but with better interactivity. However, it is also quite easy to </span><span data-offset-key="462b330ba6444576bab4b6051e097faa:4">*embed*</span><span data-offset-key="462b330ba6444576bab4b6051e097faa:5"> </span><span data-offset-key="462b330ba6444576bab4b6051e097faa:6">`pyqtgraph`</span><span data-offset-key="462b330ba6444576bab4b6051e097faa:7"> into another separate </span><span data-offset-key="462b330ba6444576bab4b6051e097faa:8">`PyQt`</span><span data-offset-key="462b330ba6444576bab4b6051e097faa:9"> application and the documentation for this is easy to follow. </span><span data-offset-key="462b330ba6444576bab4b6051e097faa:10">`pyqtgraph`</span><span data-offset-key="462b330ba6444576bab4b6051e097faa:11"> also provides a few useful extras, like edit widgets that are units-aware (kilograms, meters and so on), and tree widgets that can be built automatically from (nested!) standard Python data structures like lists, dictionaries, and arrays.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8a1e353109194e37ba74ec00ba23ef2c"><span data-offset-key="8a1e353109194e37ba74ec00ba23ef2c:0">The author of </span><span data-offset-key="8a1e353109194e37ba74ec00ba23ef2c:1">`pyqtgraph`</span><span data-offset-key="8a1e353109194e37ba74ec00ba23ef2c:2"> is now working with the authors of other visualization packages on a new high-performance visualization package: </span></span><a href="http://vispy.org/gallery.html" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="2220dee3c91943dfa6463ef90f23d0b2"><span data-offset-key="2220dee3c91943dfa6463ef90f23d0b2:0">vispy</span></span></a><span data-key="fff7b6ef09654426b518ad3cec6685b0"><span data-offset-key="fff7b6ef09654426b518ad3cec6685b0:0">. Based on how useful </span><span data-offset-key="fff7b6ef09654426b518ad3cec6685b0:1">`pyqtgraph`</span><span data-offset-key="fff7b6ef09654426b518ad3cec6685b0:2"> has been for me, I’ve no doubt that </span><span data-offset-key="fff7b6ef09654426b518ad3cec6685b0:3">`vispy`</span><span data-offset-key="fff7b6ef09654426b518ad3cec6685b0:4"> is likely to become another indispensable tool for data visualization.</span></span><span data-slate-void="true" data-key="fba9054522294d8f9c1b8bbecf4f6c1c"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="fba9054522294d8f9c1b8bbecf4f6c1c"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0602.png" alt="tply 0602" class="image-67b14f24--image-54d049be" /></span></span><span data-key="69b8b4f7d5674b8f941685d60f2496c4"><span data-offset-key="69b8b4f7d5674b8f941685d60f2496c4:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="cab5526299db468d9cd9148992478cc7"><span data-offset-key="cab5526299db468d9cd9148992478cc7:0">**Figure 1-5. Another pyqtgraph example: the data fields and widgets on the left are automatically created from a Numpy table array.**</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="732b8d7b5378463e9f67e652fb926578"><span data-offset-key="732b8d7b5378463e9f67e652fb926578:0">pywebview</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="eb40289b675c4667b4e16d5eb2865ee7"><span data-offset-key="eb40289b675c4667b4e16d5eb2865ee7:0">There are a huge number of ways to make </span><span data-offset-key="eb40289b675c4667b4e16d5eb2865ee7:1">*desktop*</span><span data-offset-key="eb40289b675c4667b4e16d5eb2865ee7:2"> GUI applications with Python, but in recent years the idea of using a browser-like interface as a desktop client interface has become popular. This approach is based around tools like </span></span><a href="http://bit.ly/cefpy" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="222c906279474ce28d467950607faceb"><span data-offset-key="222c906279474ce28d467950607faceb:0">cefpython</span></span></a><span data-key="4e398781b5124c028849285033111f66"><span data-offset-key="4e398781b5124c028849285033111f66:0"> (using the Chrome-embedded framework) and </span></span><a href="http://bit.ly/electron-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="76cb138941a749b9972816fa12ed28fd"><span data-offset-key="76cb138941a749b9972816fa12ed28fd:0">Electron</span></span></a><span data-key="0c6664de8f354a718667bc680232d789"><span data-offset-key="0c6664de8f354a718667bc680232d789:0">, which has been used to build many popular tools such as the Atom text editor and Slack social messaging application.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="160f29473f8d422d86a7112496a5e939"><span data-offset-key="160f29473f8d422d86a7112496a5e939:0">Usually, such an approach involves bundling a browser engine with your application, but </span></span><a href="http://bit.ly/pywebview" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="311664eff76a4c48bcc289cb2a91cb89"><span data-offset-key="311664eff76a4c48bcc289cb2a91cb89:0">Pywebview</span></span></a><span data-key="3fb758e1885f4048946cef91a8ce3f33"><span data-offset-key="3fb758e1885f4048946cef91a8ce3f33:0"> gives you a one-line command to create a GUI window that wraps a </span><span data-offset-key="3fb758e1885f4048946cef91a8ce3f33:1">*system native*</span><span data-offset-key="3fb758e1885f4048946cef91a8ce3f33:2"> “web view” window. By combining this with a Python web abb like Flask or Bottle, it becomes very easy to create a local application with a GUI, while also taking advantage of the latest GUI technologies that have been developed in the browser space. The benefit to using the system native browser widget is that you don’t have to distribute a potentially large application bundle to your users.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="49018a2588fe4412af8a0082a69b9c4a"><span data-offset-key="49018a2588fe4412af8a0082a69b9c4a:0">Let’s begin with an example. Since our application will be built up as a web-page template in HTML, it might be interesting to use a Python tool to build the HTML rather than writing it out by hand.</span></span></span>

    from string import ascii_lettersfrom random import choice, randintimport webview  import dominate  from dominate.tags import *from bottle import route, run, template  ​bootstrap = 'https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/'bootswatch = 'https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/'​doc = dominate.document()​with doc.head:  link(rel='stylesheet',       href=bootstrap + 'css/bootstrap.min.css')  link(rel='stylesheet',       href=bootswatch + 'paper/bootstrap.min.css')  script(src='https://code.jquery.com/jquery-2.1.1.min.js')  [script(src=bootstrap + 'js/' + x)      for x in ['bootstrap.min.js', 'bootstrap-dropdown.js']]​with doc:  with div(cls='container'):    with h1():      span(cls='glyphicon glyphicon-map-marker')        span('My Heading')    with div(cls='row'):      with div(cls='col-sm-6'):        p('{{body}}')        with div(cls='col-sm-6'):        p('Evaluate an expression:')        input_(id='expression', type='text')        button('Evaluate', cls='btn btn-primary')        div(style='margin-top: 10px;')        with div(cls='dropdown'):          with button(cls="btn btn-default dropdown-toggle",                      type="button", data_toggle='dropdown'):            span('Dropdown')            span(cls='caret')          items = ('Action', 'Another action',                   'Yet another action')          ul((li(a(x, href='#')) for x in items),             cls='dropdown-menu')  ​    with div(cls='row'):      h3('Progress:')      with div(cls='progress'):          with div(cls='progress-bar', role='progressbar',                 style='width: 60%;'):          span('60%')​    with div(cls='row'):        for vid in ['4vuW6tQ0218', 'wZZ7oFKsKzY', 'NfnMJMkhDoQ']:        with div(cls='col-sm-4'):          with div(cls='embed-responsive embed-responsive-16by9'):            iframe(               cls='embed-responsive-item',               src='https://www.youtube.com/embed/' + vid,               frameborder='0')​​@route('/')def root():    word = lambda: ''.join(        choice(ascii_letters) for i in range(randint(2, 10)))    nih_lorem = ' '.join(word() for i in range(50))    return template(str(doc), body=nih_lorem)​​if __name__ == '__main__':    import threading    thread = threading.Thread(        target=run, kwargs=dict(host='localhost', port=8080),        daemon=True)    thread.start()​    webview.create_window(        "Not a browser, honest!", "http://localhost:8080",        width=800, height=600, resizable=False)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d9bd6b940ad64ba4800294c3c69a8a9e"><span data-offset-key="d9bd6b940ad64ba4800294c3c69a8a9e:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO15-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="ce2aaace82824a3585654887d55adf45"><span data-offset-key="ce2aaace82824a3585654887d55adf45:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="2a478175cf7d4a05946882d8c362380e"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="2a478175cf7d4a05946882d8c362380e"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="471857531ffa4c30a2b4438a611bec98"><span data-offset-key="471857531ffa4c30a2b4438a611bec98:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="e2cc1571803b4f5d90757a39f733215d"><span data-offset-key="e2cc1571803b4f5d90757a39f733215d:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f812492edcbb467984dd883731efdb1d"><span data-offset-key="f812492edcbb467984dd883731efdb1d:0">`webview`</span><span data-offset-key="f812492edcbb467984dd883731efdb1d:1">, the star of the show</span></span><span data-slate-void="true" data-key="3d7acd9a08b4470093b5cd159c7c6995"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="3d7acd9a08b4470093b5cd159c7c6995"><embed src="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO15-2" class="image-67b14f24--image-54d049be" /></span></span><span data-key="b4e57a01cb6a4e059211cda4ab879f1d"><span data-offset-key="b4e57a01cb6a4e059211cda4ab879f1d:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="75a5e2de7a474415ad482586cc475826"><span data-offset-key="75a5e2de7a474415ad482586cc475826:0">The other star of the show. </span><span data-offset-key="75a5e2de7a474415ad482586cc475826:1">`dominate`</span><span data-offset-key="75a5e2de7a474415ad482586cc475826:2"> lets you create HTML with a series of nested context handlers.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO15-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="8e6e30e859cf4414be7b2c1b24e309ef"><span data-offset-key="8e6e30e859cf4414be7b2c1b24e309ef:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="f3c8203cba81426f8bcdd9677970dfa9"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="f3c8203cba81426f8bcdd9677970dfa9"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="10304ba90dac45d4a6901a792638c974"><span data-offset-key="10304ba90dac45d4a6901a792638c974:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="848dc3869e11478683d57a2b03414bc4"><span data-offset-key="848dc3869e11478683d57a2b03414bc4:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f6b7917c4b884f5e88477155d11c2cdb"><span data-offset-key="f6b7917c4b884f5e88477155d11c2cdb:0">The third star of the show! The </span><span data-offset-key="f6b7917c4b884f5e88477155d11c2cdb:1">`bottle`</span><span data-offset-key="f6b7917c4b884f5e88477155d11c2cdb:2"> framework provides a very simple interface for building a basic web app with templates and routing.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO15-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="02154dc362f74b19989d38b584000259"><span data-offset-key="02154dc362f74b19989d38b584000259:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="600f5ef6d68c43cb9c64f256422ae595"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="600f5ef6d68c43cb9c64f256422ae595"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="fbdfaf3080364567b258049dbf737f8f"><span data-offset-key="fbdfaf3080364567b258049dbf737f8f:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="d38ee5a4c0254810b0568e15992d7ebb"><span data-offset-key="d38ee5a4c0254810b0568e15992d7ebb:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="68914549e35c4bec8bb27cd82361d5f3"><span data-offset-key="68914549e35c4bec8bb27cd82361d5f3:0">Building up HTML in Python has the tremendous advantage of using all the syntax tools the language has to offer.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO15-5" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="e9dfc32654e740599ac789da7a66a4ba"><span data-offset-key="e9dfc32654e740599ac789da7a66a4ba:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="d8c8b72d2ae14942a4f3e660f8086593"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="d8c8b72d2ae14942a4f3e660f8086593"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/5.png" alt="5" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="ec6d4b0bb8c54ba1a1079849507641e7"><span data-offset-key="ec6d4b0bb8c54ba1a1079849507641e7:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="917a5ac9b0fb4a0a8f92c82b2413a7f6"><span data-offset-key="917a5ac9b0fb4a0a8f92c82b2413a7f6:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a8437cde84f54441ad2749f5116de92d"><span data-offset-key="a8437cde84f54441ad2749f5116de92d:0">By using Bootstrap, one of the oldest and most robust front-end frameworks, we get access to fun things like glyph icons.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO15-6" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="b01b8b4deefe4429b1d7d2b39974ff40"><span data-offset-key="b01b8b4deefe4429b1d7d2b39974ff40:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="c9c2babcf52c4e33a32c0408378d6ce7"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="c9c2babcf52c4e33a32c0408378d6ce7"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/6.png" alt="6" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="ef9b4edf61e34f9c8c4b09dadb1e066e"><span data-offset-key="ef9b4edf61e34f9c8c4b09dadb1e066e:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="edee86f621b2455ca9b8d4ceecb91b69"><span data-offset-key="edee86f621b2455ca9b8d4ceecb91b69:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8e73401139a84ac1ac7b4c24807423b5"><span data-offset-key="8e73401139a84ac1ac7b4c24807423b5:0">Template variables can still be entered into our HTML and substituted later using the web framework’s tools.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO15-8" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="43cb90f426ef4cdcac37cd29723eb2a0"><span data-offset-key="43cb90f426ef4cdcac37cd29723eb2a0:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="f0b66c2e9b6644ed96c129f71cf5cacb"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="f0b66c2e9b6644ed96c129f71cf5cacb"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/7.png" alt="7" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="b054b814d5bc4a79859f60bff270cd57"><span data-offset-key="b054b814d5bc4a79859f60bff270cd57:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="45a97392628046ebbdf90265743b125b"><span data-offset-key="45a97392628046ebbdf90265743b125b:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b3c45b5df3194e859ec085ce023bbd1a"><span data-offset-key="b3c45b5df3194e859ec085ce023bbd1a:0">To demonstrate that we really do have Bootstrap, here is a progress bar widget. With </span><span data-offset-key="b3c45b5df3194e859ec085ce023bbd1a:1">`pywebview`</span><span data-offset-key="b3c45b5df3194e859ec085ce023bbd1a:2">, you can, of course, use any Bootstrap widget, and indeed any other tools that would normally be used in web browser user interfaces.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO15-9" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="02c10a000b624588a267f532c4c38039"><span data-offset-key="02c10a000b624588a267f532c4c38039:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="08e6c6b1d6844990981c40690045d640"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="08e6c6b1d6844990981c40690045d640"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/8.png" alt="8" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="545b0e1b365144cbac55ee50b0037762"><span data-offset-key="545b0e1b365144cbac55ee50b0037762:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="5a8bbd9bb3974ca49c6b2512ba66d07e"><span data-offset-key="5a8bbd9bb3974ca49c6b2512ba66d07e:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e668051e6757427fbf19334fa954b1e3"><span data-offset-key="e668051e6757427fbf19334fa954b1e3:0">I’ve embedded a few fun videos from YouTube.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="86fd4e18408f42cb95e051505ba7e6d5"><span data-offset-key="86fd4e18408f42cb95e051505ba7e6d5:0">Running this program produces a great-looking interface, as shown in </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#pywebview_basic" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d1538575ee644158af9651f771135d2d"><span data-offset-key="d1538575ee644158af9651f771135d2d:0">Figure 1-6</span></span></a><span data-key="aff95de430cb476693f6ecdfe69e67cf"><span data-offset-key="aff95de430cb476693f6ecdfe69e67cf:0">.</span></span><span data-slate-void="true" data-key="4d8a9c8446ea416aad40d16b39906a6b"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="4d8a9c8446ea416aad40d16b39906a6b"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0603.png" alt="tply 0603" class="image-67b14f24--image-54d049be" /></span></span><span data-key="cc7c28e389104361bb7d05ff2838551a"><span data-offset-key="cc7c28e389104361bb7d05ff2838551a:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="321a615127d0488fa7a514e568502cb1"><span data-offset-key="321a615127d0488fa7a514e568502cb1:0">**Figure 1-6. A beautiful and pleasing interface with very little effort.**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="83818a67a5a94d09bd2f9a45f867f3bd"><span data-offset-key="83818a67a5a94d09bd2f9a45f867f3bd:0">For this demonstration, I’ve used the </span><span data-offset-key="83818a67a5a94d09bd2f9a45f867f3bd:1">*Paper*</span><span data-offset-key="83818a67a5a94d09bd2f9a45f867f3bd:2"> Bootstrap theme, but by changing a single word you can use an entirely different one! The </span><span data-offset-key="83818a67a5a94d09bd2f9a45f867f3bd:3">*Superhero*</span><span data-offset-key="83818a67a5a94d09bd2f9a45f867f3bd:4"> Bootstrap theme is shown in </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#pywebview_theme" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="284b3257dedf4544907bd83c37fc6933"><span data-offset-key="284b3257dedf4544907bd83c37fc6933:0">Figure 1-7</span></span></a><span data-key="8efd3923a1924303ab3ecc7042824dbb"><span data-offset-key="8efd3923a1924303ab3ecc7042824dbb:0">.</span></span><span data-slate-void="true" data-key="97e307e789ca451caa552258d2605e02"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="97e307e789ca451caa552258d2605e02"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0604.png" alt="tply 0604" class="image-67b14f24--image-54d049be" /></span></span><span data-key="455dac554e2a42a7917a2d032162cbd0"><span data-offset-key="455dac554e2a42a7917a2d032162cbd0:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ab94b8f6a32942aab812a2f2058c0399"><span data-offset-key="ab94b8f6a32942aab812a2f2058c0399:0">**Figure 1-7. The same application, but using the Superhero theme from Bootswatch.**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="36db51ce46924a2f9d7671868861fbc6"><span data-offset-key="36db51ce46924a2f9d7671868861fbc6:0">**NOTE**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e484ef4e9aca4e4db3258d3c5855056d"><span data-offset-key="e484ef4e9aca4e4db3258d3c5855056d:0">In the preceding example we also used the </span></span><a href="http://bit.ly/dominate-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="c9b7ccb072df446493105a5c68ff1520"><span data-offset-key="c9b7ccb072df446493105a5c68ff1520:0"><code class="code-0458e21e" spellcheck="false" data-slate-leaf="true">dominate</code></span></span></a><span data-key="5468abe96e2f440b973a35c2cbffbf70"><span data-offset-key="5468abe96e2f440b973a35c2cbffbf70:0"> library, which is a handy utility for generating HTML procedurally. It’s not only for simple tasks: this demo shows how it can handle Bootstrap attributes and widgets quite successfully. </span><span data-offset-key="5468abe96e2f440b973a35c2cbffbf70:1">`dominate`</span><span data-offset-key="5468abe96e2f440b973a35c2cbffbf70:2"> works with nested context managers to manage the scope of HTML tags, while HTML attributes are assigned with keyword arguments.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b32e0ecdb3324f35b6b3b763399c1dd0"><span data-offset-key="b32e0ecdb3324f35b6b3b763399c1dd0:0">For the kind of application that </span><span data-offset-key="b32e0ecdb3324f35b6b3b763399c1dd0:1">`Pywebview`</span><span data-offset-key="b32e0ecdb3324f35b6b3b763399c1dd0:2"> is aimed at, it would be very interesting to think about how </span><span data-offset-key="b32e0ecdb3324f35b6b3b763399c1dd0:3">`dominate`</span><span data-offset-key="b32e0ecdb3324f35b6b3b763399c1dd0:4"> could be used to make an abstraction that completely hides browser technologies like HTML and JavaScript, and lets you create (e.g., button-click handlers) entirely in Python without worrying about the intermediate event processing within the JavaScript engine. This technique is already explored in existing tools like </span></span><a href="http://bit.ly/flexx-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="b616bfc9dc364d0e81d9d2508eb5f505"><span data-offset-key="b616bfc9dc364d0e81d9d2508eb5f505:0">flexx</span></span></a><span data-key="158ae21561a9451e9f87e8ffda81d823"><span data-offset-key="158ae21561a9451e9f87e8ffda81d823:0">.</span></span></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="bc907b19a75b4418bb1d2686939f5c33"><span data-offset-key="bc907b19a75b4418bb1d2686939f5c33:0">System Tools</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0633bbeb4590446b951526506be22a3d"><span data-offset-key="0633bbeb4590446b951526506be22a3d:0">Python is heavily used to make tools that work closely with the operating system, and it should be no surprise to discover that there are excellent libraries waiting to be discovered. The </span><span data-offset-key="0633bbeb4590446b951526506be22a3d:1">`psutil`</span><span data-offset-key="0633bbeb4590446b951526506be22a3d:2"> library gives you all the access to operating-system and process information you could possibly hope for, while the </span><span data-offset-key="0633bbeb4590446b951526506be22a3d:3">`Watchdog`</span><span data-offset-key="0633bbeb4590446b951526506be22a3d:4"> library gives you hooks into system file-event notifications. Finally, we close out this chapter with a look at </span><span data-offset-key="0633bbeb4590446b951526506be22a3d:5">`ptpython`</span><span data-offset-key="0633bbeb4590446b951526506be22a3d:6">, which gives you a significantly enriched interactive Python prompt.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="1566be95ae284c2b9e03b78d0b10a6fa"><span data-offset-key="1566be95ae284c2b9e03b78d0b10a6fa:0">psutil</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2a665d111cf84b01b11b9916e09a0521"><span data-offset-key="2a665d111cf84b01b11b9916e09a0521:0">Psutil provides complete access to system information. Here’s a simple example of a basic report for CPU load sampled over 5 seconds:</span></span></span>

    import psutil​cpu = psutil.cpu_percent(interval=5, percpu=True)print(cpu)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3386dc3000af4224a6a2408037642c77"><span data-offset-key="3386dc3000af4224a6a2408037642c77:0">Output:</span></span></span>

    [21.4, 1.2, 18.0, 1.4, 15.6, 1.8, 17.4, 1.6]

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="add29d4137f74f98a96a07550063e727"><span data-offset-key="add29d4137f74f98a96a07550063e727:0">It produces one value for each logical CPU: on my computer, eight. The rest of the </span><span data-offset-key="add29d4137f74f98a96a07550063e727:1">`psutil`</span><span data-offset-key="add29d4137f74f98a96a07550063e727:2"> API is as simple and clean as this example shows, and the API also provides access to memory, disk, and network information. It is </span><span data-offset-key="add29d4137f74f98a96a07550063e727:3">*very*</span><span data-offset-key="add29d4137f74f98a96a07550063e727:4"> extensive.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7c1af0b45e09430fb0972ab786840930"><span data-offset-key="7c1af0b45e09430fb0972ab786840930:0">There is also detailed information about processes. To demonstrate, here is a program that monitors its own memory consumption and throws in the towel when a limit is reached:</span></span></span>

    import psutilimport os, sys, time​pid = os.getpid()  p = psutil.Process(pid)  print('Process info:')print('  name  :', p.name())print('  exe   :', p.exe())​data = []while True:    data += list(range(100000))      info = p.memory_full_info()    # Convert to MB    memory = info.uss / 1024 / 1024    print('Memory used: {:.2f} MB'.format(memory))    if memory > 40:        print('Memory too big! Exiting.')        sys.exit()    time.sleep(1)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1e09a689e1bc4ee886e20633467995b6"><span data-offset-key="1e09a689e1bc4ee886e20633467995b6:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO16-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="8754c1e85e354f1ab4bf7675ee96d063"><span data-offset-key="8754c1e85e354f1ab4bf7675ee96d063:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="75b87153fc2241be8cb760f430c06d66"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="75b87153fc2241be8cb760f430c06d66"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="0ac8e20a201f4fb7a491e3b5cc5cfba9"><span data-offset-key="0ac8e20a201f4fb7a491e3b5cc5cfba9:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="6029292eb894450983d87af65bd6f6fc"><span data-offset-key="6029292eb894450983d87af65bd6f6fc:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7b2a79ec7f294e5d9cd593df391e4fb0"><span data-offset-key="7b2a79ec7f294e5d9cd593df391e4fb0:0">The </span><span data-offset-key="7b2a79ec7f294e5d9cd593df391e4fb0:1">`os`</span><span data-offset-key="7b2a79ec7f294e5d9cd593df391e4fb0:2"> module in the standard library provides our process ID (PID).</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO16-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="95391ecd1cd04a2cbca835ca6d157c71"><span data-offset-key="95391ecd1cd04a2cbca835ca6d157c71:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="c0249a6a177a4aa1b728aa4a29610b23"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="c0249a6a177a4aa1b728aa4a29610b23"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="8f729ba17cea4449877be53eb495e6ea"><span data-offset-key="8f729ba17cea4449877be53eb495e6ea:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="91056a92b16a4ec99539d8c5b935218d"><span data-offset-key="91056a92b16a4ec99539d8c5b935218d:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="35935e6231204722a960ee32a635253b"><span data-offset-key="35935e6231204722a960ee32a635253b:0">`psutil`</span><span data-offset-key="35935e6231204722a960ee32a635253b:1"> constructs a </span><span data-offset-key="35935e6231204722a960ee32a635253b:2">`Process()`</span><span data-offset-key="35935e6231204722a960ee32a635253b:3"> object based on the PID. In this case the PID is our own, but it could be any running process on the system.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO16-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d3786a8284c8457c989c37c5bb2e52c0"><span data-offset-key="d3786a8284c8457c989c37c5bb2e52c0:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="2d44f1bfae934bd58830171c5cac82fe"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="2d44f1bfae934bd58830171c5cac82fe"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="275635ddcff34d8e85ee9e2bdec7cd15"><span data-offset-key="275635ddcff34d8e85ee9e2bdec7cd15:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="69c363fd08d64c8fbb1a9050928e4627"><span data-offset-key="69c363fd08d64c8fbb1a9050928e4627:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6a1f4d7b0ac04cf1a8adcc7e9589ee2b"><span data-offset-key="6a1f4d7b0ac04cf1a8adcc7e9589ee2b:0">This looks bad: an infinite loop </span><span data-offset-key="6a1f4d7b0ac04cf1a8adcc7e9589ee2b:1">*and*</span><span data-offset-key="6a1f4d7b0ac04cf1a8adcc7e9589ee2b:2"> an ever-growing list!</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="af3651d90640482ca30d8bef98c2efd0"><span data-offset-key="af3651d90640482ca30d8bef98c2efd0:0">Output:</span></span></span>

    Process info:  name  : Python  exe   : /usr/local/Cellar/.../Python  Memory used: 11.82 MBMemory used: 14.91 MBMemory used: 18.77 MBMemory used: 22.63 MBMemory used: 26.48 MBMemory used: 30.34 MBMemory used: 34.19 MBMemory used: 38.05 MBMemory used: 41.90 MBMemory too big! Exiting.

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="485d9d95bbf94757b9398857d89dcf89"><span data-offset-key="485d9d95bbf94757b9398857d89dcf89:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO17-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="776e29b14d4447abbe019bf5166a4baf"><span data-offset-key="776e29b14d4447abbe019bf5166a4baf:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="a2dff13d54524a8aab5196bb905d9799"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="a2dff13d54524a8aab5196bb905d9799"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="e1055689b2344673bf754280e1db08cf"><span data-offset-key="e1055689b2344673bf754280e1db08cf:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="a1fddae5f79e4a8ab97b86baf3ed2866"><span data-offset-key="a1fddae5f79e4a8ab97b86baf3ed2866:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e7f2e75802ce476fbf364deb40eb49e5"><span data-offset-key="e7f2e75802ce476fbf364deb40eb49e5:0">The full path has been shortened here to improve the appearance of the snippet. There are many more methods besides </span><span data-offset-key="e7f2e75802ce476fbf364deb40eb49e5:1">`name`</span><span data-offset-key="e7f2e75802ce476fbf364deb40eb49e5:2"> and </span><span data-offset-key="e7f2e75802ce476fbf364deb40eb49e5:3">`exe`</span><span data-offset-key="e7f2e75802ce476fbf364deb40eb49e5:4"> available on </span><span data-offset-key="e7f2e75802ce476fbf364deb40eb49e5:5">`psutil.Process()`</span><span data-offset-key="e7f2e75802ce476fbf364deb40eb49e5:6"> instances.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="79d79fee720b48b09f6365a61e1ed195"><span data-offset-key="79d79fee720b48b09f6365a61e1ed195:0">The type of memory shown here is the </span><span data-offset-key="79d79fee720b48b09f6365a61e1ed195:1">*unique set size*</span><span data-offset-key="79d79fee720b48b09f6365a61e1ed195:2">, which is the real memory released when that process terminates. The reporting of the unique set size is a new feature in version 4 of </span><span data-offset-key="79d79fee720b48b09f6365a61e1ed195:3">`psutil`</span><span data-offset-key="79d79fee720b48b09f6365a61e1ed195:4">, which also works on Windows.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d02a8ff6da9143a5bcac6125ce20de8e"><span data-offset-key="d02a8ff6da9143a5bcac6125ce20de8e:0">There is an extensive set of process properties you can interrogate with </span><span data-offset-key="d02a8ff6da9143a5bcac6125ce20de8e:1">`psutil`</span><span data-offset-key="d02a8ff6da9143a5bcac6125ce20de8e:2">, and I encourage you to read the documentation. Once you begin using </span><span data-offset-key="d02a8ff6da9143a5bcac6125ce20de8e:3">`psutil`</span><span data-offset-key="d02a8ff6da9143a5bcac6125ce20de8e:4">, you will discover more and more scenarios in which it can make sense to capture process properties. For example, it might be useful, depending on your application, to capture process information inside exception handlers so that your error logging can include information about CPU and memory load.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="dcde9e594b3345d68c7082a273688f65"><span data-offset-key="dcde9e594b3345d68c7082a273688f65:0">Watchdog</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a7907753e02149b6bf9b322a5865c124"><span data-offset-key="a7907753e02149b6bf9b322a5865c124:0">`Watchdog`</span><span data-offset-key="a7907753e02149b6bf9b322a5865c124:1"> is a high-quality, cross-platform library for receiving notifications of changes in the file system. Such file-system notifications is a fundamental requirement in many automation applications, and </span><span data-offset-key="a7907753e02149b6bf9b322a5865c124:2">`Watchdog`</span><span data-offset-key="a7907753e02149b6bf9b322a5865c124:3"> handles all the low-level and cross-platform details of notifications for system events. And, the great thing about </span><span data-offset-key="a7907753e02149b6bf9b322a5865c124:4">`Watchdog`</span><span data-offset-key="a7907753e02149b6bf9b322a5865c124:5"> is that it doesn’t use </span><span data-offset-key="a7907753e02149b6bf9b322a5865c124:6">*polling*</span><span data-offset-key="a7907753e02149b6bf9b322a5865c124:7">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="282eb8a30d4148cfb55ad9945debb8cb"><span data-offset-key="282eb8a30d4148cfb55ad9945debb8cb:0">The problem with polling is that having many such processes running can sometimes consume more resources than you may be willing to part with, particularly on lower-spec systems like the </span></span><a href="https://www.raspberrypi.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="45ac40b8d3574b4ab1573a4f8a05b948"><span data-offset-key="45ac40b8d3574b4ab1573a4f8a05b948:0">Raspberry Pi</span></span></a><span data-key="7a03dd4396d846eca9317f28c1b886f2"><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:0">. By using the native notification systems on each platform, the operating system </span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:1">*tells you*</span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:2"> immediately when something has changed, rather than you having to ask. On Linux, the </span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:3">`inotify`</span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:4"> API is used; on Mac OS X, either </span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:5">`kqueue`</span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:6"> or </span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:7">`FSEvents`</span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:8"> are used; and on Windows, the </span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:9">`ReadDirectoryChangesW`</span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:10"> API is used. </span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:11">`Watchdog`</span><span data-offset-key="7a03dd4396d846eca9317f28c1b886f2:12"> allows you to write cross-platform code and not worry too much about how the sausage is made.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="05720135a67b41c0a9d74669f5370ccb"><span data-offset-key="05720135a67b41c0a9d74669f5370ccb:0">`Watchdog`</span><span data-offset-key="05720135a67b41c0a9d74669f5370ccb:1"> has a mature API, but one way to get immediate use out of it is to use the included </span><span data-offset-key="05720135a67b41c0a9d74669f5370ccb:2">`watchmedo`</span><span data-offset-key="05720135a67b41c0a9d74669f5370ccb:3"> command-line utility to run a shell command when something changes. Here are a few ideas for inspiration:</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e726b360809a499e8238831b00f3d552"><span data-offset-key="e726b360809a499e8238831b00f3d552:0">Compiling template and markup languages:</span></span></span>

    # Compile Jade template language into HTML$ watchmedo shell-command \      --patterns="*.jade" \      --command='pyjade -c jinja "${watch_src_path}"' \        --ignore-directories​# Convert an asciidoc to HTML$ watchmedo shell-command \      --patterns="*.asciidoc" \      --command='asciidoctor "${watch_src_path}"' \        --ignore-directories

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="fa127c29340d4b96bce91b1ae79c62f2"><span data-offset-key="fa127c29340d4b96bce91b1ae79c62f2:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO18-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="0f98db66f019456ebe9911ac31a516e7"><span data-offset-key="0f98db66f019456ebe9911ac31a516e7:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="2aca32cc99e74aa083daf53eb51bfbf5"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="2aca32cc99e74aa083daf53eb51bfbf5"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="c9463893cc6d49928f5ccb80665e22f1"><span data-offset-key="c9463893cc6d49928f5ccb80665e22f1:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="5fd5b8114f2342579ee34ce0d0e9b988"><span data-offset-key="5fd5b8114f2342579ee34ce0d0e9b988:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="307416c38de74eff90c1ae580eb0b21c"><span data-offset-key="307416c38de74eff90c1ae580eb0b21c:0">Watchdog will substitute the name of the specific changed file using this template name.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f9889b910da04e1aab965ec710635f65"><span data-offset-key="f9889b910da04e1aab965ec710635f65:0">Maintenance tasks, like backups or mirroring:</span></span></span>

    # Synchronize files to a server$ watchmedo shell-command \      --patterns="*" \      --command='rsync -avz mydir/ host:/home/ubuntu"'

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f24906dbc929447aa186560c1033c1e3"><span data-offset-key="f24906dbc929447aa186560c1033c1e3:0">Convenience tasks, like automatically running formatters, linters, and tests:</span></span></span>

    # Automatically format Python source code to PEP8(!)$ watchmedo shell-command \      --patterns="*.py" \      --command='pyfmt -i "${watch_src_path}"' \      --ignore-directories

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="040cf7022d174061a6e06ff94f3411db"><span data-offset-key="040cf7022d174061a6e06ff94f3411db:0">Calling API endpoints on the Web, or even sending emails and SMS messages:</span></span></span>

    # Mail a file every time it changes!$ watchmedo shell-command \      --patterns="*" \      --command='cat "${watch_src_path}" | ↲      mail -s "New version" [email protected]' \      --ignore-directories

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f765c4db99ef4b85a741dd67df35114c"><span data-offset-key="f765c4db99ef4b85a741dd67df35114c:0">The API of </span><span data-offset-key="f765c4db99ef4b85a741dd67df35114c:1">`Watchdog`</span><span data-offset-key="f765c4db99ef4b85a741dd67df35114c:2"> as a library is fairly similar to the command-line interface introduced earlier. There are the usual quirks with thread-based programming that you have to be aware of, but the typical idioms are sufficient:</span></span></span>

    from watchdog.observers import Observerfrom watchdog.events import (    PatternMatchingEventHandler, FileModifiedEvent,    FileCreatedEvent)​observer = Observer()  ​class Handler(PatternMatchingEventHandler):    def on_created(self, event: FileCreatedEvent):          print('File Created: ', event.src_path)​    def on_modified(self, event: FileModifiedEvent):          print('File Modified: %s [%s]' % (            event.src_path, event.event_type))​observer.schedule(event_handler=Handler('*'), path='.')  observer.daemon = Falseobserver.start()​try:    observer.join() except KeyboardInterrupt:    print('Stopped.')    observer.stop()    observer.join()

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="aa6accb1c59844cebb268eb08c1bd0e5"><span data-offset-key="aa6accb1c59844cebb268eb08c1bd0e5:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO19-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="f74d21f8bb4244e1b693683b879f8860"><span data-offset-key="f74d21f8bb4244e1b693683b879f8860:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="ca951ef40a8243c28fb78c0414664960"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="ca951ef40a8243c28fb78c0414664960"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="483a490ecd164e15aaa76d226ad516f9"><span data-offset-key="483a490ecd164e15aaa76d226ad516f9:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="0605f8e60bd64d149dd6392992925fc8"><span data-offset-key="0605f8e60bd64d149dd6392992925fc8:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3465161eb3ee4489acb113749bd32064"><span data-offset-key="3465161eb3ee4489acb113749bd32064:0">Create an </span><span data-offset-key="3465161eb3ee4489acb113749bd32064:1">*observer*</span><span data-offset-key="3465161eb3ee4489acb113749bd32064:2"> instance.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO19-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="19c2585fafaf42f1bfbd760305f04a1e"><span data-offset-key="19c2585fafaf42f1bfbd760305f04a1e:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="613e17841a3248beb389bb100d08e6be"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="613e17841a3248beb389bb100d08e6be"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="7acf9397f8f64166958d0f3131ca511b"><span data-offset-key="7acf9397f8f64166958d0f3131ca511b:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="edcc6ec08953412d87991864b9efddb1"><span data-offset-key="edcc6ec08953412d87991864b9efddb1:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="012d73902d0f4ea7a597e5264188e9b9"><span data-offset-key="012d73902d0f4ea7a597e5264188e9b9:0">You have to subclass one of the </span><span data-offset-key="012d73902d0f4ea7a597e5264188e9b9:1">*handler*</span><span data-offset-key="012d73902d0f4ea7a597e5264188e9b9:2"> classes, and override the methods for events that you want to process. Here I’ve implemented handlers for creation and modification, but there are several other methods you can supply, as explained in the </span></span><a href="http://bit.ly/watchdog-docs" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="29c3c038ceb44e8db0d455839fa98898"><span data-offset-key="29c3c038ceb44e8db0d455839fa98898:0">documentation</span></span></a><span data-key="ff084a68bf74410ca9de005a65b3c344"><span data-offset-key="ff084a68bf74410ca9de005a65b3c344:0">.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO19-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="2ba2f3a1a98f4b7da3f5d70b80700cd7"><span data-offset-key="2ba2f3a1a98f4b7da3f5d70b80700cd7:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="31d49fa0eaa14525b233e9b1dc05e188"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="31d49fa0eaa14525b233e9b1dc05e188"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="5465dd480f8f40b886466c3c6fd71abd"><span data-offset-key="5465dd480f8f40b886466c3c6fd71abd:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="e869f3d68ee04cfba91891a83b24aad5"><span data-offset-key="e869f3d68ee04cfba91891a83b24aad5:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f69664b52a8d483ea84598aae1cdb15b"><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:0">You </span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:1">*schedule*</span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:2"> the event handler, and tell </span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:3">`watchdog`</span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:4"> what it should be watching. In this case I’ve asked for notifications on </span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:5">*all files*</span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:6"> (</span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:7">`*`</span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:8">) n the </span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:9">*current directory*</span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:10"> (</span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:11">`.`</span><span data-offset-key="f69664b52a8d483ea84598aae1cdb15b:12">).</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO19-5" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="5e96b1c44e7f4ad7896db5fad4e52762"><span data-offset-key="5e96b1c44e7f4ad7896db5fad4e52762:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="b992fff5ce9546e69e56842acecbd3c4"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="b992fff5ce9546e69e56842acecbd3c4"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="765e4e3187c24e82b1fdcbb389d8ae3a"><span data-offset-key="765e4e3187c24e82b1fdcbb389d8ae3a:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="69aa0f59894542ad932774e227fa56f3"><span data-offset-key="69aa0f59894542ad932774e227fa56f3:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2f21b9d2d9c74d82abef488b7c593714"><span data-offset-key="2f21b9d2d9c74d82abef488b7c593714:0">`Watchdog`</span><span data-offset-key="2f21b9d2d9c74d82abef488b7c593714:1"> runs in a separate thread. By calling the </span><span data-offset-key="2f21b9d2d9c74d82abef488b7c593714:2">`join()`</span><span data-offset-key="2f21b9d2d9c74d82abef488b7c593714:3"> method, you can force the program flow to block at this point.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="36064f2875374a1f8275825b5fc01335"><span data-offset-key="36064f2875374a1f8275825b5fc01335:0">With that code running, I cunningly executed a few of these:</span></span></span>

    $ touch secrets.txt$ touch secrets.txt$ touch secrets.txt[etc]

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b95c7af913ea43ec908b37f8931a86b5"><span data-offset-key="b95c7af913ea43ec908b37f8931a86b5:0">This is the console output from the running </span><span data-offset-key="b95c7af913ea43ec908b37f8931a86b5:1">`Watchdog`</span><span data-offset-key="b95c7af913ea43ec908b37f8931a86b5:2"> demo:</span></span></span>

    File Created:  ./secrets.txtFile Modified: . [modified]File Modified: ./secrets.txt [modified]File Modified: ./secrets.txt [modified]File Modified: ./secrets.txt [modified]File Modified: ./secrets.txt [modified]Stopped. ​Process finished with exit code 0

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b0b2cfb9fa82468799487be019c3f387"><span data-offset-key="b0b2cfb9fa82468799487be019c3f387:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO20-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="49999ba7b94e477fba9209063f0a30c3"><span data-offset-key="49999ba7b94e477fba9209063f0a30c3:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="02d9d6df0cef49c5bf9d216dc2fab8c9"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="02d9d6df0cef49c5bf9d216dc2fab8c9"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="fb90e82ff7e54b39ad208c87ae9909de"><span data-offset-key="fb90e82ff7e54b39ad208c87ae9909de:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="13a753dc393449e4825828c05f3d8ee0"><span data-offset-key="13a753dc393449e4825828c05f3d8ee0:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="24ba62a1203145aa9e5c6e0fa0072412"><span data-offset-key="24ba62a1203145aa9e5c6e0fa0072412:0">Here I terminated the program by pressing Ctrl-C.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="147b5d9a82494cc1847a4765b02250d7"><span data-offset-key="147b5d9a82494cc1847a4765b02250d7:0">As we can see, </span><span data-offset-key="147b5d9a82494cc1847a4765b02250d7:1">`Watchdog`</span><span data-offset-key="147b5d9a82494cc1847a4765b02250d7:2"> saw all the modifications I made to a file in the directory being watched.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="d39827f6c74e42f8a1e1f76c1083006e"><span data-offset-key="d39827f6c74e42f8a1e1f76c1083006e:0">ptpython</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="933a5151df1f415d8a360539c9bdb608"><span data-offset-key="933a5151df1f415d8a360539c9bdb608:0">`ptpython`</span><span data-offset-key="933a5151df1f415d8a360539c9bdb608:1"> is an alternative interpreter interface, offering a beautiful interactive Python experience. As such, </span><span data-offset-key="933a5151df1f415d8a360539c9bdb608:2">`ptpython`</span><span data-offset-key="933a5151df1f415d8a360539c9bdb608:3"> is more like a tool than a library to include in your own projects, but what a tool! </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#ptpy_completion" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="ed749f4784314479a4546d716e577857"><span data-offset-key="ed749f4784314479a4546d716e577857:0">Figure 1-8</span></span></a><span data-key="5c9bd063ff12417f9cbfac8fd1f39643"><span data-offset-key="5c9bd063ff12417f9cbfac8fd1f39643:0"> shows a screenshot showing the basic user interface.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7f4636f6130c4a7391b4cef5d3dcd0dd"><span data-offset-key="7f4636f6130c4a7391b4cef5d3dcd0dd:0">When you need to work with blocks in the interpreter, like classes and functions, you will find that accessing the command history is much more convenient than the standard interpreter interface: when you scroll to a previous command, the entire block is shown, not only single lines, as shown in </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#ptpy_history" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d21a8324fc9a4f79bac431ab22dd9829"><span data-offset-key="d21a8324fc9a4f79bac431ab22dd9829:0">Figure 1-9</span></span></a><span data-key="a2355c2c1fc141458a72fbc5fc8ee53e"><span data-offset-key="a2355c2c1fc141458a72fbc5fc8ee53e:0">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c79bee7c56954236a4d923f29a63374f"><span data-offset-key="c79bee7c56954236a4d923f29a63374f:0">Here, I retrieved the code for the function declaration by pressing the up arrow (or Ctrl-p) and the entire block is shown, rather than having to scroll through lines separately.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="14b8209443434e5592786752bcc65eb7"><span data-offset-key="14b8209443434e5592786752bcc65eb7:0">The additional features include </span><span data-offset-key="14b8209443434e5592786752bcc65eb7:1">*vi*</span><span data-offset-key="14b8209443434e5592786752bcc65eb7:2"> and </span><span data-offset-key="14b8209443434e5592786752bcc65eb7:3">*Emacs*</span><span data-offset-key="14b8209443434e5592786752bcc65eb7:4"> keys, theming support, docstring hinting, and input validation, which checks a command (or block) for syntax errors before allowing evaluation. To see the full set of configurable options, press F2, as seen in </span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#ptpy_menu" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="a39e2e64c48b4a0f974ceefaf4cd1c6d"><span data-offset-key="a39e2e64c48b4a0f974ceefaf4cd1c6d:0">Figure 1-10</span></span></a><span data-key="abf86828f7d34eba87e1c3e1e4376df6"><span data-offset-key="abf86828f7d34eba87e1c3e1e4376df6:0">.</span></span><span data-slate-void="true" data-key="48a0d2ab1f88464682ceeb68000aa27c"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="48a0d2ab1f88464682ceeb68000aa27c"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0701.png" alt="tply 0701" class="image-67b14f24--image-54d049be" /></span></span><span data-key="ede476bf3312423fb0cee38ca9b103af"><span data-offset-key="ede476bf3312423fb0cee38ca9b103af:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="10cd197adfda41a19b9a077ed9b553ef"><span data-offset-key="10cd197adfda41a19b9a077ed9b553ef:0">**Figure 1-8. The code-completion suggestions pop up automatically as you type.**</span></span></span>

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0702.png" alt="tply 0702" class="image-52799b3c" /><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width:100%">tply 0702</span></figcaption></figure>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="468f4b8654fc43fa9560c2fe105473d8"><span data-offset-key="468f4b8654fc43fa9560c2fe105473d8:0">**Figure 1-9. When you scroll to previous entries, entire blocks are suggested (e.g., function f()), not only single lines.**</span></span></span>

<figure><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0703.png" alt="tply 0703" class="image-52799b3c" /><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width:100%">tply 0703</span></figcaption></figure>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="eef17fc371ab4927af955f0a6b1d2e17"><span data-offset-key="eef17fc371ab4927af955f0a6b1d2e17:0">**Figure 1-10. The settings menu accessible via F2.**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2dcfc5c92ff14c71b7e1105881a5ee06"><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:0">On the command line, </span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:1">`ptpython`</span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:2"> offers highly productive features that are sure to enhance your workflow. I have found that </span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:3">`ptpython`</span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:4"> is the fastest way to quickly test some syntax or a library call, without having to open an editor or integrated development environment (IDE). And if you prefer </span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:5">*IPython*</span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:6">, you’ll be glad to hear that </span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:7">`ptpython`</span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:8"> includes an integration which you can launch with </span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:9">`ptipython`</span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:10">. This makes available the shell integration that </span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:11">*IPython*</span><span data-offset-key="2dcfc5c92ff14c71b7e1105881a5ee06:12"> offers, as well as its wealth of magic commands.</span></span></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="bd725e4c855c4c448e01f7618203a757"><span data-offset-key="bd725e4c855c4c448e01f7618203a757:0">Web APIs with hug</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="16ae3c34430742cfb9ab21c086b3a647"><span data-offset-key="16ae3c34430742cfb9ab21c086b3a647:0">Python is famously used in a large number of web frameworks, and an extension of this area is the web services domain in which APIs are exposed for other users’ programs to consume. In this domain, </span></span><a href="http://www.django-rest-framework.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="8d052d46396b454cb23fb44c8d340c19"><span data-offset-key="8d052d46396b454cb23fb44c8d340c19:0">Django REST framework</span></span></a><span data-key="44ac1d9fdc3d4addb0e88861bbf563bc"><span data-offset-key="44ac1d9fdc3d4addb0e88861bbf563bc:0"> and </span></span><a href="http://flask.pocoo.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="1981e875a2584fbea0a52fde59dfc7aa"><span data-offset-key="1981e875a2584fbea0a52fde59dfc7aa:0">Flask</span></span></a><span data-key="a125e91fe5064e6b8128e2e70fb6547d"><span data-offset-key="a125e91fe5064e6b8128e2e70fb6547d:0"> are very popular choices, but you may not yet have heard of </span><span data-offset-key="a125e91fe5064e6b8128e2e70fb6547d:1">`hug`</span><span data-offset-key="a125e91fe5064e6b8128e2e70fb6547d:2">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="bab9bd20bc7044a899bea77d9edac87f"><span data-offset-key="bab9bd20bc7044a899bea77d9edac87f:0"><span data-slate-zero-width="z">​</span></span></span><a href="http://www.hug.rest/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="e6609468e6314da792c391ca64f24e10"><span data-offset-key="e6609468e6314da792c391ca64f24e10:0">hug</span></span></a><span data-key="95462aa805204b37b6474d7b5d9f8e56"><span data-offset-key="95462aa805204b37b6474d7b5d9f8e56:0"> is a library that provides an extremely simple way to create Internet APIs for web services. By exploiting some of the language features of Python, much of the usual boilerplate normally required when creating APIs for web services is removed.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3643bfaf064f4a59b8e3765553bb9e5b"><span data-offset-key="3643bfaf064f4a59b8e3765553bb9e5b:0">Here is a small web service that converts between the hex value of a color and its </span></span><a href="http://bit.ly/w3-hex" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="0f6dc0f14caf498f83f8717c209701eb"><span data-offset-key="0f6dc0f14caf498f83f8717c209701eb:0">CSS3 name</span></span></a><span data-key="13bb4d125d434919b3ab8c011ca582ba"><span data-offset-key="13bb4d125d434919b3ab8c011ca582ba:0">:</span></span></span>

    import hugimport webcolors​@hug.get()def hextoname(hex: hug.types.text):    return webcolors.hex_to_name('#' + hex)​@hug.get()def nametohex(name: hug.types.text):    return webcolors.name_to_hex(name)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a91854d9dfaa4ce28fa7e35cca5a8f15"><span data-offset-key="a91854d9dfaa4ce28fa7e35cca5a8f15:0">**NOTE**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5920aaece7944f0ebad660096ffdb2e2"><span data-offset-key="5920aaece7944f0ebad660096ffdb2e2:0">We are also using the </span></span><a href="https://webcolors.readthedocs.io/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="a6243b134aa74e148a9eef703292cd6e"><span data-offset-key="a6243b134aa74e148a9eef703292cd6e:0">webcolors</span></span></a><span data-key="5a44dc7d839e4ae4ba0b21e4f0078166"><span data-offset-key="5a44dc7d839e4ae4ba0b21e4f0078166:0"> library here: your one-stop shop for converting web-safe colors between various formats like name, hex, and </span><span data-offset-key="5a44dc7d839e4ae4ba0b21e4f0078166:1">`rgb`</span><span data-offset-key="5a44dc7d839e4ae4ba0b21e4f0078166:2">. Don’t forget that you can also convert between </span><span data-offset-key="5a44dc7d839e4ae4ba0b21e4f0078166:3">`rgb`</span><span data-offset-key="5a44dc7d839e4ae4ba0b21e4f0078166:4"> and other formats like </span><span data-offset-key="5a44dc7d839e4ae4ba0b21e4f0078166:5">`hsl`</span><span data-offset-key="5a44dc7d839e4ae4ba0b21e4f0078166:6"> with the </span></span><a href="http://bit.ly/colorsys" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="b159121a6e9b45e3a433bc1858a7bc1b"><span data-offset-key="b159121a6e9b45e3a433bc1858a7bc1b:0">colorsys</span></span></a><span data-key="f4e6a6d2583e4fedadd3459b3dfd0fcb"><span data-offset-key="f4e6a6d2583e4fedadd3459b3dfd0fcb:0"> library that’s already included in the Python standard library!</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="45ddf136aaf64ab68c07f9a610845296"><span data-offset-key="45ddf136aaf64ab68c07f9a610845296:0">In the </span><span data-offset-key="45ddf136aaf64ab68c07f9a610845296:1">`hug`</span><span data-offset-key="45ddf136aaf64ab68c07f9a610845296:2"> example, we’ve done little more than wrap two functions from the </span><span data-offset-key="45ddf136aaf64ab68c07f9a610845296:3">`webcolors`</span><span data-offset-key="45ddf136aaf64ab68c07f9a610845296:4"> package: one to convert from hex to name and one to do the opposite. It’s hard to believe at first, but those </span><span data-offset-key="45ddf136aaf64ab68c07f9a610845296:5">`@hug.get`</span><span data-offset-key="45ddf136aaf64ab68c07f9a610845296:6"> decorators are all you need to start a basic API. The server is launched by using the included </span><span data-offset-key="45ddf136aaf64ab68c07f9a610845296:7">`hug`</span><span data-offset-key="45ddf136aaf64ab68c07f9a610845296:8"> command-line tool (</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#hug" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="7a1b3dc20d7442b2b6e25588abf48e01"><span data-offset-key="7a1b3dc20d7442b2b6e25588abf48e01:0">Figure 1-11</span></span></a><span data-key="448c9f25422943e18003a6274b4eaa6f"><span data-offset-key="448c9f25422943e18003a6274b4eaa6f:0">).</span></span><span data-slate-void="true" data-key="c273f97e2da1487690b8270b6bc119cf"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="c273f97e2da1487690b8270b6bc119cf"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/tply_0704.png" alt="tply 0704" class="image-67b14f24--image-54d049be" /></span></span><span data-key="787d0d77371c4e7f8436b439ee91d830"><span data-offset-key="787d0d77371c4e7f8436b439ee91d830:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5c2ae2ff05f148d0b8cb349bd0de4f2f"><span data-offset-key="5c2ae2ff05f148d0b8cb349bd0de4f2f:0">**Figure 1-11. Hug goes a long way to make you feel welcome.**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="770968e35f984a138b6c96ac4cfe7de0"><span data-offset-key="770968e35f984a138b6c96ac4cfe7de0:0">And that’s it! We can immediately test our API. You could use a web browser for this, but it’s easy enough to use a tool like </span><span data-offset-key="770968e35f984a138b6c96ac4cfe7de0:1">`cURL`</span><span data-offset-key="770968e35f984a138b6c96ac4cfe7de0:2">. You call the URL endpoint with the correct parameters, and </span><span data-offset-key="770968e35f984a138b6c96ac4cfe7de0:3">`hug`</span><span data-offset-key="770968e35f984a138b6c96ac4cfe7de0:4"> returns the answer:</span></span></span>

    $ curl http://localhost:8000/hextoname?hex=ff0000  ​"red"​$ curl http://localhost:8000/nametohex?name=lightskyblue  ​"#87cefa"

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4b521f6e71e84789b4d497ac03b91fcf"><span data-offset-key="4b521f6e71e84789b4d497ac03b91fcf:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO21-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="a09e9ff17b86474da00488234fc226b9"><span data-offset-key="a09e9ff17b86474da00488234fc226b9:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="088c1fef7e044f6eb2412c8be1210d03"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="088c1fef7e044f6eb2412c8be1210d03"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="d43af478c3414246a23f0034f4d68005"><span data-offset-key="d43af478c3414246a23f0034f4d68005:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="a85d76db9cda423daee398af711805ea"><span data-offset-key="a85d76db9cda423daee398af711805ea:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a702d538f0d04d63a0e2ae83e3ec1e64"><span data-offset-key="a702d538f0d04d63a0e2ae83e3ec1e64:0">The function name was </span><span data-offset-key="a702d538f0d04d63a0e2ae83e3ec1e64:1">`hextoname`</span><span data-offset-key="a702d538f0d04d63a0e2ae83e3ec1e64:2">, and the parameter name was </span><span data-offset-key="a702d538f0d04d63a0e2ae83e3ec1e64:3">`hex`</span><span data-offset-key="a702d538f0d04d63a0e2ae83e3ec1e64:4">. Note that we don’t supply the hash, </span><span data-offset-key="a702d538f0d04d63a0e2ae83e3ec1e64:5">`#`</span><span data-offset-key="a702d538f0d04d63a0e2ae83e3ec1e64:6">, as part of the request data because it interferes with the parsing of the HTTP request.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO21-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="db65e16feeab48b2b909ca958099a5fc"><span data-offset-key="db65e16feeab48b2b909ca958099a5fc:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="b689b3306b73442e95996cc428a652fe"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="b689b3306b73442e95996cc428a652fe"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="58fd162102d84689a818163137039c5c"><span data-offset-key="58fd162102d84689a818163137039c5c:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="d9a888e8324e40d7b2f27c8742510f60"><span data-offset-key="d9a888e8324e40d7b2f27c8742510f60:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3e5995b5c6fe40628a41e9fe47fc4da4"><span data-offset-key="3e5995b5c6fe40628a41e9fe47fc4da4:0">This API has a different endpoint function, </span><span data-offset-key="3e5995b5c6fe40628a41e9fe47fc4da4:1">`nametohex`</span><span data-offset-key="3e5995b5c6fe40628a41e9fe47fc4da4:2">, and its parameter is called </span><span data-offset-key="3e5995b5c6fe40628a41e9fe47fc4da4:3">`name`</span><span data-offset-key="3e5995b5c6fe40628a41e9fe47fc4da4:4">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="197296b849cf4e18ac0e17448b3fc476"><span data-offset-key="197296b849cf4e18ac0e17448b3fc476:0">It’s quite impressive to get a live web API up with so little work. And the features don’t stop there: </span><span data-offset-key="197296b849cf4e18ac0e17448b3fc476:1">`hug`</span><span data-offset-key="197296b849cf4e18ac0e17448b3fc476:2"> automatically generates API documentation, which is what you get by omitting an endpoint:</span></span></span>

    $ curl http://localhost:8000/{  "404": "The API call you tried to make was not defined. Here's      a definition of the API to help you get going :)",  "documentation": {    "handlers": {      "/hextoname": {        "GET": {          "outputs": {            "format": "JSON (Javascript Serialized                Object Notation)",            "content_type": "application/json"          },          "inputs": {            "hex": {              "type": "Basic text / string value"            }          }        }      },      "/nametohex": {        "GET": {          "outputs": {            "format": "JSON (Javascript Serialized                Object Notation)",            "content_type": "application/json"          },          "inputs": {            "name": {            "type": "Basic text / string value"            }          }        }      }    }  }}

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9e614fae8c1548f0b24e2ed17846d122"><span data-offset-key="9e614fae8c1548f0b24e2ed17846d122:0">The types of the parameters we specified with </span><span data-offset-key="9e614fae8c1548f0b24e2ed17846d122:1">`hug.types.text`</span><span data-offset-key="9e614fae8c1548f0b24e2ed17846d122:2"> are used not only for the documentation, but also for type conversions.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2bbd7e5c032b44de9dcff7f0cda106e3"><span data-offset-key="2bbd7e5c032b44de9dcff7f0cda106e3:0">If these were all the features provided by </span><span data-offset-key="2bbd7e5c032b44de9dcff7f0cda106e3:1">`hug`</span><span data-offset-key="2bbd7e5c032b44de9dcff7f0cda106e3:2">, it would already be enough for many API tasks; however, one of hug’s best features is that it automatically handles versions. Consider the following example:</span></span></span>

    import hugimport inflect  engine = inflect.engine()​@hug.get(versions=1)def singular(word: hug.types.text):    """ Return the singular version of the word"""    return engine.singular_noun(word).lower()  ​@hug.get(versions=1)def plural(word: hug.types.text):    """ Return the plural version of the word"""    return engine.plural(word).lower()  ​@hug.get(versions=2)def singular(word: hug.types.text):    """ Return the singular of word, preserving case """    return engine.singular_noun(word)  ​@hug.get(versions=2)def plural(word: hug.types.text):    """ Return the plural of word, preserving case """    return engine.plural(word)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f9fca07a89464796950c9ae1d7f95886"><span data-offset-key="f9fca07a89464796950c9ae1d7f95886:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO22-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="0d9fcaf989b846a39d4dc7a1b17508bf"><span data-offset-key="0d9fcaf989b846a39d4dc7a1b17508bf:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="ecde5724ceaf4f2690555b084c3a7e9a"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="ecde5724ceaf4f2690555b084c3a7e9a"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="b4a17da5125643a7b2459cbe34faca3c"><span data-offset-key="b4a17da5125643a7b2459cbe34faca3c:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="03f6fa87b01846cbb8470653a6401305"><span data-offset-key="03f6fa87b01846cbb8470653a6401305:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5b3bcaadf63940ea83f43c5b1db8d421"><span data-offset-key="5b3bcaadf63940ea83f43c5b1db8d421:0">This new </span><span data-offset-key="5b3bcaadf63940ea83f43c5b1db8d421:1">`hug`</span><span data-offset-key="5b3bcaadf63940ea83f43c5b1db8d421:2"> API wraps the </span><span data-offset-key="5b3bcaadf63940ea83f43c5b1db8d421:3">`inflect`</span><span data-offset-key="5b3bcaadf63940ea83f43c5b1db8d421:4"> package, which provides tools for word manipulation.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO22-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="4798dffadf0d4b098498883e44108238"><span data-offset-key="4798dffadf0d4b098498883e44108238:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="b5943a6df16b426a8546a22ccca61b02"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="b5943a6df16b426a8546a22ccca61b02"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="bc15ce80136c4a879f7fc757496e75a2"><span data-offset-key="bc15ce80136c4a879f7fc757496e75a2:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="4a65bc0d0758429b8a3a6ab54328503f"><span data-offset-key="4a65bc0d0758429b8a3a6ab54328503f:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6715538d01c74f0ab776fa4ff9c4de97"><span data-offset-key="6715538d01c74f0ab776fa4ff9c4de97:0">The first version of the API returns lowercased results.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO22-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="a1bac9992cf44446bd6f595ff060ae80"><span data-offset-key="a1bac9992cf44446bd6f595ff060ae80:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="6566cc1ceacf4bf295732f2e4ca57dd0"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="6566cc1ceacf4bf295732f2e4ca57dd0"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="5b385ff77f2b4096bbc44cef969de425"><span data-offset-key="5b385ff77f2b4096bbc44cef969de425:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="329eaceb398c40598fcd78a32d78a170"><span data-offset-key="329eaceb398c40598fcd78a32d78a170:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="111b9a9ebd8d4d91bbe323e7e4fe4073"><span data-offset-key="111b9a9ebd8d4d91bbe323e7e4fe4073:0">The second, newer version of the </span><span data-offset-key="111b9a9ebd8d4d91bbe323e7e4fe4073:1">*same API*</span><span data-offset-key="111b9a9ebd8d4d91bbe323e7e4fe4073:2"> returns the result as calculated by </span><span data-offset-key="111b9a9ebd8d4d91bbe323e7e4fe4073:3">`inflect`</span><span data-offset-key="111b9a9ebd8d4d91bbe323e7e4fe4073:4">, without any alteration.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8e413544d40e425e830789690d74569b"><span data-offset-key="8e413544d40e425e830789690d74569b:0">**NOTE**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c1e156eb3e3642eca11e4761995110ab"><span data-offset-key="c1e156eb3e3642eca11e4761995110ab:0">We are also using the </span></span><a href="http://bit.ly/inflect-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="51e8af564e7c4d1fb170540e10f865d2"><span data-offset-key="51e8af564e7c4d1fb170540e10f865d2:0">inflect</span></span></a><span data-key="cbdd563ddc8f415180dba5568443026a"><span data-offset-key="cbdd563ddc8f415180dba5568443026a:0"> library, which makes an enormous number of word transformations possible, including pluralization, gender transformation of pronouns, counting (“was no error” versus “were no errors”), correct article selection (“a,” “an,” and “the”), Roman numerals, and many more!</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="32dc6922f6134c3ba695bf76295dd2d2"><span data-offset-key="32dc6922f6134c3ba695bf76295dd2d2:0">Imagine that we’ve created this web service to provide an API to transform words into their singular or plural version: one apple, many apples, and so on. For some reason that now escapes us, in the first release we lowercased the results before returning them:</span></span></span>

    $ curl http://localhost:8000/v1/singular/?word=Silly%20Walks  ​"silly walk"​​$ curl http://localhost:8000/v1/plural?word=Crisis​"crises"

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e23879b8ef4446acad3bbac5dc90675a"><span data-offset-key="e23879b8ef4446acad3bbac5dc90675a:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO23-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="35b59294abbb4a8bb80dab4264a10d16"><span data-offset-key="35b59294abbb4a8bb80dab4264a10d16:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="3112ea2039fb446c84397a6810fccabd"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="3112ea2039fb446c84397a6810fccabd"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="6ef33c465b714d7a9bd963b9905d4921"><span data-offset-key="6ef33c465b714d7a9bd963b9905d4921:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="ea5e538cc6634f4eabe20992c0edb7f6"><span data-offset-key="ea5e538cc6634f4eabe20992c0edb7f6:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c37e32c97c6e4262b879ddb47f0baa71"><span data-offset-key="c37e32c97c6e4262b879ddb47f0baa71:0">Note: the URL now has a “v1” specifier for “version 1.”</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="fd859354cd964818b3e01e397f32e70c"><span data-offset-key="fd859354cd964818b3e01e397f32e70c:0">It didn’t occur to us that some users may </span><span data-offset-key="fd859354cd964818b3e01e397f32e70c:1">*prefer*</span><span data-offset-key="fd859354cd964818b3e01e397f32e70c:2"> to have the case of input words preserved: for example, if a word at the beginning of a sentence is being altered, it would be best to preserve the capitalization. Fortunately, the </span><span data-offset-key="fd859354cd964818b3e01e397f32e70c:3">`inflect`</span><span data-offset-key="fd859354cd964818b3e01e397f32e70c:4"> library already does this by default, and </span><span data-offset-key="fd859354cd964818b3e01e397f32e70c:5">`hug`</span><span data-offset-key="fd859354cd964818b3e01e397f32e70c:6"> provides versioning that allows us to provide a second version of the API (so as not to hurt existing users who may expect the lower-case transformation):</span></span></span>

    $ curl http://localhost:8000/v2/singular/?word=Silly%20Walks​"Silly Walk"​​$ curl http://localhost:8000/v2/plural/?word=Crisis​"Crises"

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b3a79bbc0dea415fa3650d59683ed4e9"><span data-offset-key="b3a79bbc0dea415fa3650d59683ed4e9:0">These API calls use version 2 of our web service. And finally, the documentation is also versioned, and for this example, you can see how the function </span><span data-offset-key="b3a79bbc0dea415fa3650d59683ed4e9:1">*docstrings*</span><span data-offset-key="b3a79bbc0dea415fa3650d59683ed4e9:2"> are also incorporated as usage text:</span></span></span>

    $ curl http://localhost:8000/v2/  {  "404": "The API call you tried to make was not defined. Here's      a definition of the API to help you get going :)",  "documentation": {    "version": 2,      "versions": [      1,      2    ],    "handlers": {      "/singular": {        "GET": {          "usage": " Return the singular of word,              preserving case ",            "outputs": {            "format": "JSON (Javascript Serialized                Object Notation)",            "content_type": "application/json"          },          "inputs": {            "word": {              "type": "Basic text / string value"            }          }        }      },​[snip...]

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d8bf6027b0624cb195cb12be6250588d"><span data-offset-key="d8bf6027b0624cb195cb12be6250588d:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO24-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="b77c3446f08b48818e7a860f3cc6dc1a"><span data-offset-key="b77c3446f08b48818e7a860f3cc6dc1a:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="fcf87156c3024f1db4306aef2bd1971c"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="fcf87156c3024f1db4306aef2bd1971c"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="e17bad2d1dc24cc8a9fb397d2d888e23"><span data-offset-key="e17bad2d1dc24cc8a9fb397d2d888e23:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="f24155d73b1a438b8b47f4fdb63ea29b"><span data-offset-key="f24155d73b1a438b8b47f4fdb63ea29b:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="564e94443400457abefac5159a027055"><span data-offset-key="564e94443400457abefac5159a027055:0">Each version has separate documentation, and calling that version endpoint, i.e., </span><span data-offset-key="564e94443400457abefac5159a027055:1">`v2`</span><span data-offset-key="564e94443400457abefac5159a027055:2">, returns the documentation for that version.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO24-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="5eb21c824942440ebb222817b7b62257"><span data-offset-key="5eb21c824942440ebb222817b7b62257:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="8399851fabc5498ca1c310d8947cadc3"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="8399851fabc5498ca1c310d8947cadc3"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="9aab7103ef5d4985975cd7669d565cea"><span data-offset-key="9aab7103ef5d4985975cd7669d565cea:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="c0b2f6a788af4ffe8a992a90fd62c85a"><span data-offset-key="c0b2f6a788af4ffe8a992a90fd62c85a:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5724a92fb4e84e929764304b68d8fa2f"><span data-offset-key="5724a92fb4e84e929764304b68d8fa2f:0">The </span><span data-offset-key="5724a92fb4e84e929764304b68d8fa2f:1">*docstring*</span><span data-offset-key="5724a92fb4e84e929764304b68d8fa2f:2"> of each function is reused as the usage text for that API call.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b693b9fa688f4fbe92038737835a8934"><span data-offset-key="b693b9fa688f4fbe92038737835a8934:0">`hug`</span><span data-offset-key="b693b9fa688f4fbe92038737835a8934:1"> has </span></span><a href="http://www.hug.rest/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d6dbc133a11a471d8305db98a476489e"><span data-offset-key="d6dbc133a11a471d8305db98a476489e:0">extensive documentation</span></span></a><span data-key="bf36a8d1c4b244469fa202cf923f820e"><span data-offset-key="bf36a8d1c4b244469fa202cf923f820e:0"> in which there are even more features to discover. With the exploding interest in internet-of-things applications, it is likely that simple and powerful libraries like </span><span data-offset-key="bf36a8d1c4b244469fa202cf923f820e:1">`hug`</span><span data-offset-key="bf36a8d1c4b244469fa202cf923f820e:2"> will enjoy widespread popularity.</span></span></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="df798920f3dc476cad99e2a76965887d"><span data-offset-key="df798920f3dc476cad99e2a76965887d:0">Dates and Times</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e41e045151f74bcc8bc9c5e5e7c52a4e"><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:0">Many Python users cite two major pain points: the first is </span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:1">*packaging*</span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:2">, and for this we covered </span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:3">`flit`</span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:4"> in an earlier chapter. The second is working with dates and times. In this chapter we cover two libraries that will make an enormous difference in how you deal with temporal matters. </span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:5">`arrow`</span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:6"> is a reimagined library for working with </span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:7">`datetime`</span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:8"> objects in which timezones are always present, which helps to minimize a large class of errors that new Python programmers encounter frequently. </span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:9">`parsedatetime`</span><span data-offset-key="e41e045151f74bcc8bc9c5e5e7c52a4e:10"> is a library that lets your code parse natural-language inputs for dates and times, which can make it vastly easier for your users to provide such information.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="07cf2ad3de364f8b8878d05ccc710738"><span data-offset-key="07cf2ad3de364f8b8878d05ccc710738:0">arrow</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c3464e13f7794e6e80ce625d86f3993e"><span data-offset-key="c3464e13f7794e6e80ce625d86f3993e:0">Though opinions differ, there are those who have found the standard library’s </span><span data-offset-key="c3464e13f7794e6e80ce625d86f3993e:1">`datetime`</span><span data-offset-key="c3464e13f7794e6e80ce625d86f3993e:2"> module confusing to use. The module documentation itself in the </span></span><a href="http://bit.ly/datetime-module" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="7d7632a273034ebcbbae976c16816297"><span data-offset-key="7d7632a273034ebcbbae976c16816297:0">first few paragraphs</span></span></a><span data-key="7883604481bd45f8b53fad619c662760"><span data-offset-key="7883604481bd45f8b53fad619c662760:0"> explains why: it provides both </span><span data-offset-key="7883604481bd45f8b53fad619c662760:1">*naive*</span><span data-offset-key="7883604481bd45f8b53fad619c662760:2"> and </span><span data-offset-key="7883604481bd45f8b53fad619c662760:3">*aware*</span><span data-offset-key="7883604481bd45f8b53fad619c662760:4"> objects to represent dates and times. The </span><span data-offset-key="7883604481bd45f8b53fad619c662760:5">*naive*</span><span data-offset-key="7883604481bd45f8b53fad619c662760:6"> ones are the source of confusion, because application developers increasingly find themselves working on projects in which timezones are critically important. The dramatic rise of cloud infrastructure and software-as-a-service applications have contributed to the reality that your application will frequently run in a different timezone (e.g., on a server) than where developers are located, and different again to where your users are located.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e534c990b9dd4a45beffc4ef953d7e9f"><span data-offset-key="e534c990b9dd4a45beffc4ef953d7e9f:0">The </span><span data-offset-key="e534c990b9dd4a45beffc4ef953d7e9f:1">*naive*</span><span data-offset-key="e534c990b9dd4a45beffc4ef953d7e9f:2"> </span><span data-offset-key="e534c990b9dd4a45beffc4ef953d7e9f:3">`datetime`</span><span data-offset-key="e534c990b9dd4a45beffc4ef953d7e9f:4"> objects are the ones you typically see in demos and tutorials:</span></span></span>

    import datetime​dt = datetime.datetime.now()dt_utc = datetime.datetime.utcnow()difference = (dt - dt_utc).total_seconds()​print('Total difference: %.2f seconds' % difference)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4b4cf94e89b84763a10bd4934b6b9e94"><span data-offset-key="4b4cf94e89b84763a10bd4934b6b9e94:0">This code could not be any simpler: we create two </span><span data-offset-key="4b4cf94e89b84763a10bd4934b6b9e94:1">`datetime`</span><span data-offset-key="4b4cf94e89b84763a10bd4934b6b9e94:2"> objects, and calculate the difference. The problem is that we probably intended both </span><span data-offset-key="4b4cf94e89b84763a10bd4934b6b9e94:3">`now()`</span><span data-offset-key="4b4cf94e89b84763a10bd4934b6b9e94:4"> and </span><span data-offset-key="4b4cf94e89b84763a10bd4934b6b9e94:5">`utcnow()`</span><span data-offset-key="4b4cf94e89b84763a10bd4934b6b9e94:6"> to mean </span><span data-offset-key="4b4cf94e89b84763a10bd4934b6b9e94:7">*now*</span><span data-offset-key="4b4cf94e89b84763a10bd4934b6b9e94:8"> as in “this moment in time,” but perhaps in different timezones. When the difference is calculated, we get what seems an absurdly large result:</span></span></span>

    Total difference: 36000.00 seconds

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="66f4d2da1e444e3db179df436b038bdd"><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:0">The difference is, in fact, the timezone difference between my current location and UTC: +10 hours. This result is the worst kind of “incorrect” because it is, in fact, </span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:1">*correct*</span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:2"> if timezones are not taken into account; and here lies the root of the problem: a misunderstanding of what the functions actually do. The </span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:3">`now()`</span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:4"> and </span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:5">`utcnow()`</span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:6"> functions </span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:7">*do*</span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:8"> return the current time in local and UTC timezones, but unfortunately both results are </span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:9">*naive*</span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:10"> </span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:11">`datetime`</span><span data-offset-key="66f4d2da1e444e3db179df436b038bdd:12"> objects and therefore lack timezone data.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="24143302f832415c967e04173259ff45"><span data-offset-key="24143302f832415c967e04173259ff45:0">Note that it </span><span data-offset-key="24143302f832415c967e04173259ff45:1">*is*</span><span data-offset-key="24143302f832415c967e04173259ff45:2"> possible to create </span><span data-offset-key="24143302f832415c967e04173259ff45:3">`datetime`</span><span data-offset-key="24143302f832415c967e04173259ff45:4"> objects with timezone data attached, albeit in a subjectively cumbersome manner: you create an </span><span data-offset-key="24143302f832415c967e04173259ff45:5">*aware*</span><span data-offset-key="24143302f832415c967e04173259ff45:6"> </span><span data-offset-key="24143302f832415c967e04173259ff45:7">`datetime`</span><span data-offset-key="24143302f832415c967e04173259ff45:8"> by setting the </span><span data-offset-key="24143302f832415c967e04173259ff45:9">`tzinfo`</span><span data-offset-key="24143302f832415c967e04173259ff45:10"> attribute to the correct timezone. In our example, we could (and should!) have created a current </span><span data-offset-key="24143302f832415c967e04173259ff45:11">`datetime`</span><span data-offset-key="24143302f832415c967e04173259ff45:12"> object in the following way, by passing the timezone into the </span><span data-offset-key="24143302f832415c967e04173259ff45:13">`now()`</span><span data-offset-key="24143302f832415c967e04173259ff45:14"> function:</span></span></span>

    dt = datetime.datetime.now(tz=datetime.timezone.utc)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="eabef52aabf14cbf965cd140a7d8c026"><span data-offset-key="eabef52aabf14cbf965cd140a7d8c026:0">Of course, if you make this change on line 3 and try to rerun the code, the following error appears:</span></span></span>

    TypeError: can't subtract offset-naive andoffset-aware datetimes

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="271c8d42321e43abb5490593c12483d1"><span data-offset-key="271c8d42321e43abb5490593c12483d1:0">This happens because even though the </span><span data-offset-key="271c8d42321e43abb5490593c12483d1:1">`utcnow()`</span><span data-offset-key="271c8d42321e43abb5490593c12483d1:2"> function produces a </span><span data-offset-key="271c8d42321e43abb5490593c12483d1:3">`datetime`</span><span data-offset-key="271c8d42321e43abb5490593c12483d1:4"> for the UTC timezone, the result is a </span><span data-offset-key="271c8d42321e43abb5490593c12483d1:5">*naive*</span><span data-offset-key="271c8d42321e43abb5490593c12483d1:6"> </span><span data-offset-key="271c8d42321e43abb5490593c12483d1:7">`datetime`</span><span data-offset-key="271c8d42321e43abb5490593c12483d1:8"> object, and Python prevents you from mixing naive and aware </span><span data-offset-key="271c8d42321e43abb5490593c12483d1:9">`datetime`</span><span data-offset-key="271c8d42321e43abb5490593c12483d1:10"> objects. If you are suddenly scared to work with dates and times, that’s an understandable response, but I’d rather encourage you to instead be afraid of </span><span data-offset-key="271c8d42321e43abb5490593c12483d1:11">`datetimes`</span><span data-offset-key="271c8d42321e43abb5490593c12483d1:12"> that lack timezone data. The </span><span data-offset-key="271c8d42321e43abb5490593c12483d1:13">`TypeError`</span><span data-offset-key="271c8d42321e43abb5490593c12483d1:14"> just shown is the kind of error we really do want: it forces us to ensure that all our </span><span data-offset-key="271c8d42321e43abb5490593c12483d1:15">`datetime`</span><span data-offset-key="271c8d42321e43abb5490593c12483d1:16"> instances are </span><span data-offset-key="271c8d42321e43abb5490593c12483d1:17">*aware*</span><span data-offset-key="271c8d42321e43abb5490593c12483d1:18">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="80c61bb5c3d342c3a4c33f0d5c78a9e7"><span data-offset-key="80c61bb5c3d342c3a4c33f0d5c78a9e7:0">Naturally, to handle this in the general case requires some kind of database of timezones. Unfortunately, except for UTC, the Python standard library does not include timezone data; instead, the recommendation is to use a separately maintained library called </span></span><a href="https://pythonhosted.org/pytz" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="a08b7c745b214e5d8ffe28f43a5ba6c9"><span data-offset-key="a08b7c745b214e5d8ffe28f43a5ba6c9:0">pytz</span></span></a><span data-key="80b47d04d4eb46e895bcf3ad4c6b4456"><span data-offset-key="80b47d04d4eb46e895bcf3ad4c6b4456:0">, and if you need to work with dates and times, I strongly encourage you to investigate that library in more detail.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d1ccc5c9019f4f2bba3e829a780e7d4b"><span data-offset-key="d1ccc5c9019f4f2bba3e829a780e7d4b:0">Now we can finally delve into the main topic of this section, which is </span><span data-offset-key="d1ccc5c9019f4f2bba3e829a780e7d4b:1">`arrow`</span><span data-offset-key="d1ccc5c9019f4f2bba3e829a780e7d4b:2">: a third-party library that offers a much simpler API for working with dates and times. With </span><span data-offset-key="d1ccc5c9019f4f2bba3e829a780e7d4b:3">`arrow`</span><span data-offset-key="d1ccc5c9019f4f2bba3e829a780e7d4b:4">, </span><span data-offset-key="d1ccc5c9019f4f2bba3e829a780e7d4b:5">*everything*</span><span data-offset-key="d1ccc5c9019f4f2bba3e829a780e7d4b:6"> has a timezone attached (and is thus “aware”):</span></span></span>

    import arrow​t0 = arrow.now()print(t0)​t1 = arrow.utcnow()print(t1)​difference = (t0 - t1).total_seconds()​print('Total difference: %.2f seconds' % difference)

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6043b8baebd74ba59dc687049386032f"><span data-offset-key="6043b8baebd74ba59dc687049386032f:0">Output:</span></span></span>

    2016-06-26T18:43:55.328561+10:002016-06-26T08:43:55.328630+00:00Total difference: -0.00 seconds

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a55a4a2a546a415b8651c6a16c8d6c2a"><span data-offset-key="a55a4a2a546a415b8651c6a16c8d6c2a:0">As you can see, the </span><span data-offset-key="a55a4a2a546a415b8651c6a16c8d6c2a:1">`now()`</span><span data-offset-key="a55a4a2a546a415b8651c6a16c8d6c2a:2"> function produces the current date and time </span><span data-offset-key="a55a4a2a546a415b8651c6a16c8d6c2a:3">*with*</span><span data-offset-key="a55a4a2a546a415b8651c6a16c8d6c2a:4"> my local timezone attached (UTC+10), while the </span><span data-offset-key="a55a4a2a546a415b8651c6a16c8d6c2a:5">`utcnow()`</span><span data-offset-key="a55a4a2a546a415b8651c6a16c8d6c2a:6"> function </span><span data-offset-key="a55a4a2a546a415b8651c6a16c8d6c2a:7">*also*</span><span data-offset-key="a55a4a2a546a415b8651c6a16c8d6c2a:8"> produces the current date and time, but with the UTC timezone attached. As a consequence, the actual difference between the two times is as it should be: zero.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2407f61c74c24ade98a812e4f6a3148e"><span data-offset-key="2407f61c74c24ade98a812e4f6a3148e:0">And the delightful </span><span data-offset-key="2407f61c74c24ade98a812e4f6a3148e:1">`arrow`</span><span data-offset-key="2407f61c74c24ade98a812e4f6a3148e:2"> library just gets better from there. The objects themselves have convenient attributes and methods you would expect:</span></span></span>

    >>> t0 = arrow.now()>>> t0<Arrow [2016-06-26T18:59:07.691803+10:00]>​>>> t0.date()datetime.date(2016, 6, 26)​>>> t0.time()datetime.time(18, 59, 7, 691803)​>>> t0.timestamp1466931547​>>> t0.year2016​>>> t0.month6​>>> t0.day26​>>> t0.datetimedatetime.datetime(2016, 6, 26, 18, 59, 7, 691803,    tzinfo=tzlocal())

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="235214ad4ce14849b4046cfd7d75135c"><span data-offset-key="235214ad4ce14849b4046cfd7d75135c:0">Note that the </span><span data-offset-key="235214ad4ce14849b4046cfd7d75135c:1">`datetime`</span><span data-offset-key="235214ad4ce14849b4046cfd7d75135c:2"> produced from the same attribute correctly carries the essential timezone information.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6962ba14c160433ba6321ac426fc8ea9"><span data-offset-key="6962ba14c160433ba6321ac426fc8ea9:0">There are several other features of the module that you can read more about in </span></span><a href="http://crsmithdev.com/arrow" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d3a7f4d378944c92a0b7deb2f7936841"><span data-offset-key="d3a7f4d378944c92a0b7deb2f7936841:0">the documentation</span></span></a><span data-key="5848c3037784457fad3ed87cfe78aaed"><span data-offset-key="5848c3037784457fad3ed87cfe78aaed:0">, but this last feature provides an appropriate segue to the next section:</span></span></span>

    >>> t0 = arrow.now()>>> t0.humanize()'just now'>>> t0.humanize()'seconds ago'​>>> t0 = t0.replace(hours=-3,minutes=10)>>> t0.humanize()'2 hours ago'

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0020abba75744b73b9be189f9f8f2747"><span data-offset-key="0020abba75744b73b9be189f9f8f2747:0">The humanization even has built-in support for several locales!</span></span></span>

    >>> t0.humanize(locale='ko')'2시간 전'>>> t0.humanize(locale='ja')'2時間前'>>> t0.humanize(locale='hu')'2 órával ezelőtt'>>> t0.humanize(locale='de')'vor 2 Stunden'>>> t0.humanize(locale='fr')'il y a 2 heures'>>> t0.humanize(locale='el')'2 ώρες πριν'>>> t0.humanize(locale='hi')'2 घंटे पहले'>>> t0.humanize(locale='zh')'2小时前'

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="09d7ccac757e45249e956ebdef25a173"><span data-offset-key="09d7ccac757e45249e956ebdef25a173:0">ALTERNATIVE LIBRARIES FOR DATES AND TIMES</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="886e830f301145f7bc1c6f7914c2c508"><span data-offset-key="886e830f301145f7bc1c6f7914c2c508:0">There are several other excellent libraries for dealing with dates and times in Python, and it would be worth checking out both </span></span><a href="http://bit.ly/delorean-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="7a54782afb384f5b9b8d88d2f7d06906"><span data-offset-key="7a54782afb384f5b9b8d88d2f7d06906:0">Delorean</span></span></a><span data-key="b9e3e14e917b44398b6eb18cc33509fc"><span data-offset-key="b9e3e14e917b44398b6eb18cc33509fc:0"> and the very new </span></span><a href="http://pendulum.eustace.io/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="7cdfd1a0f27546aba6f6de4e78c59e7b"><span data-offset-key="7cdfd1a0f27546aba6f6de4e78c59e7b:0">Pendulum</span></span></a><span data-key="36e045f78fa74005b66a2b6c31603a0b"><span data-offset-key="36e045f78fa74005b66a2b6c31603a0b:0"> library.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="8d59c3e551e94199b42c61f6e1848335"><span data-offset-key="8d59c3e551e94199b42c61f6e1848335:0">parsedatetime</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4be9327b6a444770a18afc6aa9f9abaf"><span data-offset-key="4be9327b6a444770a18afc6aa9f9abaf:0">`parsedatetime`</span><span data-offset-key="4be9327b6a444770a18afc6aa9f9abaf:1"> is a wonderful library with a dedicated focus: parsing text into dates and times. As you’d expect, it can be obtained with </span><span data-offset-key="4be9327b6a444770a18afc6aa9f9abaf:2">`pip install parsedatetime`</span><span data-offset-key="4be9327b6a444770a18afc6aa9f9abaf:3">. The </span></span><a href="http://bit.ly/parsedatetime" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="329d626164f14b418c6ce863f45a533e"><span data-offset-key="329d626164f14b418c6ce863f45a533e:0">official documentation</span></span></a><span data-key="3e7efc77c2de459ab36ad9c6293203b6"><span data-offset-key="3e7efc77c2de459ab36ad9c6293203b6:0"> is very API-like, which makes it harder than it should be to get a quick overview of what the library offers, but you can get a pretty good idea of what’s available by browsing the extensive </span></span><a href="http://bit.ly/pdt-test" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="39ae8dfcfcb14f82afe8205ff60c0e19"><span data-offset-key="39ae8dfcfcb14f82afe8205ff60c0e19:0">test suite</span></span></a><span data-key="87babf74c18b4e93b5f01589f4f0d7e4"><span data-offset-key="87babf74c18b4e93b5f01589f4f0d7e4:0">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6f6d831a20a742d381065677681b5fbe"><span data-offset-key="6f6d831a20a742d381065677681b5fbe:0">The minimum you should expect of a </span><span data-offset-key="6f6d831a20a742d381065677681b5fbe:1">`datetime`</span><span data-offset-key="6f6d831a20a742d381065677681b5fbe:2">-parsing library is to handle the more common formats, and the following code sample demonstrates this:</span></span></span>

    import parsedatetime as pdt​cal = pdt.Calendar()​examples = [    "2016-07-16",    "2016/07/16",    "2016-7-16",    "2016/7/16",    "07-16-2016",    "7-16-2016",    "7-16-16",    "7/16/16",]​print('{:30s}{:>30s}'.format('Input', 'Result'))print('=' * 60)for e in examples:    dt, result = cal.parseDT(e)    print('{:<30s}{:>30}'.format('"' + e + '"', dt.ctime()))

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4855487186af449f9c4e331b42e31c76"><span data-offset-key="4855487186af449f9c4e331b42e31c76:0">This produces the following, and unsurprising, output:</span></span></span>

    Input                                                 Result============================================================"2016-07-16"                        Sat Jul 16 16:25:20 2016"2016/07/16"                        Sat Jul 16 16:25:20 2016"2016-7-16"                         Sat Jul 16 16:25:20 2016"2016/7/16"                         Sat Jul 16 16:25:20 2016"07-16-2016"                        Sat Jul 16 16:25:20 2016"7-16-2016"                         Sat Jul 16 16:25:20 2016"7-16-16"                           Sat Jul 16 16:25:20 2016"7/16/16"                           Sat Jul 16 16:25:20 2016

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="78d99bd93079481988c79e483d7ee262"><span data-offset-key="78d99bd93079481988c79e483d7ee262:0">By default, if the year is given </span><span data-offset-key="78d99bd93079481988c79e483d7ee262:1">*last*</span><span data-offset-key="78d99bd93079481988c79e483d7ee262:2">, then </span><span data-offset-key="78d99bd93079481988c79e483d7ee262:3">*month-day-year*</span><span data-offset-key="78d99bd93079481988c79e483d7ee262:4"> is assumed, and the library also conveniently handles the presence or absence of leading zeros, as well as whether hyphens (</span><span data-offset-key="78d99bd93079481988c79e483d7ee262:5">`-`</span><span data-offset-key="78d99bd93079481988c79e483d7ee262:6">) or slashes (</span><span data-offset-key="78d99bd93079481988c79e483d7ee262:7">`/`</span><span data-offset-key="78d99bd93079481988c79e483d7ee262:8">) are used as delimiters.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7b9be3ed8a924e47bbf6b25806f4f049"><span data-offset-key="7b9be3ed8a924e47bbf6b25806f4f049:0">Significantly more impressive, however, is how </span><span data-offset-key="7b9be3ed8a924e47bbf6b25806f4f049:1">`parsedatetime`</span><span data-offset-key="7b9be3ed8a924e47bbf6b25806f4f049:2"> handles more complicated, “natural language” inputs:</span></span></span>

    import parsedatetime as pdtfrom datetime import datetime​cal = pdt.Calendar()​examples = [    "19 November 1975",    "19 November 75",    "19 Nov 75",    "tomorrow",    "yesterday",    "10 minutes from now",    "the first of January, 2001",    "3 days ago",    "in four days' time",    "two weeks from now",    "three months ago",    "2 weeks and 3 days in the future",]​print('Now: {}'.format(datetime.now().ctime()), end='\n\n')print('{:40s}{:>30s}'.format('Input', 'Result'))print('=' * 70)for e in examples:    dt, result = cal.parseDT(e)    print('{:<40s}{:>30}'.format('"' + e + '"', dt.ctime()))

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="73efa5b26a404f178fdc641f0d0faa07"><span data-offset-key="73efa5b26a404f178fdc641f0d0faa07:0">Incredibly, this all works just as you’d hope:</span></span></span>

    Now: Mon Jun 20 08:41:38 2016​Input                                                     Result================================================================"19 November 1975"                      Wed Nov 19 08:41:38 1975"19 November 75"                        Wed Nov 19 08:41:38 1975"19 Nov 75"                             Wed Nov 19 08:41:38 1975"tomorrow"                              Tue Jun 21 09:00:00 2016"yesterday"                             Sun Jun 19 09:00:00 2016"10 minutes from now"                   Mon Jun 20 08:51:38 2016"the first of January, 2001"            Mon Jan  1 08:41:38 2001"3 days ago"                            Fri Jun 17 08:41:38 2016"in four days' time"                    Fri Jun 24 08:41:38 2016"two weeks from now"                    Mon Jul  4 08:41:38 2016"three months ago"                      Sun Mar 20 08:41:38 2016"2 weeks and 3 days in the future"      Thu Jul  7 08:41:38 2016

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a0a2db8e76d24ebca6cb62f59c05de6d"><span data-offset-key="a0a2db8e76d24ebca6cb62f59c05de6d:0">The urge to combine this with a speech-to-text package like </span></span><a href="http://bit.ly/speechrec" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="f2572d30912e47289b2b4b8805eb23de"><span data-offset-key="f2572d30912e47289b2b4b8805eb23de:0">SpeechRecognition</span></span></a><span data-key="774708cbbcaf480299da36df90c9530f"><span data-offset-key="774708cbbcaf480299da36df90c9530f:0"> or </span></span><a href="http://bit.ly/wordwatcher" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="534c93f965de4d16af4f2d58284f4549"><span data-offset-key="534c93f965de4d16af4f2d58284f4549:0">watson-word-watcher</span></span></a><span data-key="85ea066ec29b49ec98d9e59c9449d964"><span data-offset-key="85ea066ec29b49ec98d9e59c9449d964:0"> (which provides confidence values per word) is almost irresistible, but of course you don’t need complex projects to make use of </span><span data-offset-key="85ea066ec29b49ec98d9e59c9449d964:1">`parsedatetime`</span><span data-offset-key="85ea066ec29b49ec98d9e59c9449d964:2">: even allowing a user to type in a friendly and natural description of a date or time interval might be much more convenient than the usual but frequently clumsy </span><span data-offset-key="85ea066ec29b49ec98d9e59c9449d964:3">*DateTimePicker*</span><span data-offset-key="85ea066ec29b49ec98d9e59c9449d964:4"> widgets we’ve become accustomed to.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f25a804c857b4d4bba4a482aa484f106"><span data-offset-key="f25a804c857b4d4bba4a482aa484f106:0">**NOTE**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="457d902bf4214e329a9c8562588914e8"><span data-offset-key="457d902bf4214e329a9c8562588914e8:0">Another library featuring excellent datetime parsing abilities is </span></span><a href="http://bit.ly/chronyk" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="60f10621ff4f4e41ac8db4fb33cd40e1"><span data-offset-key="60f10621ff4f4e41ac8db4fb33cd40e1:0">Chronyk</span></span></a><span data-key="ac1d4f2f403e4ba5b95cd424cd55bdec"><span data-offset-key="ac1d4f2f403e4ba5b95cd424cd55bdec:0">.</span></span></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="794a05586ab8450abfa0683012c6c958"><span data-offset-key="794a05586ab8450abfa0683012c6c958:0">General-Purpose Libraries</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="952cd55e00ad4afd94d388f3ff1277f8"><span data-offset-key="952cd55e00ad4afd94d388f3ff1277f8:0">In this chapter we take a look at a few batteries that have not yet been included in the Python standard library, but which would make excellent additions.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1a815a3f93d9434a8d05e1493a9c78b9"><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:0">General-purpose libraries are quite rare in the Python world because the standard library covers most areas sufficiently well that library authors usually focus on very specific areas. Here we discuss </span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:1">`boltons`</span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:2"> (a play on the word </span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:3">*builtins*</span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:4">), which provides a large number of useful additions to the standard library. We also cover the </span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:5">`Cython`</span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:6"> library, which provides facilities for </span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:7">*both*</span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:8"> massively speeding up Python code, as well as bypassing Python’s famous </span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:9">*global interpreter lock*</span><span data-offset-key="1a815a3f93d9434a8d05e1493a9c78b9:10"> (GIL) to enable true multi-CPU multi-threading.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="f99337c052e2418eaf95508371ccb0b2"><span data-offset-key="f99337c052e2418eaf95508371ccb0b2:0">boltons</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7ad37f0ed3274bb99367746a219799e4"><span data-offset-key="7ad37f0ed3274bb99367746a219799e4:0">The </span><span data-offset-key="7ad37f0ed3274bb99367746a219799e4:1">`boltons`</span><span data-offset-key="7ad37f0ed3274bb99367746a219799e4:2"> library is a general-purpose collection of Python modules that covers a wide range of situations you may encounter. The library is well-maintained and high-quality; it’s well worth adding to your toolset.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c9fb55b093de408ea17514dadd818ee2"><span data-offset-key="c9fb55b093de408ea17514dadd818ee2:0">As a general-purpose library, </span><span data-offset-key="c9fb55b093de408ea17514dadd818ee2:1">`boltons`</span><span data-offset-key="c9fb55b093de408ea17514dadd818ee2:2"> does not have a specific focus. Instead, it contains several smaller libraries that focus on specific areas. In this section I will describe a few of these libraries that </span><span data-offset-key="c9fb55b093de408ea17514dadd818ee2:3">`boltons`</span><span data-offset-key="c9fb55b093de408ea17514dadd818ee2:4"> offers.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="d7319937fcf34bd9b724e8630536ca4d"><span data-offset-key="d7319937fcf34bd9b724e8630536ca4d:0">boltons.cacheutils</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="049b986767a14e2dae00e76b9eed9c45"><span data-offset-key="049b986767a14e2dae00e76b9eed9c45:0">`boltons.cacheutils`</span><span data-offset-key="049b986767a14e2dae00e76b9eed9c45:1"> provides tools for using a </span><span data-offset-key="049b986767a14e2dae00e76b9eed9c45:2">*cache*</span><span data-offset-key="049b986767a14e2dae00e76b9eed9c45:3"> inside your code. Caches are very useful for saving the results of expensive operations and reusing those previously calculated results.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="cc1d71cffada41d98cba226d29f430e3"><span data-offset-key="cc1d71cffada41d98cba226d29f430e3:0">The </span><span data-offset-key="cc1d71cffada41d98cba226d29f430e3:1">`functools`</span><span data-offset-key="cc1d71cffada41d98cba226d29f430e3:2"> module in the </span></span><a href="http://bit.ly/functools-docs" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="e3b8c354b5ff4a01ab46ff56d8f10828"><span data-offset-key="e3b8c354b5ff4a01ab46ff56d8f10828:0">standard library</span></span></a><span data-key="eee026ba44d9499bbaec57780da8bb3e"><span data-offset-key="eee026ba44d9499bbaec57780da8bb3e:0"> already provides a decorator called </span><span data-offset-key="eee026ba44d9499bbaec57780da8bb3e:1">`lru_cache`</span><span data-offset-key="eee026ba44d9499bbaec57780da8bb3e:2">, which can be used to </span><span data-offset-key="eee026ba44d9499bbaec57780da8bb3e:3">*memoize*</span><span data-offset-key="eee026ba44d9499bbaec57780da8bb3e:4"> calls: this means that the function remembers the parameters from previous calls, and when the same parameter values appear in a new call, the previous answer is returned directly, bypassing any calculation.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ce9d7e7a3bf1401d908d8063e7893fd7"><span data-offset-key="ce9d7e7a3bf1401d908d8063e7893fd7:0">`boltons`</span><span data-offset-key="ce9d7e7a3bf1401d908d8063e7893fd7:1"> provides similar caching functionality, but with a few convenient tweaks. Consider the following sample, in which we attempt to rewrite some lyrics from Taylor Swift’s </span><span data-offset-key="ce9d7e7a3bf1401d908d8063e7893fd7:2">*1989*</span><span data-offset-key="ce9d7e7a3bf1401d908d8063e7893fd7:3"> juggernaut record. We will use tools from </span><span data-offset-key="ce9d7e7a3bf1401d908d8063e7893fd7:4">`boltons.cacheutils`</span><span data-offset-key="ce9d7e7a3bf1401d908d8063e7893fd7:5"> to speed up processing time:</span></span></span>

    import jsonimport shelveimport atexitfrom random import choicefrom string import punctuationfrom vocabulary import Vocabulary as vb​​blank_space = """Nice to meet you, where you been?I could show you incredible thingsMagic, madness, heaven, sinSaw you there and I thoughtOh my God, look at that faceYou look like my next mistakeLove's a game, wanna play?​New money, suit and tieI can read you like a magazineAin't it funny, rumors flyAnd I know you heard about meSo hey, let's be friendsI'm dying to see how this one endsGrab your passport and my handI can make the bad guys good for a weekend"""​from boltons.cacheutils import LRI, LRU, cached​# Persistent LRU cache for the parts of speechcached_data = shelve.open('cached_data', writeback=True)  atexit.register(cached_data.close)  ​# Retrieve or create the "parts of speech" cachecache_POS = cached_data.setdefault(    'parts_of_speech', LRU(max_size=5000))  ​@cached(cache_POS)  def part_of_speech(word):    items = vb.part_of_speech(word.lower())    if items:        return json.loads(items)[0]['text']​# Temporary LRI cache for word substitutionscache = LRI(max_size=30)​@cached(cache)  def synonym(word):    items = vb.synonym(word)    if items:        return choice(json.loads(items))['text']​@cached(cache)  def antonym(word):    items = vb.antonym(word)    if items:        return choice(items['text'])​for raw_word in blank_space.strip().split(' '):    if raw_word == '\n':        print(raw_word)        continue    alternate = raw_word  # default is the original word.    # Remove punctuation    word = raw_word.translate(        {ord(x): None for x in punctuation})    if part_of_speech(word) in ['noun', 'verb',                                'adjective', 'adverb']:          alternate = choice((synonym, antonym))(word) or raw_word    print(alternate, end=' ')

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8a79dc4087574d6ba0aa0a2c1c425846"><span data-offset-key="8a79dc4087574d6ba0aa0a2c1c425846:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO25-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="047272c3b59a45d0838ce7002fe8419a"><span data-offset-key="047272c3b59a45d0838ce7002fe8419a:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="ca66c83770634b6bb02c65595e3e4952"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="ca66c83770634b6bb02c65595e3e4952"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="f894c9bcc88c4482b8c75d29656931d2"><span data-offset-key="f894c9bcc88c4482b8c75d29656931d2:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="2fa44efd7e634105a995fc6a2f0dc90e"><span data-offset-key="2fa44efd7e634105a995fc6a2f0dc90e:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e0a8768d31f74030a51cda270323e709"><span data-offset-key="e0a8768d31f74030a51cda270323e709:0">Our code detects “parts of speech” in order to know which lyrics to change. Looking up words online is slow, so we create a small database using the </span><span data-offset-key="e0a8768d31f74030a51cda270323e709:1">`shelve`</span><span data-offset-key="e0a8768d31f74030a51cda270323e709:2"> module in the standard library to save the cache data between runs.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO25-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="058e7cd3d71a47a29deb46cc3c17a020"><span data-offset-key="058e7cd3d71a47a29deb46cc3c17a020:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="b7f3c210a37a41239f93eeff5805b68c"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="b7f3c210a37a41239f93eeff5805b68c"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="8b58d0e76f0d4920afa22bb5a83529df"><span data-offset-key="8b58d0e76f0d4920afa22bb5a83529df:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="face929a6e1740718bdd14bea5a4d1cc"><span data-offset-key="face929a6e1740718bdd14bea5a4d1cc:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5e2a5eb3dc2644458d71620bb158e3ae"><span data-offset-key="5e2a5eb3dc2644458d71620bb158e3ae:0">We use the </span><span data-offset-key="5e2a5eb3dc2644458d71620bb158e3ae:1">`atexit`</span><span data-offset-key="5e2a5eb3dc2644458d71620bb158e3ae:2"> module, also in the standard library, to make sure that our “parts of speech” cache data will get saved when the program exits.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO25-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="2f1e2fe4bb5f450284f87d469bf9a850"><span data-offset-key="2f1e2fe4bb5f450284f87d469bf9a850:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="146458df53054959be065e1497527f5a"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="146458df53054959be065e1497527f5a"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="34fc9a9bcca74bcf9d93c3b27a2a4286"><span data-offset-key="34fc9a9bcca74bcf9d93c3b27a2a4286:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="c660ae3965a74e11a71ba420abb7105c"><span data-offset-key="c660ae3965a74e11a71ba420abb7105c:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="bfa3ad34e9c94c299062647eb4b1001e"><span data-offset-key="bfa3ad34e9c94c299062647eb4b1001e:0">Here we obtain the </span><span data-offset-key="bfa3ad34e9c94c299062647eb4b1001e:1">`LRU`</span><span data-offset-key="bfa3ad34e9c94c299062647eb4b1001e:2"> cache provided by </span><span data-offset-key="bfa3ad34e9c94c299062647eb4b1001e:3">`boltons.cacheutils`</span><span data-offset-key="bfa3ad34e9c94c299062647eb4b1001e:4"> that we saved from a previous run.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO25-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="a51f4c8625734771a2ace1debe2a109f"><span data-offset-key="a51f4c8625734771a2ace1debe2a109f:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="6d6c15fa428440c59c213cd63c5b3668"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="6d6c15fa428440c59c213cd63c5b3668"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="d247fe1d104d493fb3bcdd5ed43fc5da"><span data-offset-key="d247fe1d104d493fb3bcdd5ed43fc5da:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="7ede06779adb42ada0a0f4908e20d43f"><span data-offset-key="7ede06779adb42ada0a0f4908e20d43f:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6536a5477b0d46929c3e94d7a272846d"><span data-offset-key="6536a5477b0d46929c3e94d7a272846d:0">Here we use the </span><span data-offset-key="6536a5477b0d46929c3e94d7a272846d:1">`@cache`</span><span data-offset-key="6536a5477b0d46929c3e94d7a272846d:2"> decorator provided by </span><span data-offset-key="6536a5477b0d46929c3e94d7a272846d:3">`boltons.cacheutils`</span><span data-offset-key="6536a5477b0d46929c3e94d7a272846d:4"> to enable caching of the </span><span data-offset-key="6536a5477b0d46929c3e94d7a272846d:5">`part_of_speech()`</span><span data-offset-key="6536a5477b0d46929c3e94d7a272846d:6"> function call. If the </span><span data-offset-key="6536a5477b0d46929c3e94d7a272846d:7">`word`</span><span data-offset-key="6536a5477b0d46929c3e94d7a272846d:8"> argument has been used in a previous call to this function, the answer will be obtained from the cache rather than a slow call to the Internet.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO25-5" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="641082267a41470d8a8690a6c92de77b"><span data-offset-key="641082267a41470d8a8690a6c92de77b:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="aec714dd45474b0c8e73427a595f53ab"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="aec714dd45474b0c8e73427a595f53ab"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/5.png" alt="5" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="314abba1ab3b47ebb75d587cf2a2d988"><span data-offset-key="314abba1ab3b47ebb75d587cf2a2d988:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="d75a47072b874ad78f386878ca3a8492"><span data-offset-key="d75a47072b874ad78f386878ca3a8492:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3b640fa8431245ee93842c4d1363a545"><span data-offset-key="3b640fa8431245ee93842c4d1363a545:0">For synonyms and antonyms, we used a different kind of cache, called a </span><span data-offset-key="3b640fa8431245ee93842c4d1363a545:1">*least recently inserted*</span><span data-offset-key="3b640fa8431245ee93842c4d1363a545:2"> cache (this choice is explained later in this section). An LRI cache is not provided in the Python Standard Library.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO25-7" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="edf11becaaba46d6b6cc42b19594813c"><span data-offset-key="edf11becaaba46d6b6cc42b19594813c:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="3896590e1b3d49129f8396412c80b9d8"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="3896590e1b3d49129f8396412c80b9d8"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/6.png" alt="6" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="0246993f1c144e9699c0cfe1fa85288b"><span data-offset-key="0246993f1c144e9699c0cfe1fa85288b:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="4c283c1b895f4cad97e706f698d47abb"><span data-offset-key="4c283c1b895f4cad97e706f698d47abb:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7ee092f73d404b9e9a504807bb7a1c01"><span data-offset-key="7ee092f73d404b9e9a504807bb7a1c01:0">Here we restrict which kinds of words will be substituted.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8ff08a683cb84933ad5af257c200466c"><span data-offset-key="8ff08a683cb84933ad5af257c200466c:0">**NOTE**</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b270ffa131dd42bcb8161739131dad3e"><span data-offset-key="b270ffa131dd42bcb8161739131dad3e:0">The excellent </span><span data-offset-key="b270ffa131dd42bcb8161739131dad3e:1">`vocabulary`</span><span data-offset-key="b270ffa131dd42bcb8161739131dad3e:2"> package is used here to provide access to synonyms and antonyms. Install it with </span><span data-offset-key="b270ffa131dd42bcb8161739131dad3e:3">`pip install vocabulary`</span><span data-offset-key="b270ffa131dd42bcb8161739131dad3e:4">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1bac768bbb6d4b87b28a8a9959551977"><span data-offset-key="1bac768bbb6d4b87b28a8a9959551977:0">For brevity, I’ve included only the first verse and chorus. The plan is staggeringly unsophisticated: we’re going to simply swap words with either a synonym or antonym, and which is decided randomly! Iteration over the words is straightforward, but we obtain synonyms and antonyms using the </span><span data-offset-key="1bac768bbb6d4b87b28a8a9959551977:1">`vocabulary`</span><span data-offset-key="1bac768bbb6d4b87b28a8a9959551977:2"> package, which internally calls APIs on the Internet to fetch the data. Naturally, this can be slow since the lookup is going to be performed for every word, and this is why a cache will be used. In fact, in this code sample we use two different kinds of caching strategies.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="531391125e2f4e929cda84fec9616081"><span data-offset-key="531391125e2f4e929cda84fec9616081:0">`boltons.cacheutils`</span><span data-offset-key="531391125e2f4e929cda84fec9616081:1"> offers two kinds of caches: the </span><span data-offset-key="531391125e2f4e929cda84fec9616081:2">*least recently used*</span><span data-offset-key="531391125e2f4e929cda84fec9616081:3"> (LRU) version, which is the same as </span><span data-offset-key="531391125e2f4e929cda84fec9616081:4">`functools.lru_cache`</span><span data-offset-key="531391125e2f4e929cda84fec9616081:5">, and a simpler </span><span data-offset-key="531391125e2f4e929cda84fec9616081:6">*least recently inserted*</span><span data-offset-key="531391125e2f4e929cda84fec9616081:7"> (LRI) version, which expires entries based on their insertion order.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a88269077d59494d866966b0e3826191"><span data-offset-key="a88269077d59494d866966b0e3826191:0">In our code, we use an </span><span data-offset-key="a88269077d59494d866966b0e3826191:1">*LRU*</span><span data-offset-key="a88269077d59494d866966b0e3826191:2"> cache to keep a record of the </span><span data-offset-key="a88269077d59494d866966b0e3826191:3">*parts of speech*</span><span data-offset-key="a88269077d59494d866966b0e3826191:4"> lookups, and we even save this cache to disk so that it can be reused in successive runs.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6ae5a2fffb26436c95396388aee6039f"><span data-offset-key="6ae5a2fffb26436c95396388aee6039f:0">We also use an </span><span data-offset-key="6ae5a2fffb26436c95396388aee6039f:1">*LRI*</span><span data-offset-key="6ae5a2fffb26436c95396388aee6039f:2"> cache to keep a record of word substitutions. For example, if a word is to be swapped with its antonym, the replacement will be stored in the LRI cache so that it can be reused. However, we apply a very small limit to the setting for maximum size on the LRI cache, so that words will fall out of the cache quite regularly. Using an LRI cache with a small maximum size means that the same word will be replaced with the same substitution only locally, say within the same verse; but if that same word appears later in the song (and that word has been dropped from the LRI cache), it might get a different substitution entirely.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e568845f7dc64f7b8332a225c0df36cd"><span data-offset-key="e568845f7dc64f7b8332a225c0df36cd:0">The design of the caches in </span><span data-offset-key="e568845f7dc64f7b8332a225c0df36cd:1">`boltons.cacheutils`</span><span data-offset-key="e568845f7dc64f7b8332a225c0df36cd:2"> is great in that it is easy to use the same cache for multiple functions, as we do here for the </span><span data-offset-key="e568845f7dc64f7b8332a225c0df36cd:3">`synonym()`</span><span data-offset-key="e568845f7dc64f7b8332a225c0df36cd:4"> and </span><span data-offset-key="e568845f7dc64f7b8332a225c0df36cd:5">`antonym()`</span><span data-offset-key="e568845f7dc64f7b8332a225c0df36cd:6"> functions. This means that once a word substitution appears in the cache, a call to </span><span data-offset-key="e568845f7dc64f7b8332a225c0df36cd:7">*either*</span><span data-offset-key="e568845f7dc64f7b8332a225c0df36cd:8"> function returns the predetermined result from the same cache.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="90efb750ea374b95b6f30d8c2a6933b8"><span data-offset-key="90efb750ea374b95b6f30d8c2a6933b8:0">Here is an example of the output:</span></span></span>

    Nice to meet you, wherever you been?I indeed conduct you astonishing thingsMagic, madness, Hell sinSaw you be and I thoughtOh my God, seek at who faceYou seek same my following mistakeLove's a game, wanna play?​New financial satisfy both tieI be able read you like a magazineAin't it funny, rumors flyAnd gladly can you heard substantially meSo hey, let's inclination friendsI'm nascent to visit whatever that one endsGrab your passport in addition my handI can take the bad guys ill in exchange for member weekend

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d872891182864533b774125033d6aa8c"><span data-offset-key="d872891182864533b774125033d6aa8c:0">On second thought, perhaps the original was best after all! It is worth noting just how much functionality is possible with a tiny amount of code, as long as the abstractions available to you are powerful enough.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e15a7bdd0d3f4a63ad9ffe75a10c794d"><span data-offset-key="e15a7bdd0d3f4a63ad9ffe75a10c794d:0">`boltons`</span><span data-offset-key="e15a7bdd0d3f4a63ad9ffe75a10c794d:1"> has many features and we cannot cover everything here; however, we can do a whirlwind tour and pick out a few notable APIs that solve problems frequently encountered, e.g., in StackOverflow questions.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="6b40a647bec74f658d40674226560f93"><span data-offset-key="6b40a647bec74f658d40674226560f93:0">boltons.iterutils</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ab1e9167cbab4ef5b956cb97cb3c881e"><span data-offset-key="ab1e9167cbab4ef5b956cb97cb3c881e:0">`boltons.iterutils.chunked_iter(src, size)`</span><span data-offset-key="ab1e9167cbab4ef5b956cb97cb3c881e:1"> returns pieces of the source iterable in </span><span data-offset-key="ab1e9167cbab4ef5b956cb97cb3c881e:2">`size`</span><span data-offset-key="ab1e9167cbab4ef5b956cb97cb3c881e:3">-sized chunks (this example was copied </span></span><a href="http://bit.ly/boltons-chunk" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="6a08c28d667749d994bbd73fe0cfa34f"><span data-offset-key="6a08c28d667749d994bbd73fe0cfa34f:0">from the docs</span></span></a><span data-key="2fad10ae847c4ce4a9058765f093ec10"><span data-offset-key="2fad10ae847c4ce4a9058765f093ec10:0">):</span></span></span>

    >>> list(chunked_iter(range(10), 3))[[0, 1, 2], [3, 4, 5], [6, 7, 8], [9]]

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ce081eec28c24422a5589d570a7781b4"><span data-offset-key="ce081eec28c24422a5589d570a7781b4:0">A similar requirement that often comes up is to have a moving window (of a particular size) slide over a sequence of data, and you can use </span></span><a href="http://bit.ly/boltons-window" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="4211eab081374b67b7498d63c47acf69"><span data-offset-key="4211eab081374b67b7498d63c47acf69:0"><code class="code-0458e21e" spellcheck="false" data-slate-leaf="true">boltons.iterutils.windowed_iter</code></span></span></a><span data-key="9e8837f661624e78ba27f9c865cda2db"><span data-offset-key="9e8837f661624e78ba27f9c865cda2db:0"> for that:</span></span></span>

    >>> list(windowed_iter(range(7), 3))[(0, 1, 2), (1, 2, 3), (2, 3, 4), (3, 4, 5), (4, 5, 6)]

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2b21c942c19e4c649839f078c82e51c2"><span data-offset-key="2b21c942c19e4c649839f078c82e51c2:0">Note that both </span><span data-offset-key="2b21c942c19e4c649839f078c82e51c2:1">`chunked_iter()`</span><span data-offset-key="2b21c942c19e4c649839f078c82e51c2:2"> and </span><span data-offset-key="2b21c942c19e4c649839f078c82e51c2:3">`windowed_iter()`</span><span data-offset-key="2b21c942c19e4c649839f078c82e51c2:4"> can operate on </span><span data-offset-key="2b21c942c19e4c649839f078c82e51c2:5">*iterables*</span><span data-offset-key="2b21c942c19e4c649839f078c82e51c2:6">, which means that very large sequences of data can be processed while keeping memory requirements tolerable for your usage scenario.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="b0086f0c1f414660b0d1185ae7353453"><span data-offset-key="b0086f0c1f414660b0d1185ae7353453:0">boltons.fileutils</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4bb74af5054f4acc8e96cd7342a1d88b"><span data-offset-key="4bb74af5054f4acc8e96cd7342a1d88b:0">The </span></span><a href="http://bit.ly/boltons-copytree" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="5bd44b0512014930927f0d4decd50b4b"><span data-offset-key="5bd44b0512014930927f0d4decd50b4b:0">copytree()</span></span></a><span data-key="4d39a2a61f914d9dacb778af5473f8e3"><span data-offset-key="4d39a2a61f914d9dacb778af5473f8e3:0"> function alleviates a particularly irritating behavior of the standard library’s </span><span data-offset-key="4d39a2a61f914d9dacb778af5473f8e3:1">`shutil.copytree()`</span><span data-offset-key="4d39a2a61f914d9dacb778af5473f8e3:2"> function: Boltons’ </span><span data-offset-key="4d39a2a61f914d9dacb778af5473f8e3:3">`copytree()`</span><span data-offset-key="4d39a2a61f914d9dacb778af5473f8e3:4"> will not complain if some or all of the destination file-system tree already exists.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9aba1bc6c9674a799b2342aace9cbba7"><span data-offset-key="9aba1bc6c9674a799b2342aace9cbba7:0">The </span><span data-offset-key="9aba1bc6c9674a799b2342aace9cbba7:1">`boltons.fileutils.AtomicSaver`</span><span data-offset-key="9aba1bc6c9674a799b2342aace9cbba7:2"> context manager helps to make sure that file-writes are </span></span><a href="http://bit.ly/boltons-atom" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d468103c141f46a88ab56242c7e10b9b"><span data-offset-key="d468103c141f46a88ab56242c7e10b9b:0">protected against corruption</span></span></a><span data-key="cb645a9843e944e7807b730b9cb15d3f"><span data-offset-key="cb645a9843e944e7807b730b9cb15d3f:0">. It achieves this by writing file data to temporary, or intermediate files, and then using an atomic renaming function to guarantee that the data is consistent. This is particularly valuable if there are multiple readers of a large file, and you want to ensure that the readers only ever see a consistent state, even though you have a (single!) writer changing the file data.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="65a7ab57b5594a3b929eb6e6a7be7352"><span data-offset-key="65a7ab57b5594a3b929eb6e6a7be7352:0">boltons.debugutils</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="c139b26f5c084784bd08b0c016f642b1"><span data-offset-key="c139b26f5c084784bd08b0c016f642b1:0">If you’ve ever had a long-running python application, and wished that you could drop into an interactive debugger session to see what was happening, </span><span data-offset-key="c139b26f5c084784bd08b0c016f642b1:1">`boltons.debugutils.pdb_on_signal()`</span><span data-offset-key="c139b26f5c084784bd08b0c016f642b1:2"> can make that happen. By default, a </span><span data-offset-key="c139b26f5c084784bd08b0c016f642b1:3">`KeyboardInterrupt`</span><span data-offset-key="c139b26f5c084784bd08b0c016f642b1:4"> handler is automatically set up, which means that by pressing Ctrl-C you can drop immediately into the debugger prompt. This is a really great way to deal with infinite loops if your application is difficult to debug from a fresh start otherwise.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="967876bd6c434483a71105c2941e548d"><span data-offset-key="967876bd6c434483a71105c2941e548d:0">boltons.strutils</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9290a041eecb404da77255dd09be14c7"><span data-offset-key="9290a041eecb404da77255dd09be14c7:0">There are several functions in </span><span data-offset-key="9290a041eecb404da77255dd09be14c7:1">`boltons.strutils`</span><span data-offset-key="9290a041eecb404da77255dd09be14c7:2"> that are enormously useful:</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="bd2ffab40dc4459b887f045f2425a551"><span data-offset-key="bd2ffab40dc4459b887f045f2425a551:0">`slugify()`</span><span data-offset-key="bd2ffab40dc4459b887f045f2425a551:1">: modify a string to be suitable, e.g., for use as a filename, by removing characters and symbols that would be invalid in a filename.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="026ebfec129b4f2e955cd4766c44fa5b"><span data-offset-key="026ebfec129b4f2e955cd4766c44fa5b:0">`ordinalize()`</span><span data-offset-key="026ebfec129b4f2e955cd4766c44fa5b:1">: given a numerical value, create a string referring to its position:</span></span></span>

    >>> print(ordinalize(1))1st>>> print(ordinalize(2))2nd

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="33b701ff097d4307979d698b62329a7c"><span data-offset-key="33b701ff097d4307979d698b62329a7c:0">`cardinalize`</span><span data-offset-key="33b701ff097d4307979d698b62329a7c:1">: given a word and a count, change the word for plurality and </span><span data-offset-key="33b701ff097d4307979d698b62329a7c:2">*preserve case*</span><span data-offset-key="33b701ff097d4307979d698b62329a7c:3">:</span></span></span>

    >>> cardinalize('python', 99)'pythons'>>> cardinalize('foot', 6)'feet'>>> cardinalize('Foot', 6)'Feet'>>> cardinalize('FOOT', 6)'FEET'>>> 'blind ' + cardinalize('mouse', 3)'blind mice'

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="07fdcac55a564003b4b1e0d9e4961913"><span data-offset-key="07fdcac55a564003b4b1e0d9e4961913:0">`singularize`</span><span data-offset-key="07fdcac55a564003b4b1e0d9e4961913:1"> and </span><span data-offset-key="07fdcac55a564003b4b1e0d9e4961913:2">`pluralize`</span><span data-offset-key="07fdcac55a564003b4b1e0d9e4961913:3">:</span></span></span>

    >>> pluralize('theory')'theories'>>> singularize('mice')'mouse'

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0b4f725d4dc74d90b31e196bf2c7db58"><span data-offset-key="0b4f725d4dc74d90b31e196bf2c7db58:0">`bytes2human`</span><span data-offset-key="0b4f725d4dc74d90b31e196bf2c7db58:1">: convert data sizes into friendler forms:</span></span></span>

    >>> bytes2human(1e6)'977K'>>> bytes2human(20)'20B'>>> bytes2human(1024 * 1024)'1024K'>>> bytes2human(2e4, ndigits=2)'19.53K'

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="eccbd3c22cf04199bc6957a0be472007"><span data-offset-key="eccbd3c22cf04199bc6957a0be472007:0">There are several other useful </span><span data-offset-key="eccbd3c22cf04199bc6957a0be472007:1">`boltons`</span><span data-offset-key="eccbd3c22cf04199bc6957a0be472007:2"> libraries not mentioned here, and I encourage you to at least skim </span></span><a href="http://bit.ly/boltons-docs" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d72cf38ba0b448e4aa179784dd6ae3a6"><span data-offset-key="d72cf38ba0b448e4aa179784dd6ae3a6:0">the documentation</span></span></a><span data-key="b406ae9dc0dd428783b04c2c4be0055f"><span data-offset-key="b406ae9dc0dd428783b04c2c4be0055f:0"> to learn about features you can use in your next project.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="544fc90f35564279a71904974c1523c9"><span data-offset-key="544fc90f35564279a71904974c1523c9:0">Cython</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3b6a8cf991324516900cf7c2a7f5050a"><span data-offset-key="3b6a8cf991324516900cf7c2a7f5050a:0"><span data-slate-zero-width="z">​</span></span></span><a href="http://cython.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="27745ee095f1403d96267e4b1a4c8114"><span data-offset-key="27745ee095f1403d96267e4b1a4c8114:0">Cython</span></span></a><span data-key="489d4085f56047938237ebb08b224d07"><span data-offset-key="489d4085f56047938237ebb08b224d07:0"> is a magical tool! As with most magical devices, it is difficult to describe exactly what it is. Cython is a tool that converts Python source code into C source code; this new code is then compiled into a native binary that is linked to the CPython runtime.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="00e27f340425450da1fbb9be8d30dd7f"><span data-offset-key="00e27f340425450da1fbb9be8d30dd7f:0">That sounds complicated, but basically Cython lets you convert your Python modules into compiled extension modules. There are two main reasons you might need to do this:</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ce5d7364022b47fc834d9e115a537a3f"><span data-offset-key="ce5d7364022b47fc834d9e115a537a3f:0">You want to wrap a C/C++ library, and use it from Python.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="95f7aedce88d4aa5a70a28bf79e5e0d0"><span data-offset-key="95f7aedce88d4aa5a70a28bf79e5e0d0:0">You want to speed up Python code.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f50a6967878349caa99ddad177ca7d2c"><span data-offset-key="f50a6967878349caa99ddad177ca7d2c:0">The </span><span data-offset-key="f50a6967878349caa99ddad177ca7d2c:1">*second*</span><span data-offset-key="f50a6967878349caa99ddad177ca7d2c:2"> reason is the one I’m going to focus on. By adding a few type declarations to your Python source code, you can dramatically speed up certain kinds of functions.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9cfe63392935412d83db33ac3b2120aa"><span data-offset-key="9cfe63392935412d83db33ac3b2120aa:0">Consider the following code, which is as simple as I could possibly make it for this example:</span></span></span>

    import array  ​n = int(1e8) a = array.array('d', [0.0]) * n  ​for i in range(n):     a[i] = i % 3​print(a[:5])

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="a12c2c72dbfe403dbfcf7dfc72825d7a"><span data-offset-key="a12c2c72dbfe403dbfcf7dfc72825d7a:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO26-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="bd6e15f7f73a401b851189ae208e82bc"><span data-offset-key="bd6e15f7f73a401b851189ae208e82bc:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="58d903b4d0b64d8db5fec7d448f94dcc"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="58d903b4d0b64d8db5fec7d448f94dcc"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="f9e2a6632e694a39b03260efb8bf46fe"><span data-offset-key="f9e2a6632e694a39b03260efb8bf46fe:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="38fd89cb624d41cf8e2cf36a45f3b133"><span data-offset-key="38fd89cb624d41cf8e2cf36a45f3b133:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="018265610c104a51bf4a2a9f7ef8d824"><span data-offset-key="018265610c104a51bf4a2a9f7ef8d824:0">We’re using the built-in </span><span data-offset-key="018265610c104a51bf4a2a9f7ef8d824:1">`array`</span><span data-offset-key="018265610c104a51bf4a2a9f7ef8d824:2"> module.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO26-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="f19eca42efe04a6a838c89c16818a7c3"><span data-offset-key="f19eca42efe04a6a838c89c16818a7c3:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="227b7bd4ef264f878e026577fc6c9091"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="227b7bd4ef264f878e026577fc6c9091"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="662c535bce3448fb90f7a5ca4a424ac4"><span data-offset-key="662c535bce3448fb90f7a5ca4a424ac4:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="b4a6e236aad6403d912be66dd3aa45aa"><span data-offset-key="b4a6e236aad6403d912be66dd3aa45aa:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="32471c7794274702b32687c4b0399da9"><span data-offset-key="32471c7794274702b32687c4b0399da9:0">Set the size of our data.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO26-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="c4fda4b0a6a44a2f891f486d0e8d59bc"><span data-offset-key="c4fda4b0a6a44a2f891f486d0e8d59bc:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="c68ca177df9d49629123fb77f800513e"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="c68ca177df9d49629123fb77f800513e"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="21e01935b7514a929d753261eebfcdec"><span data-offset-key="21e01935b7514a929d753261eebfcdec:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="51d59a626e9f40f194e4244319861cd1"><span data-offset-key="51d59a626e9f40f194e4244319861cd1:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="23866f72de3448738ce166bda5069739"><span data-offset-key="23866f72de3448738ce166bda5069739:0">Create fictional data: a sequence of double-precision numbers; in reality your data would come from another source such as an image for image-processing applications, or numerical data for science or engineering applications.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO26-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="53fc734c19574fa5b330442eb8e79aa5"><span data-offset-key="53fc734c19574fa5b330442eb8e79aa5:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="c40e8108d21040fdb0a0e1ce02ea36e7"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="c40e8108d21040fdb0a0e1ce02ea36e7"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="0f8fcf5dd5074caf99b03c563d3f47cc"><span data-offset-key="0f8fcf5dd5074caf99b03c563d3f47cc:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="78b029d552864ac59d43c44cb21057fb"><span data-offset-key="78b029d552864ac59d43c44cb21057fb:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="cafd4ede9633448898cb20f3265ebf97"><span data-offset-key="cafd4ede9633448898cb20f3265ebf97:0">A very simple loop that modifies our data.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO26-5" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="aef900dead4d40a88176506aaed30201"><span data-offset-key="aef900dead4d40a88176506aaed30201:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="29cd8789295641678257f1125911e8df"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="29cd8789295641678257f1125911e8df"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/5.png" alt="5" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="7d654ff7ad0f46cd9da550bd63cd9a7e"><span data-offset-key="7d654ff7ad0f46cd9da550bd63cd9a7e:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="db5158ae719b4bfcbb8f34c537024551"><span data-offset-key="db5158ae719b4bfcbb8f34c537024551:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="867d8b4b136f4bd3bb3173813fe32b90"><span data-offset-key="867d8b4b136f4bd3bb3173813fe32b90:0">Print the modified data; here, we only show the first five entries.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="56b3c4924ace45dcaaaff0ff0345b419"><span data-offset-key="56b3c4924ace45dcaaaff0ff0345b419:0">This code represents the most basic computer processing: data comes in, is transformed, and goes out. The specific code we’re using is quite silly, but I hope it is clear enough so that it will be easy to understand how we implement this in Cython later.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="65fa6709d5724e14b759a9bcb2e6f9e4"><span data-offset-key="65fa6709d5724e14b759a9bcb2e6f9e4:0">We can run this program on the command line in the following way:</span></span></span>

    $ time python cythondemoslow.pyarray('d', [0.0, 1.0, 2.0, 0.0, 1.0])​real    0m27.622suser    0m27.109ssys     0m0.443s

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d437735aec294e49be612c439f188393"><span data-offset-key="d437735aec294e49be612c439f188393:0">I’ve include the </span><span data-offset-key="d437735aec294e49be612c439f188393:1">`time`</span><span data-offset-key="d437735aec294e49be612c439f188393:2"> command to get some performance measurements. Here we can see that this simple program takes around 30 seconds to run.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="80a54d5a3c6a4a748c77723b647db02a"><span data-offset-key="80a54d5a3c6a4a748c77723b647db02a:0">In order to use Cython, we need to modify the code slightly to take advantage of the Cython compiler’s features:</span></span></span>

    import array  ​cdef int n = int(1e8)  cdef object a = array.array('d', [0.0]) * ncdef double[:] mv = a  ​cdef int i  for i in range(n):    mv[i] = i % 3  ​print(a[:5])

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5ec44a679cad447a9b4f6ffeeee85efc"><span data-offset-key="5ec44a679cad447a9b4f6ffeeee85efc:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO27-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="ff2751ae4bfd4b1bad7491dbaf46fe08"><span data-offset-key="ff2751ae4bfd4b1bad7491dbaf46fe08:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="0f64a2bd7a8947e7a0a1c877ce60dc2a"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="0f64a2bd7a8947e7a0a1c877ce60dc2a"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="396d969164c5473490a4c639946d8af3"><span data-offset-key="396d969164c5473490a4c639946d8af3:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="a390dbf06fa943de953e948c77ed9cf4"><span data-offset-key="a390dbf06fa943de953e948c77ed9cf4:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="74ba73ee283d443ba1226e24f6c45c11"><span data-offset-key="74ba73ee283d443ba1226e24f6c45c11:0">We import the array module as before.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO27-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="767a8fe81d8f4af580802d016cf1b66c"><span data-offset-key="767a8fe81d8f4af580802d016cf1b66c:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="ededf1bb3da24421bd29b60674352dae"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="ededf1bb3da24421bd29b60674352dae"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="f576683d7ad24da08fe7879925a2fd7a"><span data-offset-key="f576683d7ad24da08fe7879925a2fd7a:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="6967d5e4d6c24f1e9c5005963efe75d2"><span data-offset-key="6967d5e4d6c24f1e9c5005963efe75d2:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="6c97c7e44e164134af23bb0b56474d9c"><span data-offset-key="6c97c7e44e164134af23bb0b56474d9c:0">The variable for the data size, </span><span data-offset-key="6c97c7e44e164134af23bb0b56474d9c:1">`n`</span><span data-offset-key="6c97c7e44e164134af23bb0b56474d9c:2">, now gets a specific datatype.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO27-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="5f2cc607cf574221a7558c83459db32e"><span data-offset-key="5f2cc607cf574221a7558c83459db32e:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="e9e3fc33c72447a081f62d034d37f95b"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="e9e3fc33c72447a081f62d034d37f95b"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="d2e905ae30e24e4193958cb71226c4e1"><span data-offset-key="d2e905ae30e24e4193958cb71226c4e1:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="5334cc84c89547728164eb6c403bd79e"><span data-offset-key="5334cc84c89547728164eb6c403bd79e:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3eea6b5cf28747858a437183e9e32bc8"><span data-offset-key="3eea6b5cf28747858a437183e9e32bc8:0">This line is new: we create a </span><span data-offset-key="3eea6b5cf28747858a437183e9e32bc8:1">*memory view*</span><span data-offset-key="3eea6b5cf28747858a437183e9e32bc8:2"> of the data inside the array </span><span data-offset-key="3eea6b5cf28747858a437183e9e32bc8:3">`a`</span><span data-offset-key="3eea6b5cf28747858a437183e9e32bc8:4">. This allows Cython to generate code that can access the data inside the array directly.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO27-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="72b3c9ac2c334842901aeb838a496bee"><span data-offset-key="72b3c9ac2c334842901aeb838a496bee:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="607b2a12e0154295926d2ee56580651f"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="607b2a12e0154295926d2ee56580651f"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="09bdf80ee7194a0482546e8f0762ee68"><span data-offset-key="09bdf80ee7194a0482546e8f0762ee68:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="17ec8a1133704e04948b7ab918061e8e"><span data-offset-key="17ec8a1133704e04948b7ab918061e8e:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f918a874fbdd4b519741fd72461d269c"><span data-offset-key="f918a874fbdd4b519741fd72461d269c:0">As with </span><span data-offset-key="f918a874fbdd4b519741fd72461d269c:1">`n`</span><span data-offset-key="f918a874fbdd4b519741fd72461d269c:2">, we also specify a type for the loop index </span><span data-offset-key="f918a874fbdd4b519741fd72461d269c:3">`i`</span><span data-offset-key="f918a874fbdd4b519741fd72461d269c:4">.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO27-5" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="cfe707ddbe4e43dca938105134eb6fbf"><span data-offset-key="cfe707ddbe4e43dca938105134eb6fbf:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="b7510fe4dec644a9b3da81fde41254d7"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="b7510fe4dec644a9b3da81fde41254d7"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/5.png" alt="5" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="5e560260e7e14ed3b7769c0bf0870963"><span data-offset-key="5e560260e7e14ed3b7769c0bf0870963:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="1191b0c7bfc541beb4e62af3ab1e723e"><span data-offset-key="1191b0c7bfc541beb4e62af3ab1e723e:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="8e737fdc421e49358047172dd09166d8"><span data-offset-key="8e737fdc421e49358047172dd09166d8:0">The work inside the loop is identical to before, except that we manipulate elements of the </span><span data-offset-key="8e737fdc421e49358047172dd09166d8:1">*memory view*</span><span data-offset-key="8e737fdc421e49358047172dd09166d8:2"> rather than </span><span data-offset-key="8e737fdc421e49358047172dd09166d8:3">`a`</span><span data-offset-key="8e737fdc421e49358047172dd09166d8:4"> itself.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="eab348702b8e4728b1e790caf112d682"><span data-offset-key="eab348702b8e4728b1e790caf112d682:0">Having modified our source code by adding information about native datatypes, we need to make three further departures from the normal Python workflow necessary before running our Cython code.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e5eeee67041340a1806bb19bb556d080"><span data-offset-key="e5eeee67041340a1806bb19bb556d080:0">The first is that, by convention, we change the file extension of our source-code file to </span><span data-offset-key="e5eeee67041340a1806bb19bb556d080:1">*pyx*</span><span data-offset-key="e5eeee67041340a1806bb19bb556d080:2"> instead of </span><span data-offset-key="e5eeee67041340a1806bb19bb556d080:3">*py*</span><span data-offset-key="e5eeee67041340a1806bb19bb556d080:4">, to reflect the fact that our source code is no longer normal Python.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="992eac786ca94c17bd85f7a63772d46b"><span data-offset-key="992eac786ca94c17bd85f7a63772d46b:0">The second is that we must use Cython to </span><span data-offset-key="992eac786ca94c17bd85f7a63772d46b:1">*compile*</span><span data-offset-key="992eac786ca94c17bd85f7a63772d46b:2"> our source code into a native machine binary file. There are many ways to do this depending on your situation, but here we’re going to go with the simple option and use a command-line tool provided by Cython itself:</span></span></span>

    $ cythonize -b -i cythondemofast.pyx

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="98f7b276499341afaf4ba7e491eb0158"><span data-offset-key="98f7b276499341afaf4ba7e491eb0158:0">Running this command produces many lines of output messages from the compiler, but when the smoke clears you should find a new binary file in the same place as the </span><span data-offset-key="98f7b276499341afaf4ba7e491eb0158:1">`.pyx`</span><span data-offset-key="98f7b276499341afaf4ba7e491eb0158:2"> file:</span></span></span>

    $ ls -l cythondemofast.cpython-35m-darwin.so[email protected] calebhattingh 140228 3 Jul 15:51                            cythondemofast.cpython-35m-darwin.so

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="03029b06295e4ec5b6ad4815f4b55ee8"><span data-offset-key="03029b06295e4ec5b6ad4815f4b55ee8:0">This is a native binary that Cython produced from our slightly modified Python source code! Now we need to run it, and this brings us to the third departure from the normal Python workflow: by default, Cython makes </span><span data-offset-key="03029b06295e4ec5b6ad4815f4b55ee8:1">*native extensions*</span><span data-offset-key="03029b06295e4ec5b6ad4815f4b55ee8:2"> (as shared libraries), which means you have to import these in the same way you might import other Python extensions that use shared libraries.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f658a2ae63cc4baa921b1210fbb12dae"><span data-offset-key="f658a2ae63cc4baa921b1210fbb12dae:0">With the first version of our example in ordinary Python, we could run the program easily with </span><span data-offset-key="f658a2ae63cc4baa921b1210fbb12dae:1">`python cythondemoslow.py`</span><span data-offset-key="f658a2ae63cc4baa921b1210fbb12dae:2">. We can run the code in our compiled </span><span data-offset-key="f658a2ae63cc4baa921b1210fbb12dae:3">*Cython*</span><span data-offset-key="f658a2ae63cc4baa921b1210fbb12dae:4"> version simply by </span><span data-offset-key="f658a2ae63cc4baa921b1210fbb12dae:5">*importing*</span><span data-offset-key="f658a2ae63cc4baa921b1210fbb12dae:6"> the native extension. As before, we include the </span><span data-offset-key="f658a2ae63cc4baa921b1210fbb12dae:7">`time`</span><span data-offset-key="f658a2ae63cc4baa921b1210fbb12dae:8"> for measurement:</span></span></span>

    $ time python -c "import cythondemofast"array('d', [0.0, 1.0, 2.0, 0.0, 1.0])​real    0m0.751suser    0m0.478ssys     0m0.270s

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="fa78fd8076b44184904e94c940bdd840"><span data-offset-key="fa78fd8076b44184904e94c940bdd840:0">The Cython program gives us a speed-up over the plain Python program of almost 40 times! In larger numerical programs where the time cost of start-up and other initialization is a much smaller part of the overall execution time, the speed-up is usually more than 100 times!</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="48bf5fbe915b465ba2462ade31f09179"><span data-offset-key="48bf5fbe915b465ba2462ade31f09179:0">In the example shown here, all our code was set out in the module itself, but usually you would write functions and after compiling with Cython, and then import these functions into your main Python program. Here’s how Cython can easily integrate into your normal Python workflow:</span></span></span>

1.  <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f1827c48460749b79892494ba9b8e1d9"><span data-offset-key="f1827c48460749b79892494ba9b8e1d9:0">Begin your project with normal Python.</span></span></span>

2.  <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0c9723dba79245ae9ab46fb677432ecf"><span data-offset-key="0c9723dba79245ae9ab46fb677432ecf:0">Benchmark your performance.</span></span></span>

3.  <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f786ae7e7ad5407594fd4bd6e45824e3"><span data-offset-key="f786ae7e7ad5407594fd4bd6e45824e3:0">If you need more speed, </span><span data-offset-key="f786ae7e7ad5407594fd4bd6e45824e3:1">*profile*</span><span data-offset-key="f786ae7e7ad5407594fd4bd6e45824e3:2"> your code to find the functions that consume most of the time.</span></span></span>

4.  <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="628b365672e740398d7aaffa1e993228"><span data-offset-key="628b365672e740398d7aaffa1e993228:0">Convert these functions to Cython functions, and compile the new </span><span data-offset-key="628b365672e740398d7aaffa1e993228:1">`.pyx`</span><span data-offset-key="628b365672e740398d7aaffa1e993228:2"> Cython modules into native extensions.</span></span></span>

5.  <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3ce34b3362114723a0f6d401fb0554f9"><span data-offset-key="3ce34b3362114723a0f6d401fb0554f9:0">Import the new Cython functions into your main Python program.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="08348bb0fa674c3fb023c272dff483ac"><span data-offset-key="08348bb0fa674c3fb023c272dff483ac:0">Multithreading with Cython</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="419523e89b6c4c7ca7c11f4cc556104e"><span data-offset-key="419523e89b6c4c7ca7c11f4cc556104e:0">It won’t take long for a newcomer to the Python world to hear about Python’s so-called GIL, a safety mechanism Python uses to decrease the possibility of problems when using threads.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5a1aefdf685043f59d5cda69c74ee917"><span data-offset-key="5a1aefdf685043f59d5cda69c74ee917:0">Threading is a tool that lets you execute different sections of code in </span><span data-offset-key="5a1aefdf685043f59d5cda69c74ee917:1">*parallel*</span><span data-offset-key="5a1aefdf685043f59d5cda69c74ee917:2">, allowing the operating system to run each section on a separate CPU. The “GIL problem” is that the safety lock that prevents the interpreter state from being clobbered by parallel execution </span><span data-offset-key="5a1aefdf685043f59d5cda69c74ee917:3">*also*</span><span data-offset-key="5a1aefdf685043f59d5cda69c74ee917:4"> has the unfortunate effect of limiting the ability of threads to actually run on different CPUs. The net effect is that Python threads do not achieve the parallel performance one would expect based on the availability of CPU resources.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="7dee316298e1400eaeee279a452c5392"><span data-offset-key="7dee316298e1400eaeee279a452c5392:0">Cython gives us a way out of this dilemma, and enables multithreading at full performance. This is because </span><span data-offset-key="7dee316298e1400eaeee279a452c5392:1">*native extensions*</span><span data-offset-key="7dee316298e1400eaeee279a452c5392:2"> (which is what Cython makes) are allowed to tell the main Python interpreter that they will be well-behaved and don’t need to be protected with the global safety lock. This means that threads containing Cython code can run in a fully parallel way on multiple CPUs; we just need to ask Python for permission.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="878f3b7b90fe4535b749b6a1a8ffe688"><span data-offset-key="878f3b7b90fe4535b749b6a1a8ffe688:0">In the following code snippet, we demonstrate how to use normal Python threading to speed up the same nonsense calculation I used in previous examples:</span></span></span>

    # cython: boundscheck=False, cdivision=Trueimport arrayimport threading  ​cpdef void target(double[:] piece) nogil:      cdef int i, n = piece.shape[0]    with nogil:          for i in range(n):            piece[i] = i % 3​​cdef int n = int(1e8)  cdef object a = array.array('d', [0.0]) * n​​view = memoryview(a)  piece_size = int(n / 2)  ​thread1 = threading.Thread(      target=target,    args=(view[:piece_size],))​thread2 = threading.Thread(    target=target,    args=(view[piece_size:],))​thread1.start()  thread2.start()​thread1.join()  thread2.join()​print(a[:5])

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="25b7e7b64ffd435d8148f8e12568eea8"><span data-offset-key="25b7e7b64ffd435d8148f8e12568eea8:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO28-1" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="e7898444418e43a384fe68a5845ead4e"><span data-offset-key="e7898444418e43a384fe68a5845ead4e:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="03e0b4380f224d3390aabd6bd2d37ee5"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="03e0b4380f224d3390aabd6bd2d37ee5"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/1.png" alt="1" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="84d56870d7714105abfe75cd5b666723"><span data-offset-key="84d56870d7714105abfe75cd5b666723:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="7df28acd6a2a4ab5bad244862fbbb68f"><span data-offset-key="7df28acd6a2a4ab5bad244862fbbb68f:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2ecfffb3661a48d594181d1fc14af755"><span data-offset-key="2ecfffb3661a48d594181d1fc14af755:0">The threading module in the standard library.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO28-2" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="5574290879c941d5a98b30f9bfc49b3a"><span data-offset-key="5574290879c941d5a98b30f9bfc49b3a:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="287b0b3511c44de89c6fa7623b31b83a"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="287b0b3511c44de89c6fa7623b31b83a"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/2.png" alt="2" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="d95f9e6289f94ca3aae7bdeb32cc8c4c"><span data-offset-key="d95f9e6289f94ca3aae7bdeb32cc8c4c:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="cc49a2bf8c3f4d13be8ed33b8a72d05f"><span data-offset-key="cc49a2bf8c3f4d13be8ed33b8a72d05f:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="aa3b9f84503344a4b2c26b9e2aca11af"><span data-offset-key="aa3b9f84503344a4b2c26b9e2aca11af:0">`Thread`</span><span data-offset-key="aa3b9f84503344a4b2c26b9e2aca11af:1"> objects want a target function to execute, so we wrap our calculation inside a function. We declare (with the </span><span data-offset-key="aa3b9f84503344a4b2c26b9e2aca11af:2">`nogil`</span><span data-offset-key="aa3b9f84503344a4b2c26b9e2aca11af:3"> keyword) that our function may want to release the GIL.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO28-3" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="730def5f480f4b85b9cb39359eec2afb"><span data-offset-key="730def5f480f4b85b9cb39359eec2afb:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="f422df6ba83d42d8bc0d24086cf5dcbf"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="f422df6ba83d42d8bc0d24086cf5dcbf"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/3.png" alt="3" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="c7f3db21c32843f98d30b0e994d67215"><span data-offset-key="c7f3db21c32843f98d30b0e994d67215:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="5c77367c68844c56868f6a0751336d35"><span data-offset-key="5c77367c68844c56868f6a0751336d35:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="5dfd7690db9747269dd2397d2beec1fa"><span data-offset-key="5dfd7690db9747269dd2397d2beec1fa:0">The actual point where the GIL is released. The rest of the function is identical to before.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO28-4" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="906de3ae0908406ea3551b46e5e83616"><span data-offset-key="906de3ae0908406ea3551b46e5e83616:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="9874300f997e466a956c8dbc3b5947e7"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="9874300f997e466a956c8dbc3b5947e7"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/4.png" alt="4" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="715d62d444164161b7c0c8e4bbba1322"><span data-offset-key="715d62d444164161b7c0c8e4bbba1322:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="e1face0e52664b29a9f3892e81fceefc"><span data-offset-key="e1face0e52664b29a9f3892e81fceefc:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="00d801f85b044729aa0f63a25591123b"><span data-offset-key="00d801f85b044729aa0f63a25591123b:0">Exactly the same as before.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO28-5" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="8a1c58e1544646959f94ededdf630942"><span data-offset-key="8a1c58e1544646959f94ededdf630942:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="2096ac68f3c74a8ea91c9c2a8ebdbe8b"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="2096ac68f3c74a8ea91c9c2a8ebdbe8b"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/5.png" alt="5" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="7c55bb7a9ffc498285a472b3777274b2"><span data-offset-key="7c55bb7a9ffc498285a472b3777274b2:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="369eaacd38d6436f9535fc5d6d845d73"><span data-offset-key="369eaacd38d6436f9535fc5d6d845d73:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4e1a6e70633f400a9f6834b8d62202c2"><span data-offset-key="4e1a6e70633f400a9f6834b8d62202c2:0">We create a </span><span data-offset-key="4e1a6e70633f400a9f6834b8d62202c2:1">*memory view*</span><span data-offset-key="4e1a6e70633f400a9f6834b8d62202c2:2"> of the data inside the array. Cython is optimized to work with these kinds of memory views efficiently. (Did you know that </span><span data-offset-key="4e1a6e70633f400a9f6834b8d62202c2:3">`memoryview()`</span><span data-offset-key="4e1a6e70633f400a9f6834b8d62202c2:4"> is a built-in </span><span data-offset-key="4e1a6e70633f400a9f6834b8d62202c2:5">*Python*</span><span data-offset-key="4e1a6e70633f400a9f6834b8d62202c2:6"> function?)</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO28-6" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="4e584d8588d44e97b3ac09c1c16038f7"><span data-offset-key="4e584d8588d44e97b3ac09c1c16038f7:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="1026d1d0a0f54f27a79e1094bca14a50"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="1026d1d0a0f54f27a79e1094bca14a50"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/6.png" alt="6" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="f18621bd0b27414a80425d0e972194d2"><span data-offset-key="f18621bd0b27414a80425d0e972194d2:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="b42e7031a78f43b2a63f1034b691dbf3"><span data-offset-key="b42e7031a78f43b2a63f1034b691dbf3:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="b61166c60b4e452983636566c36c10a4"><span data-offset-key="b61166c60b4e452983636566c36c10a4:0">We’re going to split up our big data array into two parts.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO28-7" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="d48d85c877a846deb33fda353670c192"><span data-offset-key="d48d85c877a846deb33fda353670c192:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="946eea198e0c4494b28313c412220e9a"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="946eea198e0c4494b28313c412220e9a"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/7.png" alt="7" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="3e386117a53b4f699dc8e512c978395c"><span data-offset-key="3e386117a53b4f699dc8e512c978395c:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="e323e20646b54047bdddc9519c18dfc5"><span data-offset-key="e323e20646b54047bdddc9519c18dfc5:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ade5de2249654d0fbc85af85b5162391"><span data-offset-key="ade5de2249654d0fbc85af85b5162391:0">Create normal Python threads: we must pass both the target function and the </span><span data-offset-key="ade5de2249654d0fbc85af85b5162391:1">*view section*</span><span data-offset-key="ade5de2249654d0fbc85af85b5162391:2"> as the argument for the function. Note how each thread gets a different part of the view</span></span><span data-slate-void="true" data-key="37f09e4d54ed40418268a735b3d61c4f"><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="37f09e4d54ed40418268a735b3d61c4f"><embed src="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO28-8" class="image-67b14f24--image-54d049be" /></span></span><span data-key="c94303c7676b44e68bef07a53322b7e2"><span data-offset-key="c94303c7676b44e68bef07a53322b7e2:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="adf83b0d0b7a474f800a2449cab8473e"><span data-offset-key="adf83b0d0b7a474f800a2449cab8473e:0">Threads are started.</span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#co_expanding_your__span_class__keep_together__python_knowledge___span___span_class__keep_together__lesser_known_libraries__span__CO28-9" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="1259a393fd214f6fbacc95698f3bd3d2"><span data-offset-key="1259a393fd214f6fbacc95698f3bd3d2:0"><span data-slate-zero-width="z">​</span></span></span><span data-slate-void="true" data-key="c1300a2bd79b45e4aa40efa88a83c56e"><span><span class="reset-3c756112--frameInlineVoid-73b6a96b" data-key="c1300a2bd79b45e4aa40efa88a83c56e"><img src="https://learning.oreilly.com/api/v2/epubs/urn:orm:book:9781492037866/files/assets/9.png" alt="9" class="image-67b14f24--image-54d049be" /></span></span></span><span data-key="e0dde01b23f74e67ba55eaef8c7664ea"><span data-offset-key="e0dde01b23f74e67ba55eaef8c7664ea:0"><span data-slate-zero-width="z">​</span></span></span></a><span data-key="86e4f9bd291c49d8ba3a23b62621ef0c"><span data-offset-key="86e4f9bd291c49d8ba3a23b62621ef0c:0"><span data-slate-zero-width="z">​</span></span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0e8eaed51b2646bab60e253d1020fdd0"><span data-offset-key="0e8eaed51b2646bab60e253d1020fdd0:0">We wait for the threads to complete.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="04ad09afe59349088dadcde8b634f395"><span data-offset-key="04ad09afe59349088dadcde8b634f395:0">I’ve also sneakily added a few small optimization options such as disabling bounds checking and enabling the faster “C division.” Cython is very configurable in how it generates C code behind the scenes and </span></span><a href="http://docs.cython.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="3738e9a2ae4146bfa53fe435bfded12b"><span data-offset-key="3738e9a2ae4146bfa53fe435bfded12b:0">the documentation</span></span></a><span data-key="a71a51a1c8db495683e7d27add41e646"><span data-offset-key="a71a51a1c8db495683e7d27add41e646:0"> is well worth investigating.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f69cd995bbb7441e8bcedbdaf0d6ce6d"><span data-offset-key="f69cd995bbb7441e8bcedbdaf0d6ce6d:0">As before, we must compile our program:</span></span></span>

    $ cythonize -b -i -a cythondemopll.pyx

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="26ece7c627dd4704ac2828407396991a"><span data-offset-key="26ece7c627dd4704ac2828407396991a:0">Then we can test the impact of our changes:</span></span></span>

    $ time python -c "import cythondemopll"array('d', [0.0, 1.0, 2.0, 0.0, 1.0])​real    0m0.593suser    0m0.390ssys     0m0.276s

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="f68b51000aa64ca49ed6206a6edddb74"><span data-offset-key="f68b51000aa64ca49ed6206a6edddb74:0">The use of threading has given us around 30% improvement over the previous, single-threaded version, and we’re about 50 times faster than the original Python version in this example. For a longer-running program the speedup factor would be even more significant because the startup time for the Python interpreter would account for a smaller portion of the time cost.</span></span></span>

### 

<span class="text-4505230f--HeadingH400-686c0942--textContentFamily-49a318e1"><span data-key="409feb07e1844a848900d4c6963434c6"><span data-offset-key="409feb07e1844a848900d4c6963434c6:0">Executables with Cython</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3ce14a8e61624cd4b28391fc68bdac9d"><span data-offset-key="3ce14a8e61624cd4b28391fc68bdac9d:0">One final trick with Cython is creating executables. So far we’ve been compiling our Cython code for use as a native extension module, which we then import to run. However, Cython also makes it possible to create a native binary executable directly. The key is to invoke </span><span data-offset-key="3ce14a8e61624cd4b28391fc68bdac9d:1">`cython`</span><span data-offset-key="3ce14a8e61624cd4b28391fc68bdac9d:2"> directly with the </span><span data-offset-key="3ce14a8e61624cd4b28391fc68bdac9d:3">`--embed`</span><span data-offset-key="3ce14a8e61624cd4b28391fc68bdac9d:4"> option:</span></span></span>

    $ cython --embed cythondemopll.pyx

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="2805f1a2713b473ca3327da470e63d06"><span data-offset-key="2805f1a2713b473ca3327da470e63d06:0">This produces a C source file that will compile to an executable rather than a shared library.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4cff93af87634f4b84ba7acbdccc3b5b"><span data-offset-key="4cff93af87634f4b84ba7acbdccc3b5b:0">The next step depends on your platform because you must invoke the C compiler directly, but the main thing you need to provide is the path to the Python header file and linking library. This is how it looks on my Mac:</span></span></span>

    $ gcc `python3.5-config --cflags` cythondemopll.c \      `python3.5-config --ldflags` -o cythondemopll

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9fb63c88818e4080bb0ba955a37ed407"><span data-offset-key="9fb63c88818e4080bb0ba955a37ed407:0">Here I’ve used a utility called </span><span data-offset-key="9fb63c88818e4080bb0ba955a37ed407:1">`python3.5-config`</span><span data-offset-key="9fb63c88818e4080bb0ba955a37ed407:2"> that conveniently returns the path to the header file and the Python library, but you could also provide the paths directly.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="e568aed76e6940e69adb4325b6df43c9"><span data-offset-key="e568aed76e6940e69adb4325b6df43c9:0">The compilation step using </span><span data-offset-key="e568aed76e6940e69adb4325b6df43c9:1">`gcc`</span><span data-offset-key="e568aed76e6940e69adb4325b6df43c9:2"> produces a </span><span data-offset-key="e568aed76e6940e69adb4325b6df43c9:3">*native binary*</span><span data-offset-key="e568aed76e6940e69adb4325b6df43c9:4"> executable that can be run directly on the command line:</span></span></span>

    $ ./cythondemopllarray('d', [0.0, 1.0, 2.0, 0.0, 1.0])

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9242eba61a374d3583c91e2a9dd1dd81"><span data-offset-key="9242eba61a374d3583c91e2a9dd1dd81:0">There is much more to learn about Cython, and I’ve made a comprehensive video series, </span><span data-offset-key="9242eba61a374d3583c91e2a9dd1dd81:1">*Learning Cython*</span><span data-offset-key="9242eba61a374d3583c91e2a9dd1dd81:2"> (O’Reilly) that covers all the details. </span></span><a href="http://docs.cython.org/#" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="ecbc5e28a9d14657a1c8a90058c32334"><span data-offset-key="ecbc5e28a9d14657a1c8a90058c32334:0">Cython’s online documentation</span></span></a><span data-key="78155c03545241889c67db81356f0b97"><span data-offset-key="78155c03545241889c67db81356f0b97:0"> is also an excellent reference.</span></span></span>

<span class="text-4505230f--HeadingH600-23f228db--textContentFamily-49a318e1"><span data-key="06fd90991e5440569c58fc4704f0cda2"><span data-offset-key="06fd90991e5440569c58fc4704f0cda2:0">awesome-python</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="3f9d94a233f2484bb748142efae218e6"><span data-offset-key="3f9d94a233f2484bb748142efae218e6:0">Finally, we have </span></span><a href="http://bit.ly/awesome-py" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="6d1db9b73f8e432da9c493dc5c0077c9"><span data-offset-key="6d1db9b73f8e432da9c493dc5c0077c9:0">awesome-python</span></span></a><span data-key="3f077421d7734e5eac64a21ddac930da"><span data-offset-key="3f077421d7734e5eac64a21ddac930da:0">. It’s not a library, but rather a huge, curated list of a high-quality Python libraries covering a large number of domains. If you have not seen this list before, make sure to reserve some time before browsing because once you begin, you’ll have a hard time tearing yourself away!</span></span></span>

<span class="text-4505230f--HeadingH700-04e1a2a3--textContentFamily-49a318e1"><span data-key="475b6b07b51c40dd82547b47592a6fbd"><span data-offset-key="475b6b07b51c40dd82547b47592a6fbd:0">Conclusion</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="54aceac73a10417fa8858780a1186679"><span data-offset-key="54aceac73a10417fa8858780a1186679:0">There is much more to discover than what you’ve seen in this report. One of the best things about the Python world is its enormous repository of high-quality libraries.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="19260446f8a349f498865a219a8586e8"><span data-offset-key="19260446f8a349f498865a219a8586e8:0">You have seen a few of the very special features of the standard library like the </span><span data-offset-key="19260446f8a349f498865a219a8586e8:1">`collections`</span><span data-offset-key="19260446f8a349f498865a219a8586e8:2"> module, </span><span data-offset-key="19260446f8a349f498865a219a8586e8:3">`contextlib`</span><span data-offset-key="19260446f8a349f498865a219a8586e8:4">, the </span><span data-offset-key="19260446f8a349f498865a219a8586e8:5">`concurrent.futures`</span><span data-offset-key="19260446f8a349f498865a219a8586e8:6"> module, and the </span><span data-offset-key="19260446f8a349f498865a219a8586e8:7">`logging`</span><span data-offset-key="19260446f8a349f498865a219a8586e8:8"> module. If you do not yet use these heavily, I sincerely hope you try them out in your next project.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="06a9ca1190fd4289bcc6de700a47d38d"><span data-offset-key="06a9ca1190fd4289bcc6de700a47d38d:0">In addition to those standard library modules, we also covered several excellent libraries that are also available to you on the PyPI. You’ve seen how:</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="56e878f20d24411680504a5c999a2c71"><span data-offset-key="56e878f20d24411680504a5c999a2c71:0">*flit*</span><span data-offset-key="56e878f20d24411680504a5c999a2c71:1"> makes it easy for you to create your own Python packages, and submit them to the PyPI.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="ad3964bff9184c10908511c0a42f8487"><span data-offset-key="ad3964bff9184c10908511c0a42f8487:0">libraries like </span><span data-offset-key="ad3964bff9184c10908511c0a42f8487:1">*colorama*</span><span data-offset-key="ad3964bff9184c10908511c0a42f8487:2"> and </span><span data-offset-key="ad3964bff9184c10908511c0a42f8487:3">*begins*</span><span data-offset-key="ad3964bff9184c10908511c0a42f8487:4"> improve your command-line applications.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="82813967df7c4bb5b39569a46d07dd39"><span data-offset-key="82813967df7c4bb5b39569a46d07dd39:0">tools like </span><span data-offset-key="82813967df7c4bb5b39569a46d07dd39:1">*pyqtgraph*</span><span data-offset-key="82813967df7c4bb5b39569a46d07dd39:2"> and </span><span data-offset-key="82813967df7c4bb5b39569a46d07dd39:3">*pywebview*</span><span data-offset-key="82813967df7c4bb5b39569a46d07dd39:4"> can save you lots of time when creating modern user interfaces, including </span><span data-offset-key="82813967df7c4bb5b39569a46d07dd39:5">*hug*</span><span data-offset-key="82813967df7c4bb5b39569a46d07dd39:6">, which can give your applications an easily created web API.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="eca76b93444e445ea02def571e0d0109"><span data-offset-key="eca76b93444e445ea02def571e0d0109:0">system libraries like </span><span data-offset-key="eca76b93444e445ea02def571e0d0109:1">*psutil*</span><span data-offset-key="eca76b93444e445ea02def571e0d0109:2"> and </span><span data-offset-key="eca76b93444e445ea02def571e0d0109:3">*watchdog*</span><span data-offset-key="eca76b93444e445ea02def571e0d0109:4"> can give you a clean integration with the host operating system.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="74f083bb550d4c64a066fe96860a0633"><span data-offset-key="74f083bb550d4c64a066fe96860a0633:0">temporal libraries like </span><span data-offset-key="74f083bb550d4c64a066fe96860a0633:1">*arrow*</span><span data-offset-key="74f083bb550d4c64a066fe96860a0633:2"> and </span><span data-offset-key="74f083bb550d4c64a066fe96860a0633:3">*parsedatetime*</span><span data-offset-key="74f083bb550d4c64a066fe96860a0633:4"> can simplify the tangled mess that working with dates and times often becomes.</span></span></span>

-   <span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1b9158c32e24489bac8bc50fa9b741de"><span data-offset-key="1b9158c32e24489bac8bc50fa9b741de:0">general-purpose libraries like </span><span data-offset-key="1b9158c32e24489bac8bc50fa9b741de:1">*boltons*</span><span data-offset-key="1b9158c32e24489bac8bc50fa9b741de:2"> and </span><span data-offset-key="1b9158c32e24489bac8bc50fa9b741de:3">*Cython*</span><span data-offset-key="1b9158c32e24489bac8bc50fa9b741de:4"> can further enrich the already powerful facilities in the Python standard library.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d9b03d5110a045b3b10e2e817e920b8d"><span data-offset-key="d9b03d5110a045b3b10e2e817e920b8d:0">Hopefully you will be able to use one or more of the great libraries in your next project, and I wish you the best of luck!</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="0825f166e2cd4840a117cba8fe8f2dbb"><span data-offset-key="0825f166e2cd4840a117cba8fe8f2dbb:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737073220608-marker" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="1090be2b721a444186961b65db1a5c6e"><span data-offset-key="1090be2b721a444186961b65db1a5c6e:0">1</span></span></a><span data-key="9cf3a29947514d01b0f6704ee8af400a"><span data-offset-key="9cf3a29947514d01b0f6704ee8af400a:0"> Looking for </span><span data-offset-key="9cf3a29947514d01b0f6704ee8af400a:1">*sorted*</span><span data-offset-key="9cf3a29947514d01b0f6704ee8af400a:2"> container types? The excellent </span></span><a href="http://bit.ly/sorted-cont" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="2afc28d33de64e05ab8239bb3f86770f"><span data-offset-key="2afc28d33de64e05ab8239bb3f86770f:0">sorted containers</span></span></a><span data-key="8c5483549bc448288109405ab685a7c9"><span data-offset-key="8c5483549bc448288109405ab685a7c9:0"> package has high-performance sorted versions of the </span><span data-offset-key="8c5483549bc448288109405ab685a7c9:1">`list`</span><span data-offset-key="8c5483549bc448288109405ab685a7c9:2">, </span><span data-offset-key="8c5483549bc448288109405ab685a7c9:3">`dict`</span><span data-offset-key="8c5483549bc448288109405ab685a7c9:4">, and </span><span data-offset-key="8c5483549bc448288109405ab685a7c9:5">`set`</span><span data-offset-key="8c5483549bc448288109405ab685a7c9:6"> datatypes.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="9418bc4c3e7e4600ae42c3f886de3be3"><span data-offset-key="9418bc4c3e7e4600ae42c3f886de3be3:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737068560688-marker" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="9de4b1c5facb468281ebeaef44c3dad6"><span data-offset-key="9de4b1c5facb468281ebeaef44c3dad6:0">2</span></span></a><span data-key="df45653843b6483091fcd2201e788a80"><span data-offset-key="df45653843b6483091fcd2201e788a80:0"> For instance, this example with </span><span data-offset-key="df45653843b6483091fcd2201e788a80:1">`setdefault()`</span><span data-offset-key="df45653843b6483091fcd2201e788a80:2"> looks like </span><span data-offset-key="df45653843b6483091fcd2201e788a80:3">`d.setdefault(k, []).append(...)`</span><span data-offset-key="df45653843b6483091fcd2201e788a80:4">. The default value is always evaluated, whereas with </span><span data-offset-key="df45653843b6483091fcd2201e788a80:5">`defaultdict`</span><span data-offset-key="df45653843b6483091fcd2201e788a80:6"> the default value generator is only evaluated when necessary. But there are still cases where you’ll need </span><span data-offset-key="df45653843b6483091fcd2201e788a80:7">`setdefault()`</span><span data-offset-key="df45653843b6483091fcd2201e788a80:8">, such as when using different default values depending on the key.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="86075c90e8c443cbb4185b99e708f9cf"><span data-offset-key="86075c90e8c443cbb4185b99e708f9cf:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737067445472-marker" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="79a35ab3009f4930bfeb3f4a03feba01"><span data-offset-key="79a35ab3009f4930bfeb3f4a03feba01:0">3</span></span></a><span data-key="24c1ae6a08fb4d4aa0f5033f7359d930"><span data-offset-key="24c1ae6a08fb4d4aa0f5033f7359d930:0"> </span><span data-offset-key="24c1ae6a08fb4d4aa0f5033f7359d930:1">*CPython*</span><span data-offset-key="24c1ae6a08fb4d4aa0f5033f7359d930:2"> means the specific implementation of the Python language that is written in the C language. There are other implementations of Python, created with various other languages and technologies such as .NET, Java and even subsets of Python itself.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="1fd6ca56b15641b5b7407cb01ad53361"><span data-offset-key="1fd6ca56b15641b5b7407cb01ad53361:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737067174608-marker" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="7ffcffe701664262aaaad7ddf3d1208e"><span data-offset-key="7ffcffe701664262aaaad7ddf3d1208e:0">4</span></span></a><span data-key="4447578f70304ff686773b4da40969e1"><span data-offset-key="4447578f70304ff686773b4da40969e1:0"> Programs that automate some task, often communicating data across different network services like Twitter, IRC, and Slack.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="d287b4ac11ad49a4a6cf15a9ebd8f60d"><span data-offset-key="d287b4ac11ad49a4a6cf15a9ebd8f60d:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737066652496-marker" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="80b2f1862df44c9f9b273c51d68c4fe4"><span data-offset-key="80b2f1862df44c9f9b273c51d68c4fe4:0">5</span></span></a><span data-key="76726ec3d71e4dadaa41a9de395a5e36"><span data-offset-key="76726ec3d71e4dadaa41a9de395a5e36:0"> The </span><span data-offset-key="76726ec3d71e4dadaa41a9de395a5e36:1">`X.Y.Z`</span><span data-offset-key="76726ec3d71e4dadaa41a9de395a5e36:2"> versioning scheme shown here is known as </span><span data-offset-key="76726ec3d71e4dadaa41a9de395a5e36:3">*semantic versioning*</span><span data-offset-key="76726ec3d71e4dadaa41a9de395a5e36:4"> (“semver”), but an alternative scheme worth investigating further is </span><span data-offset-key="76726ec3d71e4dadaa41a9de395a5e36:5">*calendar versioning*</span><span data-offset-key="76726ec3d71e4dadaa41a9de395a5e36:6">, which you can learn more about at </span></span><a href="http://calver.org/" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="5380e576aef5435083833dd63b6b95e8"><span data-offset-key="5380e576aef5435083833dd63b6b95e8:0"><em>calver.org</em></span></span></a><span data-key="d0672ec8c9894024804a22b9be5520e9"><span data-offset-key="d0672ec8c9894024804a22b9be5520e9:0">.</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="4e271554bfd24e979fd6901f033856fb"><span data-offset-key="4e271554bfd24e979fd6901f033856fb:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737066327760-marker" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="ad6db6e5de024c74bf321af3beae06d2"><span data-offset-key="ad6db6e5de024c74bf321af3beae06d2:0">6</span></span></a><span data-key="654f456ae9f241aeb24269c13ab2653a"><span data-offset-key="654f456ae9f241aeb24269c13ab2653a:0"> </span><span data-offset-key="654f456ae9f241aeb24269c13ab2653a:1">`pip install colorlog`</span></span></span>

<span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1"><span data-key="faf3ab3e4f47478eb383ee59d31a9bc7"><span data-offset-key="faf3ab3e4f47478eb383ee59d31a9bc7:0"><span data-slate-zero-width="z">​</span></span></span><a href="https://learning.oreilly.com/library/view/20-python-libraries/9781492037866/ch01.html#idm139737065700880-marker" class="link-a079aa82--primary-53a25e66--link-faf6c434"><span data-key="6b394079118e4389829f7fd3d420604b"><span data-offset-key="6b394079118e4389829f7fd3d420604b:0">7</span></span></a><span data-key="112cd19da63d44cab17b3660f9e1086b"><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:0"> Unfortunately, </span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:1">`PyQt`</span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:2"> itself can be either trivial or very tricky to install, depending on your platform. At the time of writing, the stable release of </span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:3">`pyqtgraph`</span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:4"> requires </span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:5">`PyQt4`</span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:6"> for which no prebuilt installer is available on PyPI; however, the development branch of </span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:7">`pyqtgraph`</span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:8"> works with </span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:9">`PyQt5`</span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:10">, for which a prebuilt, </span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:11">`pip`</span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:12">-installable version </span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:13">*does*</span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:14"> exist on PyPI. With any luck, by the time you read this a new version of </span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:15">`pyqtgraph`</span><span data-offset-key="112cd19da63d44cab17b3660f9e1086b:16"> will have been released!</span></span></span>

<a href="../untitled.html" class="reset-3c756112--card-6570f064--whiteCard-fff091a4--cardPrevious-56a5e674"></a>

<span class="text-4505230f--TextH200-a3425406--textContentFamily-49a318e1">Utilities - Previous</span>

<span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1">Utilites</span>

<a href="untitled.html" class="reset-3c756112--card-6570f064--whiteCard-fff091a4--cardNext-19241c42"></a>

<span class="text-4505230f--TextH200-a3425406--textContentFamily-49a318e1">Next</span>

<span class="text-4505230f--UIH400-4e41e82a--textContentFamily-49a318e1">YouTube</span>

<img src="https://avatars.githubusercontent.com/u/66654881?v=4" class="image-67b14f24--avatar-1c1d03ec" />

<span class="text-4505230f--TextH200-a3425406--textContentFamily-49a318e1">Last updated 2 hours ago</span>

<a href="https://github.com/bgoonz/python-gitbook/blob/master/utilities/untitled/python-libraries.md" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageSideMenuItem-22949732"></a>

<span class="text-4505230f--UIH300-2063425d--textUIFamily-5ebd8e40">Edit on GitHub</span>

<span class="text-4505230f--InfoH100-1e92e1d1--textContentFamily-49a318e1">Contents</span>

<a href="python-libraries.html#the-standard-library" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">The Standard Library</span></span>

<a href="python-libraries.html#collections" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">collections</span></span>

<a href="python-libraries.html#ordereddict-beware-creation-with-keyword-arguments" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">ORDEREDDICT: BEWARE CREATION WITH KEYWORD ARGUMENTS</span></span>

<a href="python-libraries.html#contextlib" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">contextlib</span></span>

<a href="python-libraries.html#concurrent-futures" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">concurrent.futures</span></span>

<a href="python-libraries.html#logging" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">logging</span></span>

<a href="python-libraries.html#sched" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">sched</span></span>

<a href="python-libraries.html#in-the-wild" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">In the Wild</span></span>

<a href="python-libraries.html#easier-python-packaging-with-flit" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">Easier Python Packaging with flit</span></span>

<a href="python-libraries.html#command-line-applications" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">Command-Line Applications</span></span>

<a href="python-libraries.html#colorama" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">colorama</span></span>

<a href="python-libraries.html#begins" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">begins</span></span>

<a href="python-libraries.html#graphical-user-interfaces" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">Graphical User Interfaces</span></span>

<a href="python-libraries.html#pyqtgraph" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">pyqtgraph</span></span>

<a href="python-libraries.html#pywebview" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">pywebview</span></span>

<a href="python-libraries.html#system-tools" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">System Tools</span></span>

<a href="python-libraries.html#psutil" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">psutil</span></span>

<a href="python-libraries.html#watchdog" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">Watchdog</span></span>

<a href="python-libraries.html#ptpython" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">ptpython</span></span>

<a href="python-libraries.html#web-apis-with-hug" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">Web APIs with hug</span></span>

<a href="python-libraries.html#dates-and-times" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">Dates and Times</span></span>

<a href="python-libraries.html#arrow" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">arrow</span></span>

<a href="python-libraries.html#alternative-libraries-for-dates-and-times" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">ALTERNATIVE LIBRARIES FOR DATES AND TIMES</span></span>

<a href="python-libraries.html#parsedatetime" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">parsedatetime</span></span>

<a href="python-libraries.html#general-purpose-libraries" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">General-Purpose Libraries</span></span>

<a href="python-libraries.html#boltons" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">boltons</span></span>

<a href="python-libraries.html#cython" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">Cython</span></span>

<a href="python-libraries.html#awesome-python" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1--pageTocLinkH2-2294976c">awesome-python</span></span>

<a href="python-libraries.html#conclusion" class="reset-3c756112--menuItem-aa02f6ec--menuItemLight-757d5235--menuItemInline-173bdf97--pageTocItem-f4427024"></a>

<span class="text-4505230f--UIH300-2063425d--textContentFamily-49a318e1"><span class="text-4505230f--UIH200-50ead35f--textContentFamily-49a318e1">Conclusion</span></span>
